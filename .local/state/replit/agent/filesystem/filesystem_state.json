{"file_contents":{"modules/saleFlow/responseHandler.js":{"content":"// modules/saleFlow/responseHandler.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendSaleResponse(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('SatÄ±ÅŸ cevabÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// SatÄ±ÅŸ cevabÄ±nÄ± iÅŸleme - GÃœNCELLENDÄ°\nasync function handleSaleResponse(message, response, services) {\n  const cleanResponse = response.toLowerCase().trim();\n  \n  console.log(`ğŸ’° SatÄ±ÅŸ cevabÄ± iÅŸleniyor: \"${cleanResponse}\"`);\n  \n  // Olumlu cevaplar\n  const positiveResponses = ['evet', 'yes', 'ok', 'tamam', 'baÅŸla', 'baÅŸlayalÄ±m', 'oluÅŸtur', 'yapalÄ±m', 'âœ…', 'ğŸ‘'];\n  \n  // Olumsuz cevaplar\n  const negativeResponses = ['hayÄ±r', 'no', 'yok', 'later', 'sonra', 'âŒ', 'ğŸ‘'];\n  \n  if (isPositiveResponse(cleanResponse, positiveResponses)) {\n    // Olumlu cevap - YeÅŸil Sigorta soru-cevap akÄ±ÅŸÄ±nÄ± baÅŸlat\n    await handlePositiveResponse(message, services);\n    \n  } else if (isNegativeResponse(cleanResponse, negativeResponses)) {\n    // Olumsuz cevap\n    await handleNegativeResponse(message);\n    \n  } else {\n    // AnlaÅŸÄ±lamayan cevap\n    await handleUnknownResponse(message);\n  }\n}\n\n// Olumlu cevap kontrolÃ¼\nfunction isPositiveResponse(response, positiveResponses) {\n  return positiveResponses.some(pos => response.includes(pos));\n}\n\n// Olumsuz cevap kontrolÃ¼\nfunction isNegativeResponse(response, negativeResponses) {\n  return negativeResponses.some(neg => response.includes(neg));\n}\n\n// Olumlu cevap iÅŸleme - GÃœNCELLENDÄ°\nasync function handlePositiveResponse(message, services) {\n  await sendSaleResponse(message, 'ğŸ‰ Harika! YeÅŸil Sigorta poliÃ§enizi oluÅŸturmaya baÅŸlÄ±yorum...');\n  \n  // YeÅŸil Sigorta servisini bul\n  const serviceFinder = require('./serviceFinder');\n  const yesilSigortaService = serviceFinder.findYesilSigortaService(services);\n  \n  if (yesilSigortaService) {\n    // SatÄ±ÅŸ zamanlayÄ±cÄ±sÄ±nÄ± temizle\n    const timeoutManager = require('./timeoutManager');\n    timeoutManager.clearSaleTimer(message.from);\n    \n    // YeÅŸil Sigorta akÄ±ÅŸÄ±nÄ± baÅŸlat\n    const serviceFlow = require('../serviceFlow');\n    await serviceFlow.startServiceFlow(message, yesilSigortaService);\n  } else {\n    await sendSaleResponse(message, 'âŒ YeÅŸil Sigorta servisi bulunamadÄ±. LÃ¼tfen daha sonra tekrar deneyin.');\n    await endConversation(message);\n  }\n}\n\n// Olumsuz cevap iÅŸleme - GÃœNCELLENDÄ°\nasync function handleNegativeResponse(message) {\n  await sendSaleResponse(message, 'ğŸ‘ AnladÄ±m. YeÅŸil Sigorta ihtiyacÄ±nÄ±z olduÄŸunda buradayÄ±m! ğŸ›¡ï¸');\n  await endConversation(message);\n}\n\n// AnlaÅŸÄ±lamayan cevap iÅŸleme - GÃœNCELLENDÄ°\nasync function handleUnknownResponse(message) {\n  await sendSaleResponse(message, 'âŒ AnlayamadÄ±m. LÃ¼tfen *Evet* veya *HayÄ±r* olarak cevap verin.\\n\\n' +\n                     'âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\n' +\n                     'âŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli');\n}\n\n// KonuÅŸmayÄ± bitir\nasync function endConversation(message) {\n  const conversationManager = require('./conversationManager');\n  await conversationManager.endSaleConversation(message.from);\n  \n  const serviceLoader = require('../serviceLoader');\n  const menuHandler = require('../menuHandler');\n  \n  setTimeout(async () => {\n    await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n  }, 3000);\n}\n\nmodule.exports = {\n  handleSaleResponse,\n  isPositiveResponse,\n  isNegativeResponse,\n  handlePositiveResponse,\n  handleNegativeResponse,\n  handleUnknownResponse,\n  endConversation\n};","size_bytes":3852},"micro-modules/utils/getTimeBasedGreeting.js":{"content":"// micro-modules/utils/getTimeBasedGreeting.js\nfunction getTimeBasedGreeting() {\n  const hour = new Date().getHours();\n  \n  if (hour >= 5 && hour < 11) {\n    return 'gunaydin';\n  } else if (hour >= 11 && hour < 17) {\n    return 'merhaba'; \n  } else {\n    return 'iyi_aksamlar';\n  }\n}\n\nmodule.exports = getTimeBasedGreeting;","size_bytes":323},"micro-modules/service/startServiceFlow.js":{"content":"// micro-modules/service/startServiceFlow.js\nconst sessionManager = require('../../core/sessionManager');\nconst handlePriceList = require('./handlePriceList');\nconst askNextQuestion = require('./askNextQuestion');\n\nasync function startServiceFlow(message, service) {\n  const serviceData = service.data;\n  \n  console.log(`ğŸš€ Servis baÅŸlatÄ±lÄ±yor: ${service.name}, Kategori: ${service.category}`);\n  \n  if (service.category === 'fiyat_listeleri') {\n    await handlePriceList(message, service);\n    return;\n  }\n  \n  sessionManager.updateUserSession(message.from, {\n    currentService: service,\n    currentQuestions: serviceData.questions || [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: serviceData.service_name,\n    currentState: 'in_service'\n  });\n\n  await message.reply(serviceData.bot_greeting);\n  \n  const session = sessionManager.getUserSession(message.from);\n  if (session.currentQuestions.length > 0) {\n    await askNextQuestion(message, session);\n  } else {\n    const completeServiceFlow = require('./completeServiceFlow');\n    await completeServiceFlow(message, session);\n  }\n}\n\nmodule.exports = startServiceFlow;","size_bytes":1154},"modules/menuHandler.js":{"content":"// modules/menuHandler.js - ANA YÃ–NLENDÄ°RÄ°CÄ° DOSYA\nconst mainMenu = require('./menuHandler/mainMenu');\nconst subMenu = require('./menuHandler/subMenu');\nconst numberHandler = require('./menuHandler/numberHandler');\nconst serviceConverter = require('./menuHandler/serviceConverter');\nconst categoryManager = require('./menuHandler/categoryManager');\nconst navigation = require('./menuHandler/navigation');\n\n// Ana menÃ¼ gÃ¶ster\nasync function showMainMenu(message, services) {\n  await mainMenu.showMainMenu(message, services);\n}\n\n// SayÄ± seÃ§imini iÅŸle\nasync function handleNumberSelection(message, number, services) {\n  await numberHandler.handleNumberSelection(message, number, services);\n}\n\n// Alt menÃ¼ seÃ§imini iÅŸle\nasync function handleSubMenuSelection(message, number, categoryName, services) {\n  await subMenu.handleSubMenuSelection(message, number, categoryName, services);\n}\n\n// Kategori seÃ§eneklerini gÃ¶ster\nasync function showCategoryOptions(message, category, services) {\n  await subMenu.showCategoryOptions(message, category, services);\n}\n\n// Servis anahtarÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r\nfunction convertToServiceKey(categoryName) {\n  return serviceConverter.convertToServiceKey(categoryName);\n}\n\n// Ana menÃ¼ye dÃ¶n\nasync function returnToMainMenu(message, services, contactName = '') {\n  await navigation.returnToMainMenu(message, services, contactName);\n}\n\nmodule.exports = {\n  showMainMenu,\n  handleNumberSelection,\n  handleSubMenuSelection,\n  showCategoryOptions,\n  convertToServiceKey,\n  returnToMainMenu,\n  \n  // Alt modÃ¼llere eriÅŸim iÃ§in\n  mainMenu,\n  subMenu,\n  numberHandler,\n  serviceConverter,\n  categoryManager,\n  navigation\n};","size_bytes":1654},"micro-modules/session/stopMenuTimer.js":{"content":"// micro-modules/session/stopMenuTimer.js\nconst sessionManager = require('../../core/sessionManager');\n\nfunction stopMenuTimer(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.menuTimer) {\n    clearTimeout(session.menuTimer);\n    sessionManager.updateUserSession(userId, { \n      waitingForResponse: false, \n      menuTimer: null\n    });\n  }\n}\n\nmodule.exports = stopMenuTimer;","size_bytes":419},"modules/serviceFlow.js":{"content":"// modules/serviceFlow.js - GÃœNCELLENDÄ°\nconst fs = require('fs');\nconst path = require('path');\nconst logger = require('./logger');\nconst sessionManager = require('./sessionManager');\nconst validationUtils = require('./validationUtils');\nconst { sendMessageWithoutQuote } = require('./utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendServiceMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('Servis mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// Servis akÄ±ÅŸÄ±nÄ± baÅŸlat - GÃœNCELLENDÄ°\nasync function startServiceFlow(message, service) {\n  const serviceData = service.data;\n  \n  console.log(`ğŸš€ Servis baÅŸlatÄ±lÄ±yor: ${service.name}, Kategori: ${service.category}`);\n  \n  // FÄ°YAT LÄ°STESÄ° Ä°SE Ã–ZEL Ä°ÅLEM\n  if (service.category === 'fiyat_listeleri') {\n    await handlePriceList(message, service);\n    return;\n  }\n  \n  // NORMAL SERVÄ°S Ä°SE SORU-CEVAP AKIÅI\n  sessionManager.updateUserSession(message.from, {\n    currentService: service,\n    currentQuestions: serviceData.questions || [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: serviceData.service_name,\n    currentState: 'in_service'\n  });\n\n  await sendServiceMessage(message, serviceData.bot_greeting);\n  \n  const session = sessionManager.getUserSession(message.from);\n  if (session.currentQuestions.length > 0) {\n    await askNextQuestion(message, session);\n  } else {\n    await completeServiceFlow(message, session);\n  }\n}\n\n// Fiyat listesi iÅŸleme - GÃœNCELLENDÄ°\nasync function handlePriceList(message, service) {\n  const priceData = service.data;\n  \n  console.log(`ğŸ’° Fiyat listesi iÅŸleniyor: ${service.name}`, priceData);\n  \n  let priceText = `ğŸ’° *${service.name.replace(/_/g, ' ').toUpperCase()}*\\n\\n`;\n  \n  if (priceData.fiyat_tablosu) {\n    // YeÅŸil Sigorta fiyat formatÄ±\n    for (const [aracTipi, fiyatlar] of Object.entries(priceData.fiyat_tablosu)) {\n      priceText += `*${aracTipi}:*\\n`;\n      for (const [sure, fiyat] of Object.entries(fiyatlar)) {\n        const sureText = sure.replace('_gun', ' gÃ¼n').replace('15_gun', '15 gÃ¼n').replace('30_gun', '30 gÃ¼n').replace('90_gun', '90 gÃ¼n');\n        priceText += `  â€¢ ${sureText}: ${fiyat}\\n`;\n      }\n      priceText += '\\n';\n    }\n  }\n  \n  // Ã–NEMLÄ° BÄ°LGÄ°LENDÄ°RME ekle\n  if (priceData.Ã¶nemli_bilgilendirme) {\n    priceText += `âš ï¸ *Ã–nemli Bilgilendirme:*\\n${priceData.Ã¶nemli_bilgilendirme}\\n\\n`;\n  }\n  \n  // AÃ‡IKLAMA ekle\n  if (priceData.aciklama) {\n    priceText += `ğŸ“ *AÃ§Ä±klama:* ${priceData.aciklama}\\n\\n`;\n  }\n  \n  await sendServiceMessage(message, priceText);\n  \n  // 2 saniye bekle ve satÄ±ÅŸ teklifini gÃ¶ster\n  setTimeout(async () => {\n    try {\n      const saleFlow = require('./saleFlow');\n      await saleFlow.askForSale(message);\n    } catch (error) {\n      logger.error(`SatÄ±ÅŸ teklifi hatasÄ±: ${error.message}`);\n      console.log('âŒ SatÄ±ÅŸ teklifi gÃ¶sterilemedi:', error.message);\n      \n      // Fallback: Ana menÃ¼ye dÃ¶n\n      const serviceLoader = require('./serviceLoader');\n      const menuHandler = require('./menuHandler');\n      await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n    }\n  }, 2000);\n}\n\n// Sonraki soruyu sor - GÃœNCELLENDÄ°\nasync function askNextQuestion(message, session) {\n  const currentQuestion = session.currentQuestions[session.currentQuestionIndex];\n  \n  if (currentQuestion) {\n    let questionText = `ğŸ“ *Soru ${session.currentQuestionIndex + 1}/${session.currentQuestions.length}*\\n\\n`;\n    questionText += `${currentQuestion.question}`;\n    \n    if (currentQuestion.field_type === 'number') {\n      questionText += `\\n\\nğŸ’¡ *LÃ¼tfen sadece sayÄ± giriniz.*`;\n    } else if (currentQuestion.field_type === 'date') {\n      questionText += `\\n\\nğŸ’¡ *Format: GÃ¼n/Ay/YÄ±l (Ã–rnek: 15/01/2024)*`;\n    } else if (currentQuestion.field_type === 'phone') {\n      questionText += `\\n\\nğŸ’¡ *Format: 5XX XXX XX XX*`;\n    }\n    \n    await sendServiceMessage(message, questionText);\n    \n    sessionManager.updateUserSession(message.from, {\n      currentState: 'collecting_answer',\n      waitingForResponse: true\n    });\n  } else {\n    await completeServiceFlow(message, session);\n  }\n}\n\n// CevabÄ± iÅŸle - GÃœNCELLENDÄ°\nasync function handleAnswer(message, answer, session) {\n  const currentQuestion = session.currentQuestions[session.currentQuestionIndex];\n  const fieldName = currentQuestion.field_name;\n  \n  const validationResult = validationUtils.validateAnswer(answer, currentQuestion.field_type);\n  \n  if (!validationResult.isValid) {\n    await sendServiceMessage(message, `âŒ ${validationResult.errorMessage}\\n\\nLÃ¼tfen tekrar cevap verin:`);\n    return false;\n  }\n  \n  const updatedAnswers = {\n    ...session.collectedAnswers,\n    [fieldName]: validationResult.cleanedValue\n  };\n  \n  sessionManager.updateUserSession(message.from, {\n    collectedAnswers: updatedAnswers,\n    currentQuestionIndex: session.currentQuestionIndex + 1\n  });\n  \n  const updatedSession = sessionManager.getUserSession(message.from);\n  if (updatedSession.currentQuestionIndex < updatedSession.currentQuestions.length) {\n    await askNextQuestion(message, updatedSession);\n  } else {\n    await completeServiceFlow(message, updatedSession);\n  }\n  \n  return true;\n}\n\n// Servis akÄ±ÅŸÄ±nÄ± tamamla - GÃœNCELLENDÄ°\nasync function completeServiceFlow(message, session) {\n  if (!session.currentService || !session.currentService.data) {\n    console.log('âŒ Servis verisi bulunamadÄ±');\n    await sendServiceMessage(message, 'âŒ Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    \n    const serviceLoader = require('./serviceLoader');\n    const menuHandler = require('./menuHandler');\n    await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n    return;\n  }\n  \n  const serviceData = session.currentService.data;\n  const serviceName = serviceData.service_name || session.currentService.name || 'Servis';\n  \n  console.log(`âœ… Servis tamamlandÄ±: ${serviceName}`);\n  console.log(`ğŸ“Š Toplanan cevaplar:`, session.collectedAnswers);\n  \n  let completionText = `ğŸ‰ *${serviceName}* baÅŸvurunuz tamamlandÄ±!\\n\\n`;\n  \n  if (session.currentQuestions.length > 0) {\n    completionText += `âœ… Toplam ${session.currentQuestions.length} soru cevaplandÄ±.\\n\\n`;\n  }\n  \n  completionText += serviceData.completion_message || 'En kÄ±sa sÃ¼rede size dÃ¶nÃ¼ÅŸ yapacaÄŸÄ±z.';\n\n  await sendServiceMessage(message, completionText);\n  \n  // Sadece normal servisler iÃ§in kaydet (fiyat listeleri deÄŸil)\n  if (session.currentService.category !== 'fiyat_listeleri') {\n    await saveServiceApplication(session);\n  }\n  \n  sessionManager.updateUserSession(message.from, {\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: null\n  });\n  \n  const serviceLoader = require('./serviceLoader');\n  const menuHandler = require('./menuHandler');\n  \n  setTimeout(async () => {\n    await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n  }, 2000);\n}\n\n// Servis baÅŸvurusunu kaydet\nasync function saveServiceApplication(session) {\n  try {\n    const applicationData = {\n      service: session.serviceFlow,\n      answers: session.collectedAnswers,\n      timestamp: new Date().toISOString(),\n      userId: session.userId\n    };\n    \n    const applicationsDir = './applications';\n    if (!fs.existsSync(applicationsDir)) {\n      fs.mkdirSync(applicationsDir, { recursive: true });\n    }\n    \n    const filename = `application_${Date.now()}_${session.userId.replace('@c.us', '')}.json`;\n    fs.writeFileSync(\n      path.join(applicationsDir, filename),\n      JSON.stringify(applicationData, null, 2),\n      'utf8'\n    );\n    \n    logger.info(`BaÅŸvuru kaydedildi: ${filename}`);\n    console.log(`ğŸ“„ BaÅŸvuru kaydedildi: ${filename}`);\n    \n  } catch (error) {\n    logger.error(`BaÅŸvuru kaydetme hatasÄ±: ${error.message}`);\n    console.error('âŒ BaÅŸvuru kaydetme hatasÄ±:', error);\n  }\n}\n\nmodule.exports = {\n  startServiceFlow,\n  handlePriceList,\n  askNextQuestion,\n  handleAnswer,\n  completeServiceFlow,\n  saveServiceApplication\n};","size_bytes":8353},"micro-modules/menu/showMainMenu.js":{"content":"// micro-modules/menu/showMainMenu.js\nconst sessionManager = require('../../core/sessionManager');\nconst startMenuTimer = require('../session/startMenuTimer');\n\nasync function showMainMenu(message, services) {\n  let menuText = `ğŸ“‹ *ANA HÄ°ZMET KATEGORÄ°LERÄ°*\\n\\n`;\n  \n  const mainCategories = [\n    'ğŸ›¡ï¸  Sigorta Hizmetleri',\n    'ğŸ’» YazÄ±lÄ±m Talepleri', \n    'ğŸ”’ Siber GÃ¼venlik',\n    'ğŸšš Lojistik Hizmetleri',\n    'ğŸŒ Ä°thalat Ä°hracat',\n    'ğŸ“Š Profesyonel Denetleme',\n    'ğŸ  Ä°nÅŸaat Emlak',\n    'ğŸ¤ CRM Hizmetleri',\n    'ğŸ‘• Tekstil ÃœrÃ¼nleri',\n    'ğŸ’„ Kozmetik ÃœrÃ¼nleri',\n    'âœˆï¸  Tur Organizasyon',\n    'â˜€ï¸  GÃ¼neÅŸ Enerjisi',\n    'ğŸ¢ Kurumsal Hizmetler'\n  ];\n  \n  mainCategories.forEach((category, index) => {\n    menuText += `${index + 1}. ${category}\\n`;\n  });\n  \n  menuText += `\\nÄ°lgilendiÄŸiniz hizmetin *numarasÄ±nÄ±* yazÄ±n veya *doÄŸrudan hizmet adÄ±nÄ±* belirtin.`;\n  \n  await message.reply(menuText);\n  \n  startMenuTimer(message.from, message, services);\n}\n\nmodule.exports = showMainMenu;","size_bytes":1045},"modules/menuHandler/categoryManager.js":{"content":"// modules/menuHandler/categoryManager.js\nconst logger = require('../logger');\n\n// Kategori verilerini yÃ¼kle\nfunction loadCategoryData(categoryName, services) {\n  console.log(`ğŸ“ Kategori yÃ¼kleniyor: ${categoryName}`);\n  \n  // Ã–nce ana kategorilerde ara\n  if (services[categoryName]) {\n    return services[categoryName];\n  }\n  \n  // Alternatif isimlerle dene\n  const alternativeNames = getAlternativeCategoryNames(categoryName);\n  for (const altName of alternativeNames) {\n    if (services[altName]) {\n      console.log(`ğŸ”„ Alternatif kategori bulundu: ${altName}`);\n      return services[altName];\n    }\n  }\n  \n  console.log(`âŒ Kategori bulunamadÄ±: ${categoryName}`);\n  return null;\n}\n\n// Alternatif kategori isimlerini getir\nfunction getAlternativeCategoryNames(categoryName) {\n  const alternatives = [];\n  \n  // \"_ana\" ekle/Ã§Ä±kar\n  if (categoryName.includes('_ana')) {\n    alternatives.push(categoryName.replace('_ana', ''));\n  } else {\n    alternatives.push(categoryName + '_ana');\n  }\n  \n  // \"_kategori\" ekle/Ã§Ä±kar\n  if (categoryName.includes('_kategori')) {\n    alternatives.push(categoryName.replace('_kategori', ''));\n  } else {\n    alternatives.push(categoryName + '_kategori');\n  }\n  \n  // \"_hizmetleri\" ekle/Ã§Ä±kar\n  if (categoryName.includes('_hizmetleri')) {\n    alternatives.push(categoryName.replace('_hizmetleri', ''));\n  } else {\n    alternatives.push(categoryName + '_hizmetleri');\n  }\n  \n  return alternatives.filter((value, index, self) => self.indexOf(value) === index);\n}\n\n// Kategori seÃ§eneklerini doÄŸrula\nfunction validateCategoryOptions(categoryData) {\n  if (!categoryData || !categoryData.category_options) {\n    return { isValid: false, error: 'Kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  const options = categoryData.category_options;\n  const validOptions = options.filter(opt => \n    opt.option_number && opt.category_name && opt.category_name.trim().length > 0\n  );\n  \n  if (validOptions.length === 0) {\n    return { isValid: false, error: 'GeÃ§erli kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  return { \n    isValid: true, \n    options: validOptions,\n    count: validOptions.length \n  };\n}\n\n// Kategori bilgilerini getir\nfunction getCategoryInfo(categoryName, services) {\n  const categoryData = loadCategoryData(categoryName, services);\n  if (!categoryData) {\n    return null;\n  }\n  \n  return {\n    name: categoryName,\n    displayName: categoryData.bot_greeting || categoryName.replace(/_/g, ' '),\n    options: categoryData.category_options || [],\n    completionMessage: categoryData.completion_message || 'LÃ¼tfen bir numara seÃ§in:'\n  };\n}\n\nmodule.exports = {\n  loadCategoryData,\n  getAlternativeCategoryNames,\n  validateCategoryOptions,\n  getCategoryInfo\n};","size_bytes":2714},"modules/messageHandler/sessionRouter.js":{"content":"// modules/messageHandler/sessionRouter.js - CALLBACK VERSÄ°YON\nconst sessionManager = require('../sessionManager');\nconst serviceLoader = require('../serviceLoader');\nconst menuHandler = require('../menuHandler');\nconst serviceFlow = require('../serviceFlow');\nconst greetingManager = require('./greetingManager');\nconst serviceMatcher = require('./serviceMatcher');\nconst messageParser = require('./messageParser');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendResponse(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    // Fallback: normal reply\n    await message.reply(text);\n  }\n}\n\n// Ana route fonksiyonu - CALLBACK EKLENDÄ°\nasync function route(message, parsedMessage, contactName = '', onServiceFound = null) {\n  const { greetingPart, servicePart, cleanMessage, originalMessage } = parsedMessage;\n  const services = serviceLoader.loadAllServices();\n  const session = sessionManager.getUserSession(message.from);\n  \n  console.log(`ğŸ” Route: Durum=${session?.currentState}, Mesaj=${cleanMessage}`);\n  \n  // Servis bulundu callback'i\n  const serviceFound = () => {\n    if (onServiceFound && typeof onServiceFound === 'function') {\n      onServiceFound();\n    }\n  };\n  \n  // TEÅEKKÃœR MESAJLARI - EN Ã–NCELÄ°KLÄ°\n  if (messageParser.isThanksMessage(cleanMessage)) {\n    console.log(`ğŸ™ TeÅŸekkÃ¼r mesajÄ± algÄ±landÄ±`);\n    serviceFound();\n    await greetingManager.handleThanks(message, contactName);\n    return;\n  }\n  \n  // VEDALAÅMA MESAJLARI - Ã–NCELÄ°KLÄ°\n  if (messageParser.isGoodbyeMessage(cleanMessage)) {\n    console.log(`ğŸ‘‹ VedalaÅŸma mesajÄ± algÄ±landÄ±`);\n    serviceFound();\n    await greetingManager.handleGoodbye(message, contactName);\n    return;\n  }\n  \n  // Ã‡IKIÅ KOMUTLARI - Ã–NCELÄ°KLÄ°\n  if (isExitCommand(cleanMessage)) {\n    console.log(`ğŸšª Ã‡Ä±kÄ±ÅŸ komutu algÄ±landÄ±`);\n    serviceFound();\n    await handleExitCommand(message, services, contactName);\n    return;\n  }\n  \n  // DÄ°ÄER HÄ°ZMETLER Ä°STEÄÄ° - Ã–NCELÄ°KLÄ°\n  if (messageParser.isOtherServicesRequest(cleanMessage)) {\n    console.log(`ğŸ”„ DiÄŸer hizmetler isteÄŸi algÄ±landÄ±`);\n    serviceFound();\n    await handleOtherServicesRequest(message, services, contactName);\n    return;\n  }\n  \n  // MENÃœ Ä°STEÄÄ° - Ã–NCELÄ°KLÄ°\n  if (messageParser.isMenuRequest(cleanMessage)) {\n    console.log(`ğŸ“‹ MenÃ¼ isteÄŸi algÄ±landÄ±`);\n    serviceFound();\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    await menuHandler.showMainMenu(message, services);\n    return;\n  }\n  \n  // Ã–NCE: SatÄ±ÅŸ cevabÄ± durumunu kontrol et\n  if (session && session.currentState === 'waiting_for_sale_response') {\n    serviceFound();\n    const saleFlow = require('../saleFlow');\n    await saleFlow.handleSaleResponse(message, cleanMessage, services);\n    return;\n  }\n  \n  // SONRA: Soru-cevap akÄ±ÅŸÄ±\n  if (session && session.currentState === 'collecting_answer') {\n    serviceFound();\n    const success = await serviceFlow.handleAnswer(message, cleanMessage, session);\n    return;\n  }\n  \n  // SAYI SEÃ‡Ä°MÄ° - Ã–NCELÄ°KLÄ°\n  if (messageParser.isNumberInput(cleanMessage)) {\n    const number = parseInt(cleanMessage);\n    console.log(`ğŸ”¢ SayÄ± seÃ§imi algÄ±landÄ±: ${number}, Durum: ${session?.currentState}`);\n    serviceFound();\n    await menuHandler.handleNumberSelection(message, number, services);\n    return;\n  }\n  \n  // YARDIM Ä°STEÄÄ°\n  if (messageParser.isHelpRequest(cleanMessage)) {\n    console.log(`â“ YardÄ±m isteÄŸi algÄ±landÄ±`);\n    serviceFound();\n    await handleHelpRequest(message, services, contactName);\n    return;\n  }\n  \n  // Ä°PTAL Ä°STEÄÄ°\n  if (messageParser.isCancelRequest(cleanMessage)) {\n    console.log(`â¹ï¸ Ä°ptal isteÄŸi algÄ±landÄ±`);\n    serviceFound();\n    await handleCancelRequest(message, services, contactName);\n    return;\n  }\n  \n  // EÄŸer selamlama varsa, Ã¶nce selamla\n  if (greetingPart && messageParser.isGreeting(greetingPart)) {\n    serviceFound();\n    await greetingManager.handleGreeting(message, services, contactName);\n    \n    // EÄŸer selamlamadan sonra iÅŸlem de varsa, 2 saniye bekle ve iÅŸlemi baÅŸlat\n    if (servicePart && servicePart.length > 0) {\n      setTimeout(async () => {\n        await processServiceRequest(message, servicePart, services, serviceFound);\n      }, 2000);\n      return;\n    }\n    return;\n  }\n  \n  // Sadece iÅŸlem varsa, direkt iÅŸlemi baÅŸlat\n  if (servicePart && servicePart.length > 0) {\n    await processServiceRequest(message, servicePart, services, serviceFound);\n    return;\n  }\n  \n  // Bilinmeyen mesaj - Hugging Face denenebilir (callback Ã§aÄŸrÄ±lmaz)\n  console.log('ğŸ” Bilinmeyen mesaj tÃ¼rÃ¼ - Hugging Face denenebilir');\n  await handleUnknownMessage(message, services, contactName);\n}\n\n// Process Service Request - CALLBACK EKLENDÄ°\nasync function processServiceRequest(message, serviceRequest, services, serviceFound = null) {\n  console.log(`ğŸ” Servis isteÄŸi iÅŸleniyor: \"${serviceRequest}\"`);\n  \n  // Ã–zel durumlar - servis olarak aranmamalÄ±\n  if (serviceRequest.toLowerCase().includes('menÃ¼') || serviceRequest.toLowerCase().includes('menu')) {\n    console.log(`ğŸ“‹ MenÃ¼ isteÄŸi - servis olarak aranmayacak`);\n    if (serviceFound) serviceFound();\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    await menuHandler.showMainMenu(message, services);\n    return;\n  }\n  \n  // AnlamsÄ±z mesaj kontrolÃ¼\n  if (isMeaninglessMessage(serviceRequest)) {\n    console.log(`â“ AnlamsÄ±z mesaj algÄ±landÄ±`);\n    if (serviceFound) serviceFound();\n    await handleMeaninglessMessage(message, services);\n    return;\n  }\n  \n  const matchedService = serviceMatcher.findMatchingService(serviceRequest, services);\n  \n  if (matchedService) {\n    console.log(`âœ… Servis eÅŸleÅŸti: ${matchedService.type} - ${matchedService.name}`);\n    if (serviceFound) serviceFound();\n    \n    // DÄ°YALOG TÄ°PÄ° CEVAPLAR Ä°Ã‡Ä°N\n    if (matchedService.type === 'diyalog') {\n      await sendResponse(message, matchedService.data.cevap);\n      return;\n    }\n    \n    if (matchedService.type === 'category') {\n      await menuHandler.showCategoryOptions(message, matchedService, services);\n      sessionManager.updateUserSession(message.from, { currentState: `submenu_${matchedService.name}` });\n    } else {\n      await serviceFlow.startServiceFlow(message, matchedService);\n    }\n  } else {\n    console.log(`âŒ Servis eÅŸleÅŸmedi: \"${serviceRequest}\"`);\n    // Servis bulunamadÄ± - callback Ã§aÄŸrÄ±lmaz (Hugging Face devreye girer)\n    await handleUnknownMessage(message, services);\n  }\n}\n\n// Kalan fonksiyonlar aynÄ± kalacak...\n// [isExitCommand, handleExitCommand, handleOtherServicesRequest, handleHelpRequest, \n//  handleCancelRequest, isMeaninglessMessage, handleMeaninglessMessage, handleUnknownMessage]\n\n// Ã‡Ä±kÄ±ÅŸ komutu kontrolÃ¼\nfunction isExitCommand(message) {\n  const exitCommands = ['Ã§Ä±kÄ±ÅŸ', 'Ã§Ä±kÄ±s', 'exit', 'quit', 'geri', 'ana menÃ¼', 'ana menu', 'menÃ¼ye dÃ¶n', 'menuye don', 'back', 'return'];\n  return exitCommands.some(cmd => message.includes(cmd));\n}\n\n// Ã‡Ä±kÄ±ÅŸ komutu iÅŸleme\nasync function handleExitCommand(message, services, contactName = '') {\n  sessionManager.updateUserSession(message.from, { \n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  const personalization = require('./personalization');\n  const exitText = contactName ? \n    `ğŸ‘‹ ${contactName}, ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z!` :\n    `ğŸ‘‹ Ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z!`;\n  \n  await sendResponse(message, exitText);\n  await menuHandler.showMainMenu(message, services);\n}\n\n// DiÄŸer hizmetler isteÄŸi iÅŸleme\nasync function handleOtherServicesRequest(message, services, contactName = '') {\n  console.log(`ğŸ” DiÄŸer hizmetler isteÄŸi algÄ±landÄ±`);\n  \n  const personalization = require('./personalization');\n  const otherServicesText = contactName ? \n    `ğŸ”„ ${contactName}, diÄŸer hizmetlerimizi gÃ¶steriyorum...` :\n    `ğŸ”„ DiÄŸer hizmetlerimizi gÃ¶steriyorum...`;\n  \n  await sendResponse(message, otherServicesText);\n  \n  // Ana menÃ¼yÃ¼ gÃ¶ster\n  sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n  await menuHandler.showMainMenu(message, services);\n}\n\n// YardÄ±m isteÄŸi iÅŸleme\nasync function handleHelpRequest(message, services, contactName = '') {\n  const personalization = require('./personalization');\n  const helpText = contactName ? \n    `â“ ${contactName}, size nasÄ±l yardÄ±mcÄ± olabilirim?\\n\\n` :\n    `â“ Size nasÄ±l yardÄ±mcÄ± olabilirim?\\n\\n`;\n  \n  await sendResponse(message, helpText +\n    `â€¢ Bir hizmet adÄ± yazÄ±n (Ã¶rnek: \"sigorta\", \"yazÄ±lÄ±m\")\\n` +\n    `â€¢ \"menÃ¼\" yazarak tÃ¼m seÃ§enekleri gÃ¶rebilirsiniz\\n` +\n    `â€¢ SayÄ± yazarak seÃ§im yapabilirsiniz\\n` +\n    `â€¢ \"Ã§Ä±kÄ±ÅŸ\" yazarak ana menÃ¼ye dÃ¶nebilirsiniz\\n` +\n    `â€¢ \"teÅŸekkÃ¼r ederim\" diyerek konuÅŸmayÄ± bitirebilirsiniz`);\n}\n\n// Ä°ptal isteÄŸi iÅŸleme\nasync function handleCancelRequest(message, services, contactName = '') {\n  sessionManager.updateUserSession(message.from, { \n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  const personalization = require('./personalization');\n  const cancelText = contactName ? \n    `â¹ï¸ ${contactName}, iÅŸleminiz iptal edildi. Ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z.` :\n    `â¹ï¸ Ä°ÅŸleminiz iptal edildi. Ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z.`;\n  \n  await sendResponse(message, cancelText);\n  await menuHandler.showMainMenu(message, services);\n}\n\n// AnlamsÄ±z mesaj kontrolÃ¼\nfunction isMeaninglessMessage(message) {\n  const meaninglessPatterns = [\n    /^[\\u{1F600}-\\u{1F64F}]+$/u, // Sadece emoji\n    /^[^\\w\\s]+$/, // Sadece Ã¶zel karakterler\n    /^.{1,2}$/, // 1-2 karakter\n    /^(.)\\1+$/, // AynÄ± karakterin tekrarÄ± (aaa, ???)\n  ];\n  \n  return meaninglessPatterns.some(pattern => pattern.test(message));\n}\n\n// AnlamsÄ±z mesaj iÅŸleme\nasync function handleMeaninglessMessage(message, services) {\n  await sendResponse(message, `ğŸ¤” AnlayamadÄ±m. LÃ¼tfen:\\n\\n` +\n    `â€¢ Bir hizmet adÄ± yazÄ±n\\n` +\n    `â€¢ \"menÃ¼\" yazarak seÃ§enekleri gÃ¶rÃ¼n\\n` +\n    `â€¢ \"yardÄ±m\" yazarak destek alÄ±n`);\n}\n\n// Bilinmeyen mesaj iÅŸleme\nasync function handleUnknownMessage(message, services, contactName = '') {\n  const personalization = require('./personalization');\n  const unknownText = personalization.createPersonalizedUnknownMessage(contactName);\n  \n  await sendResponse(message, `${unknownText}\\n\\n` +\n    `â€¢ \"sigorta\" - Sigorta hizmetleri\\n` +\n    `â€¢ \"yazÄ±lÄ±m\" - YazÄ±lÄ±m geliÅŸtirme\\n` +\n    `â€¢ \"lojistik\" - Nakliye hizmetleri\\n` +\n    `â€¢ \"diÄŸer hizmetler\" - TÃ¼m seÃ§enekleri gÃ¶rÃ¼n\\n` +\n    `â€¢ Veya diÄŸer hizmetlerimiz...\\n\\n` +\n    `YardÄ±m iÃ§in \"menÃ¼\" yazabilirsiniz.\\n` +\n    `Ã‡Ä±kmak iÃ§in \"Ã§Ä±kÄ±ÅŸ\" yazabilirsiniz.`);\n}\n\nmodule.exports = {\n  route,\n  processServiceRequest,\n  handleUnknownMessage,\n  handleExitCommand,\n  handleOtherServicesRequest,\n  handleHelpRequest,\n  handleCancelRequest\n};","size_bytes":11249},"modules/menuHandler/navigation.js":{"content":"// modules/menuHandler/navigation.js\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\n\n// Ana menÃ¼ye dÃ¶n\nasync function returnToMainMenu(message, services, contactName = '') {\n  console.log(`ğŸ  Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor`);\n  \n  sessionManager.updateUserSession(message.from, { \n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  const mainMenu = require('./mainMenu');\n  \n  if (contactName) {\n    await message.reply(`ğŸ‘‹ ${contactName}, ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z!`);\n  }\n  \n  await mainMenu.showMainMenu(message, services);\n}\n\n// Ã–nceki menÃ¼ye dÃ¶n\nasync function goBackToPreviousMenu(message, services, currentState) {\n  console.log(`â†©ï¸ Ã–nceki menÃ¼ye dÃ¶nÃ¼lÃ¼yor: ${currentState}`);\n  \n  if (currentState.startsWith('submenu_')) {\n    const categoryName = currentState.replace('submenu_', '');\n    const categoryManager = require('./categoryManager');\n    const subMenu = require('./subMenu');\n    \n    const categoryData = categoryManager.loadCategoryData(categoryName, services);\n    if (categoryData) {\n      await subMenu.showCategoryOptions(message, { data: categoryData, name: categoryName }, services);\n      return;\n    }\n  }\n  \n  // Ã–nceki menÃ¼ bulunamazsa ana menÃ¼ye dÃ¶n\n  await returnToMainMenu(message, services);\n}\n\n// MenÃ¼ geÃ§miÅŸini yÃ¶net\nfunction updateMenuHistory(userId, newState) {\n  const session = sessionManager.getUserSession(userId);\n  const history = session.menuHistory || [];\n  \n  // Son state'i history'e ekle (tekrarlarÄ± Ã¶nle)\n  if (history.length === 0 || history[history.length - 1] !== session.currentState) {\n    history.push(session.currentState);\n  }\n  \n  // History'yi sÄ±nÄ±rla (max 10)\n  if (history.length > 10) {\n    history.shift();\n  }\n  \n  sessionManager.updateUserSession(userId, { \n    menuHistory: history,\n    currentState: newState\n  });\n  \n  return history;\n}\n\n// MenÃ¼ durumunu kontrol et\nfunction getMenuStateInfo(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (!session) return null;\n  \n  return {\n    currentState: session.currentState,\n    menuHistory: session.menuHistory || [],\n    inService: session.currentService !== null,\n    waitingForResponse: session.waitingForResponse || false\n  };\n}\n\n// MenÃ¼ zaman aÅŸÄ±mÄ±nÄ± kontrol et\nfunction checkMenuTimeout(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (!session || !session.lastActivity) return false;\n  \n  const timeoutDuration = 10 * 60 * 1000; // 10 dakika\n  const timeSinceLastActivity = Date.now() - session.lastActivity;\n  \n  return timeSinceLastActivity > timeoutDuration;\n}\n\nmodule.exports = {\n  returnToMainMenu,\n  goBackToPreviousMenu,\n  updateMenuHistory,\n  getMenuStateInfo,\n  checkMenuTimeout\n};","size_bytes":2827},"modules/menuHandler/numberHandler.js":{"content":"// modules/menuHandler/numberHandler.js - TAMAMEN GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendNumberMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('SayÄ± mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// SayÄ± seÃ§imini iÅŸleme\nasync function handleNumberSelection(message, number, services) {\n  const session = sessionManager.getUserSession(message.from);\n  const currentState = session?.currentState || 'main_menu';\n\n  console.log(`ğŸ”¢ SayÄ± iÅŸleniyor: ${number}, Durum: ${currentState}`);\n\n  // Alt menÃ¼ durumu kontrolÃ¼\n  if (currentState.startsWith('submenu_')) {\n    const categoryName = currentState.replace('submenu_', '');\n    const subMenu = require('./subMenu');\n    await subMenu.handleSubMenuSelection(message, number, categoryName, services);\n    return;\n  }\n\n  // Ana menÃ¼ durumu\n  const mainMenu = require('./mainMenu');\n  const mainCategories = mainMenu.getMainCategories();\n\n  // SayÄ± aralÄ±ÄŸÄ±nÄ± kontrol et\n  if (number >= 1 && number <= mainCategories.length) {\n    const selectedCategory = mainCategories[number - 1];\n    const categoryData = services[selectedCategory];\n    \n    if (categoryData) {\n      console.log(`âœ… Kategori seÃ§ildi: ${selectedCategory}`);\n      const subMenu = require('./subMenu');\n      await subMenu.showCategoryOptions(message, { data: categoryData, name: selectedCategory }, services);\n      sessionManager.updateUserSession(message.from, { currentState: `submenu_${selectedCategory}` });\n    } else {\n      console.log(`âŒ Kategori verisi bulunamadÄ±: ${selectedCategory}`);\n      await sendNumberMessage(message, 'âŒ Bu kategori bulunamadÄ±. LÃ¼tfen tekrar deneyin.');\n      \n      // Ana menÃ¼yÃ¼ tekrar gÃ¶ster\n      setTimeout(async () => {\n        await mainMenu.showMainMenu(message, services);\n      }, 1000);\n    }\n  } else {\n    console.log(`âŒ GeÃ§ersiz sayÄ± aralÄ±ÄŸÄ±: ${number}, Beklenen: 1-${mainCategories.length}`);\n    await sendNumberMessage(message, `âŒ GeÃ§ersiz numara. LÃ¼tfen 1-${mainCategories.length} arasÄ± bir numara girin.`);\n    \n    // Ana menÃ¼yÃ¼ tekrar gÃ¶ster\n    setTimeout(async () => {\n      await mainMenu.showMainMenu(message, services);\n    }, 1000);\n  }\n}\n\n// SayÄ± doÄŸrulama\nfunction validateNumberInput(number, min, max) {\n  console.log(`ğŸ” SayÄ± doÄŸrulanÄ±yor: ${number}, Min: ${min}, Max: ${max}`);\n  \n  // SayÄ±sal deÄŸilse\n  if (isNaN(number)) {\n    return { \n      isValid: false, \n      error: 'GeÃ§ersiz sayÄ± formatÄ±. LÃ¼tfen sadece rakam girin.' \n    };\n  }\n  \n  const parsedNumber = parseInt(number);\n  \n  // AralÄ±k kontrolÃ¼\n  if (parsedNumber < min || parsedNumber > max) {\n    return { \n      isValid: false, \n      error: `LÃ¼tfen ${min}-${max} arasÄ± bir numara girin` \n    };\n  }\n  \n  return { \n    isValid: true, \n    number: parsedNumber \n  };\n}\n\n// MenÃ¼ numaralarÄ±nÄ± formatla\nfunction formatMenuNumbers(options, startFrom = 1) {\n  console.log(`ğŸ“ MenÃ¼ numaralarÄ± formatlanÄ±yor: ${options.length} seÃ§enek, BaÅŸlangÄ±Ã§: ${startFrom}`);\n  \n  const formattedOptions = options.map((option, index) => {\n    // EÄŸer option_number zaten varsa, onu kullan\n    if (option.option_number) {\n      return option;\n    }\n    \n    // Yoksa yeni numara ata\n    return {\n      ...option,\n      option_number: startFrom + index\n    };\n  });\n  \n  console.log(`âœ… ${formattedOptions.length} seÃ§enek formatlandÄ±`);\n  return formattedOptions;\n}\n\n// GeÃ§erli sayÄ± aralÄ±ÄŸÄ±nÄ± getir\nfunction getValidNumberRange(session, services) {\n  const currentState = session?.currentState || 'main_menu';\n  \n  if (currentState.startsWith('submenu_')) {\n    const categoryName = currentState.replace('submenu_', '');\n    const categoryData = services[categoryName];\n    \n    if (categoryData && categoryData.category_options) {\n      const numbers = categoryData.category_options.map(opt => opt.option_number);\n      return {\n        min: Math.min(...numbers),\n        max: Math.max(...numbers),\n        count: numbers.length,\n        type: 'submenu'\n      };\n    }\n  } else {\n    // Ana menÃ¼\n    const mainMenu = require('./mainMenu');\n    const mainCategories = mainMenu.getMainCategories();\n    return {\n      min: 1,\n      max: mainCategories.length,\n      count: mainCategories.length,\n      type: 'main_menu'\n    };\n  }\n  \n  return {\n    min: 1,\n    max: 1,\n    count: 0,\n    type: 'unknown'\n  };\n}\n\n// Hata mesajÄ± gÃ¶nder\nasync function sendErrorMessage(message, session, services) {\n  const range = getValidNumberRange(session, services);\n  \n  let errorMessage = '';\n  \n  switch (range.type) {\n    case 'main_menu':\n      errorMessage = `âŒ GeÃ§ersiz numara. LÃ¼tfen 1-${range.max} arasÄ± bir numara girin.`;\n      break;\n    case 'submenu':\n      errorMessage = `âŒ GeÃ§ersiz numara. LÃ¼tfen ${range.min}-${range.max} arasÄ± bir numara girin.`;\n      break;\n    default:\n      errorMessage = 'âŒ GeÃ§ersiz seÃ§im. LÃ¼tfen menÃ¼den bir numara seÃ§in.';\n  }\n  \n  await sendNumberMessage(message, errorMessage);\n  \n  // Duruma gÃ¶re uygun menÃ¼yÃ¼ tekrar gÃ¶ster\n  setTimeout(async () => {\n    if (range.type === 'main_menu') {\n      const mainMenu = require('./mainMenu');\n      await mainMenu.showMainMenu(message, services);\n    } else if (range.type === 'submenu') {\n      const categoryName = session.currentState.replace('submenu_', '');\n      const categoryData = services[categoryName];\n      if (categoryData) {\n        const subMenu = require('./subMenu');\n        await subMenu.showCategoryOptions(message, { data: categoryData, name: categoryName }, services);\n      }\n    }\n  }, 1000);\n}\n\n// SayÄ± giriÅŸini iÅŸle (ana fonksiyon)\nasync function processNumberInput(message, input, services) {\n  const session = sessionManager.getUserSession(message.from);\n  const range = getValidNumberRange(session, services);\n  \n  console.log(`ğŸ”¢ SayÄ± iÅŸleniyor: \"${input}\", Durum: ${session?.currentState}, Beklenen aralÄ±k: ${range.min}-${range.max}`);\n  \n  // SayÄ±yÄ± doÄŸrula\n  const validation = validateNumberInput(input, range.min, range.max);\n  \n  if (!validation.isValid) {\n    console.log(`âŒ SayÄ± doÄŸrulama baÅŸarÄ±sÄ±z: ${validation.error}`);\n    await sendNumberMessage(message, `âŒ ${validation.error}`);\n    return false;\n  }\n  \n  const number = validation.number;\n  console.log(`âœ… SayÄ± doÄŸrulandÄ±: ${number}`);\n  \n  // SayÄ±yÄ± iÅŸle\n  await handleNumberSelection(message, number, services);\n  return true;\n}\n\n// Debug bilgilerini logla\nfunction logNumberProcessing(session, number, services) {\n  const range = getValidNumberRange(session, services);\n  \n  console.log('ğŸ” SAYI Ä°ÅLEME DEBUG:');\n  console.log(`- Mevcut durum: ${session?.currentState || 'main_menu'}`);\n  console.log(`- Girilen sayÄ±: ${number}`);\n  console.log(`- Beklenen aralÄ±k: ${range.min}-${range.max}`);\n  console.log(`- MenÃ¼ tipi: ${range.type}`);\n  console.log(`- SeÃ§enek sayÄ±sÄ±: ${range.count}`);\n  \n  if (range.type === 'submenu') {\n    const categoryName = session.currentState.replace('submenu_', '');\n    const categoryData = services[categoryName];\n    if (categoryData && categoryData.category_options) {\n      console.log(`- Mevcut seÃ§enekler:`, categoryData.category_options.map(opt => ({\n        num: opt.option_number,\n        name: opt.category_name\n      })));\n    }\n  }\n}\n\nmodule.exports = {\n  handleNumberSelection,\n  validateNumberInput,\n  formatMenuNumbers,\n  getValidNumberRange,\n  sendErrorMessage,\n  processNumberInput,\n  logNumberProcessing\n};","size_bytes":7744},"micro-modules/message/handleSaleResponse.js":{"content":"// micro-modules/message/handleSaleResponse.js\nconst findYesilSigortaService = require('../service/findYesilSigortaService');\nconst startServiceFlow = require('../service/startServiceFlow');\nconst endConversation = require('./endConversation');\n\nasync function handleSaleResponse(message, response, services) {\n  const cleanResponse = response.toLowerCase().trim();\n  \n  const positiveResponses = ['evet', 'yes', 'ok', 'tamam', 'baÅŸla', 'baÅŸlayalÄ±m', 'oluÅŸtur', 'yapalÄ±m', 'âœ…'];\n  const negativeResponses = ['hayÄ±r', 'no', 'yok', 'later', 'sonra', 'âŒ'];\n  \n  if (positiveResponses.some(pos => cleanResponse.includes(pos))) {\n    await message.reply('ğŸ‰ Harika! YeÅŸil Sigorta poliÃ§enizi oluÅŸturmaya baÅŸlÄ±yorum...');\n    \n    const yesilSigortaService = findYesilSigortaService(services);\n    if (yesilSigortaService) {\n      const sessionManager = require('../../core/sessionManager');\n      sessionManager.clearSaleTimer(message.from);\n      await startServiceFlow(message, yesilSigortaService);\n    } else {\n      await message.reply('âŒ YeÅŸil Sigorta servisi bulunamadÄ±. LÃ¼tfen daha sonra tekrar deneyin.');\n      await endConversation(message);\n    }\n    \n  } else if (negativeResponses.some(neg => cleanResponse.includes(neg))) {\n    await message.reply('ğŸ‘ AnladÄ±m. YeÅŸil Sigorta ihtiyacÄ±nÄ±z olduÄŸunda buradayÄ±m! ğŸ›¡ï¸');\n    await endConversation(message);\n    \n  } else {\n    await message.reply('âŒ AnlayamadÄ±m. LÃ¼tfen *Evet* veya *HayÄ±r* olarak cevap verin.\\n\\n' +\n                       'âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\n' +\n                       'âŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli');\n  }\n}\n\nmodule.exports = handleSaleResponse;","size_bytes":1709},"modules/menuHandler/mainMenu.js":{"content":"// modules/menuHandler/mainMenu.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// Ana menÃ¼ gÃ¶ster - GÃœNCELLENDÄ°\nasync function showMainMenu(message, services) {\n  let menuText = `ğŸ“‹ *ANA HÄ°ZMET KATEGORÄ°LERÄ°*\\n\\n`;\n  \n  const mainCategories = [\n    'ğŸ›¡ï¸  Sigorta Hizmetleri',\n    'ğŸ’» YazÄ±lÄ±m Talepleri', \n    'ğŸ”’ Siber GÃ¼venlik',\n    'ğŸšš Lojistik Hizmetleri',\n    'ğŸŒ Ä°thalat Ä°hracat',\n    'ğŸ“Š Profesyonel Denetleme',\n    'ğŸ  Ä°nÅŸaat Emlak',\n    'ğŸ¤ CRM Hizmetleri',\n    'ğŸ‘• Tekstil ÃœrÃ¼nleri',\n    'ğŸ’„ Kozmetik ÃœrÃ¼nleri',\n    'âœˆï¸  Tur Organizasyon',\n    'â˜€ï¸  GÃ¼neÅŸ Enerjisi',\n    'ğŸ¢ Kurumsal Hizmetler'\n  ];\n  \n  mainCategories.forEach((category, index) => {\n    menuText += `${index + 1}. ${category}\\n`;\n  });\n  \n  menuText += `\\nÄ°lgilendiÄŸiniz hizmetin *numarasÄ±nÄ±* yazÄ±n veya *doÄŸrudan hizmet adÄ±nÄ±* belirtin.`;\n  \n  try {\n    await sendMessageWithoutQuote(message.from, menuText);\n  } catch (error) {\n    console.error('MenÃ¼ gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(menuText);\n  }\n  \n  // MenÃ¼ gÃ¶sterildikten sonra timer baÅŸlat\n  const sessionManager = require('../sessionManager');\n  sessionManager.startMenuTimer(message.from, message, services);\n}\n\n// Ana menÃ¼ kategorilerini getir\nfunction getMainCategories() {\n  return [\n    'sigorta_ana_kategori',\n    'yazilim_talepleri_ana_kategori', \n    'siber_guvenlik_ana',\n    'lojistik_hizmetleri_ana',\n    'ithalat_ihracat_ana',\n    'profesyonel_denetleme_ana',\n    'insaat_emlak_ana',\n    'crm_hizmetleri_ana',\n    'tekstil_urunleri_ana',\n    'kozmetik_urunleri_ana',\n    'tur_organizasyon_ana',\n    'gunes_enerjisi_sistemleri_ana',\n    'kurumsal_hizmetler_ana'\n  ];\n}\n\nmodule.exports = {\n  showMainMenu,\n  getMainCategories\n};","size_bytes":1873},"modules/saleFlow/saleManager.js":{"content":"// modules/saleFlow/saleManager.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendSaleMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('SatÄ±ÅŸ mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// SatÄ±ÅŸ teklifi sorma - GÃœNCELLENDÄ°\nasync function askForSale(message) {\n  const saleQuestion = `ğŸ¯ *YeÅŸil Sigorta PoliÃ§enizi hemen dÃ¼zenleyelim mi?*\\n\\n` +\n                      `PoliÃ§enizi oluÅŸturmak iÃ§in sadece birkaÃ§ bilgiye ihtiyacÄ±mÄ±z var.\\n\\n` +\n                      `âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\n` +\n                      `âŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli`;\n  \n  await sendSaleMessage(message, saleQuestion);\n  \n  // SatÄ±ÅŸ oturumu baÅŸlat\n  const timeoutManager = require('./timeoutManager');\n  timeoutManager.startSaleTimeout(message.from, message);\n}\n\n// SatÄ±ÅŸ teklifi formatlarÄ±\nfunction getSaleQuestions() {\n  return {\n    yesil_sigorta: {\n      question: `ğŸ¯ *YeÅŸil Sigorta PoliÃ§enizi hemen dÃ¼zenleyelim mi?*`,\n      options: `âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\nâŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli`\n    },\n    trafik_sigortasi: {\n      question: `ğŸ¯ *Trafik SigortasÄ± poliÃ§enizi hemen oluÅŸturalÄ±m mÄ±?*`,\n      options: `âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\nâŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli`\n    }\n  };\n}\n\n// Servise Ã¶zel satÄ±ÅŸ sorusu oluÅŸtur - GÃœNCELLENDÄ°\nasync function askServiceSpecificSale(message, serviceName) {\n  const questions = getSaleQuestions();\n  const serviceQuestion = questions[serviceName] || questions['yesil_sigorta'];\n  \n  const saleQuestion = `${serviceQuestion.question}\\n\\n${serviceQuestion.options}`;\n  \n  await sendSaleMessage(message, saleQuestion);\n  \n  // SatÄ±ÅŸ oturumu baÅŸlat\n  const timeoutManager = require('./timeoutManager');\n  timeoutManager.startSaleTimeout(message.from, message);\n}\n\nmodule.exports = {\n  askForSale,\n  askServiceSpecificSale,\n  getSaleQuestions\n};","size_bytes":2291},"modules/validationUtils.js":{"content":"// Cevap doÄŸrulama\nfunction validateAnswer(answer, fieldType) {\n  const cleanAnswer = answer.trim();\n  \n  switch (fieldType) {\n    case 'number':\n      const number = parseInt(cleanAnswer);\n      if (isNaN(number)) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz sayÄ± formatÄ±. LÃ¼tfen sadece rakam girin.'\n        };\n      }\n      return { isValid: true, cleanedValue: number };\n      \n    case 'date':\n      const dateRegex = /^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/;\n      const match = cleanAnswer.match(dateRegex);\n      if (!match) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz tarih formatÄ±. LÃ¼tfen GÃ¼n/Ay/YÄ±l formatÄ±nda girin (Ã–rnek: 15/01/2024).'\n        };\n      }\n      return { isValid: true, cleanedValue: cleanAnswer };\n      \n    case 'phone':\n      const phoneRegex = /^[5][0-9]{2}\\s?[0-9]{3}\\s?[0-9]{2}\\s?[0-9]{2}$/;\n      const cleanPhone = cleanAnswer.replace(/\\s/g, '');\n      if (!phoneRegex.test(cleanPhone)) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz telefon formatÄ±. LÃ¼tfen 5XX XXX XX XX formatÄ±nda girin.'\n        };\n      }\n      return { isValid: true, cleanedValue: cleanAnswer };\n      \n    case 'text':\n    default:\n      if (cleanAnswer.length < 2) {\n        return {\n          isValid: false,\n          errorMessage: 'Cevap Ã§ok kÄ±sa. LÃ¼tfen daha detaylÄ± bilgi verin.'\n        };\n      }\n      return { isValid: true, cleanedValue: cleanAnswer };\n  }\n}\n\nmodule.exports = {\n  validateAnswer\n};","size_bytes":1534},"modules/messageHandler/serviceMatcher.js":{"content":"// modules/messageHandler/serviceMatcher.js - TAMAMEN GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst serviceLoader = require('../serviceLoader');\n\nfunction findMatchingService(message, services) {\n  const cleanMessage = message.toLowerCase().replace(/[.,!?]/g, '').trim();\n  \n  console.log(`ğŸ” Servis aranÄ±yor: \"${cleanMessage}\"`);\n\n  // Ã–NCE: KÄ°MLÄ°K VE TANITIM SORULARI\n  const kimlikSorulari = {\n    'sen kimsin': 'kimlik_tanitim',\n    'sen kimsiniz': 'kimlik_tanitim',\n    'siz kimsiniz': 'kimlik_tanitim',\n    'ne yapÄ±yorsun': 'kimlik_tanitim',\n    'ne yapiyorsun': 'kimlik_tanitim',\n    'ne yapÄ±yorsunuz': 'kimlik_tanitim',\n    'ne yapiyorsunuz': 'kimlik_tanitim',\n    'gerÃ§ek insan mÄ±sÄ±n': 'kimlik_tanitim',\n    'gercek insan misin': 'kimlik_tanitim',\n    'insan mÄ±sÄ±n': 'kimlik_tanitim',\n    'insan misin': 'kimlik_tanitim',\n    'robot musun': 'kimlik_tanitim',\n    'yapay zeka mÄ±sÄ±n': 'kimlik_tanitim',\n    'yapay zeka misin': 'kimlik_tanitim',\n    'ai mÄ±sÄ±n': 'kimlik_tanitim',\n    'ai misin': 'kimlik_tanitim'\n  };\n\n  // SONRA: Ä°LETÄ°ÅÄ°M VE DESTEK SORULARI\n  const iletisimSorulari = {\n    'insan ile gÃ¶rÃ¼ÅŸ': 'iletisim_destek',\n    'insan ile gorus': 'iletisim_destek',\n    'telefon numarasÄ±': 'iletisim_destek',\n    'telefon numarasi': 'iletisim_destek',\n    'numara ver': 'iletisim_destek',\n    'web sitesi': 'iletisim_destek',\n    'web adresi': 'iletisim_destek',\n    'iletiÅŸim': 'iletisim_destek',\n    'iletisim': 'iletisim_destek',\n    'mÃ¼ÅŸteri hizmetleri': 'iletisim_destek',\n    'musteri hizmetleri': 'iletisim_destek',\n    'destek': 'iletisim_destek',\n    'canlÄ± destek': 'iletisim_destek',\n    'canli destek': 'iletisim_destek'\n  };\n\n  // FÄ°RMA BÄ°LGÄ°SÄ° SORULARI\n  const firmaSorulari = {\n    'firma bilgisi': 'firma_bilgileri',\n    'ÅŸirket bilgisi': 'firma_bilgileri',\n    'sirket bilgisi': 'firma_bilgileri',\n    'hangi hizmetler': 'firma_bilgileri',\n    'hizmet alanlarÄ±': 'firma_bilgileri',\n    'hizmet alanlari': 'firma_bilgileri',\n    'neler yapÄ±yorsunuz': 'firma_bilgileri',\n    'neler yapiyorsunuz': 'firma_bilgileri',\n    'hangi sektÃ¶rler': 'firma_bilgileri',\n    'hangi sektorler': 'firma_bilgileri'\n  };\n\n  // 1. Ã–NCE KÄ°MLÄ°K SORULARINI KONTROL ET\n  for (const [soru, dosya] of Object.entries(kimlikSorulari)) {\n    if (cleanMessage.includes(soru)) {\n      console.log(`ğŸ¯ Kimlik sorusu eÅŸleÅŸti: \"${soru}\" -> ${dosya}`);\n      return createDiyalogCevabi(soru, dosya, 'kimlik');\n    }\n  }\n\n  // 2. Ä°LETÄ°ÅÄ°M SORULARINI KONTROL ET\n  for (const [soru, dosya] of Object.entries(iletisimSorulari)) {\n    if (cleanMessage.includes(soru)) {\n      console.log(`ğŸ“ Ä°letiÅŸim sorusu eÅŸleÅŸti: \"${soru}\" -> ${dosya}`);\n      return createDiyalogCevabi(soru, dosya, 'iletisim');\n    }\n  }\n\n  // 3. FÄ°RMA BÄ°LGÄ°SÄ° SORULARINI KONTROL ET\n  for (const [soru, dosya] of Object.entries(firmaSorulari)) {\n    if (cleanMessage.includes(soru)) {\n      console.log(`ğŸ¢ Firma sorusu eÅŸleÅŸti: \"${soru}\" -> ${dosya}`);\n      return createDiyalogCevabi(soru, dosya, 'firma');\n    }\n  }\n\n  // FÄ°YAT SORGULARI\n  const priceQueries = {\n    'yeÅŸil sigorta fiyat': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta fiyat': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatÄ±': 'yesil_sigorta_fiyatlari', \n    'yesil sigorta fiyati': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta ne kadar': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta ne kadar': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta Ã¼creti': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta ucreti': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatlarÄ±': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatlari': 'yesil_sigorta_fiyatlari',\n    'trafik sigortasÄ± fiyat': 'trafik_sigortasi_fiyat_akisi',\n    'trafik sigortasi fiyat': 'trafik_sigortasi_fiyat_akisi'\n  };\n\n  for (const [priceQuery, serviceKey] of Object.entries(priceQueries)) {\n    if (cleanMessage.includes(priceQuery)) {\n      console.log(`ğŸ’° Fiyat sorgusu eÅŸleÅŸti: \"${priceQuery}\" -> ${serviceKey}`);\n      \n      if (services['fiyat_listeleri'] && services['fiyat_listeleri'][serviceKey]) {\n        return { \n          type: 'service', \n          data: services['fiyat_listeleri'][serviceKey], \n          category: 'fiyat_listeleri', \n          name: serviceKey \n        };\n      }\n    }\n  }\n\n  // TAM EÅLEÅMELER - TÃœM SERVÄ°SLER\n  const exactMatches = {\n    // === SÄ°GORTA HÄ°ZMETLERÄ° ===\n    'yeÅŸil sigorta': 'yesil_sigorta',\n    'yesil sigorta': 'yesil_sigorta',\n    'trafik sigortasÄ±': 'trafik_sigortasi',\n    'trafik sigortasi': 'trafik_sigortasi',\n    'kasko sigortasÄ±': 'kasko',\n    'kasko sigortasi': 'kasko',\n    'koltuk sigortasÄ±': 'koltuk_sigortasi',\n    'koltuk sigortasi': 'koltuk_sigortasi',\n    'dask sigortasÄ±': 'dask',\n    'dask sigortasi': 'dask',\n    'konut sigortasÄ±': 'konut_sigortasi',\n    'konut sigortasi': 'konut_sigortasi',\n    'iÅŸyeri sigortasÄ±': 'isyeri_sigortasi',\n    'isyeri sigortasi': 'isyeri_sigortasi',\n    'seyahat saÄŸlÄ±k sigortasÄ±': 'seyahat_saglik_sigortasi',\n    'seyahat saglik sigortasi': 'seyahat_saglik_sigortasi',\n    'tamamlayÄ±cÄ± saÄŸlÄ±k sigortasÄ±': 'tamamlayici_saglik_sigortasi',\n    'tamamlayici saglik sigortasi': 'tamamlayici_saglik_sigortasi',\n    'Ã¶zel saÄŸlÄ±k sigortasÄ±': 'ozel_saglik_sigortasi',\n    'ozel saglik sigortasi': 'ozel_saglik_sigortasi',\n\n    // === YAZILIM TALEPLERÄ° ===\n    'Ã¶zel yazÄ±lÄ±m geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'ozel yazilim geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'yazÄ±lÄ±m geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'yazilim geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'mobil uygulama geliÅŸtirme': 'mobil_uygulama_gelistirme',\n    'mobil uygulama': 'mobil_uygulama_gelistirme',\n    'uygulama geliÅŸtirme': 'mobil_uygulama_gelistirme',\n\n    // === SÄ°BER GÃœVENLÄ°K ===\n    'genel aÄŸ gÃ¼venliÄŸi': 'genel_ag_guvenligi',\n    'genel ag guvenligi': 'genel_ag_guvenligi',\n    'kullanÄ±cÄ± gÃ¼venliÄŸi': 'kullanici_guvenligi',\n    'kullanici guvenligi': 'kullanici_guvenligi',\n    'veri gÃ¼venliÄŸi': 'veri_guvenligi',\n    'veri guvenligi': 'veri_guvenligi',\n    'uygulama gÃ¼venliÄŸi': 'uygulama_guvenligi',\n    'uygulama guvenligi': 'uygulama_guvenligi',\n    'kimlik ve eriÅŸim yÃ¶netimi': 'kimlik_erisim_yonetimi',\n    'kimlik erisim yonetimi': 'kimlik_erisim_yonetimi',\n    'gÃ¼venlik yÃ¶netimi': 'guvenlik_yonetimi',\n    'guvenlik yonetimi': 'guvenlik_yonetimi',\n    'penetrasyon test talebi': 'penetrasyon_test_talebi',\n    'penetrasyon test': 'penetrasyon_test_talebi',\n    'siber gÃ¼venlik eÄŸitimi': 'egitim_talepleri',\n    'siber guvenlik egitimi': 'egitim_talepleri',\n\n    // === LOJÄ°STÄ°K HÄ°ZMETLERÄ° ===\n    'yurtiÃ§i yÃ¼k nakli': 'yurtici_yuk_nakli',\n    'yurtici yuk nakli': 'yurtici_yuk_nakli',\n    'yurtiÃ§i nakliye': 'yurtici_yuk_nakli',\n    'yurtdÄ±ÅŸÄ± yÃ¼k nakli': 'yurtdisi_yuk_nakli',\n    'yurtdisi yuk nakli': 'yurtdisi_yuk_nakli',\n    'yurtdÄ±ÅŸÄ± nakliye': 'yurtdisi_yuk_nakli',\n    'depo antrepo hizmeti': 'depo_antrepo_hizmeti',\n    'depo hizmeti': 'depo_antrepo_hizmeti',\n    'antrepo hizmeti': 'depo_antrepo_hizmeti',\n\n    // === Ä°THALAT Ä°HRACAT ===\n    'yurtdÄ±ÅŸÄ± mÃ¼ÅŸteri araÅŸtÄ±rma': 'yurtdisi_musteri_arastirma',\n    'yurtdisi musteri arastirma': 'yurtdisi_musteri_arastirma',\n    'yurtiÃ§i tedarikÃ§i araÅŸtÄ±rma': 'yurtici_tedarikci_arastirma',\n    'yurtici tedarikci arastirma': 'yurtici_tedarikci_arastirma',\n    'gÃ¼mrÃ¼k operasyon hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'gumruk operasyon hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'gÃ¼mrÃ¼k hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'yurtiÃ§i Ã¼rÃ¼n araÅŸtÄ±rma': 'yurtici_urun_arastirma',\n    'yurtici urun arastirma': 'yurtici_urun_arastirma',\n    'yurtdÄ±ÅŸÄ± pazar araÅŸtÄ±rma': 'yurtdisi_pazar_arastirma',\n    'yurtdisi pazar arastirma': 'yurtdisi_pazar_arastirma',\n\n    // === PROFESYONEL DENETLEME ===\n    'iÃ§ denetim hizmeti': 'ic_denetim_hizmeti',\n    'ic denetim hizmeti': 'ic_denetim_hizmeti',\n    'tedarikÃ§i mÃ¼ÅŸteri mali denetim': 'tedarikci_musteri_mali_denetim',\n    'tedarikci musteri mali denetim': 'tedarikci_musteri_mali_denetim',\n    'tedarikÃ§i kalite denetim': 'tedarikci_kalite_denetim',\n    'tedarikci kalite denetim': 'tedarikci_kalite_denetim',\n    'tedarikÃ§i Ã¼retim denetleme': 'tedarikci_uretim_denetleme',\n    'tedarikci uretim denetleme': 'tedarikci_uretim_denetleme',\n    'firma temsil hizmeti': 'firma_temsil_hizmeti',\n\n    // === Ä°NÅAAT EMLAK ===\n    'satÄ±lÄ±k gayrimenkul': 'satilik_gayrimenkul',\n    'satilik gayrimenkul': 'satilik_gayrimenkul',\n    'kiralÄ±k gayrimenkul': 'kiralik_gayrimenkul',\n    'kiralik gayrimenkul': 'kiralik_gayrimenkul',\n    'yurtdÄ±ÅŸÄ± gayrimenkul yatÄ±rÄ±m': 'yurtdisi_gayrimenkul_yatirim',\n    'yurtdisi gayrimenkul yatirim': 'yurtdisi_gayrimenkul_yatirim',\n    'inÅŸaat taahhÃ¼t hizmeti': 'insaat_taahhut_hizmeti',\n    'insaat taahhut hizmeti': 'insaat_taahhut_hizmeti',\n\n    // === CRM HÄ°ZMETLERÄ° ===\n    'mÃ¼ÅŸteri seÃ§imi': 'musteri_secimi',\n    'musteri secimi': 'musteri_secimi',\n    'mÃ¼ÅŸteri edinme': 'musteri_edinme',\n    'musteri edinme': 'musteri_edinme',\n    'mÃ¼ÅŸteri koruma': 'musteri_koruma',\n    'musteri koruma': 'musteri_koruma',\n    'mÃ¼ÅŸteri derinleÅŸtirme': 'musteri_derinlestirme',\n    'musteri derinlestirme': 'musteri_derinlestirme',\n\n    // === TEKSTÄ°L ÃœRÃœNLERÄ° ===\n    'erkek giyim': 'erkek_giyim',\n    'kadÄ±n giyim': 'kadin_giyim',\n    'kadin giyim': 'kadin_giyim',\n    'ev tekstil Ã¼rÃ¼nleri': 'ev_tekstil_urunleri',\n    'ev tekstil urunleri': 'ev_tekstil_urunleri',\n\n    // === KOZMETÄ°K ÃœRÃœNLERÄ° ===\n    'parfÃ¼m': 'parfum',\n    'parfum': 'parfum',\n    'deodorant': 'deodorant',\n    'kiÅŸisel bakÄ±m': 'kisisel_bakim',\n    'kisisel bakim': 'kisisel_bakim',\n    'medikal kozmetik': 'medikal_kozmetik',\n\n    // === TUR ORGANÄ°ZASYON ===\n    'yurtiÃ§i Ã¶zel gezi talebi': 'yurtici_ozel_gezi_talebi',\n    'yurtici ozel gezi talebi': 'yurtici_ozel_gezi_talebi',\n    'yurtdÄ±ÅŸÄ± Ã¶zel gezi talebi': 'yurtdisi_ozel_gezi_talebi',\n    'yurtdisi ozel gezi talebi': 'yurtdisi_ozel_gezi_talebi',\n    'personel servis talebi': 'personel_servis_talebi',\n\n    // === GÃœNEÅ ENERJÄ°SÄ° SÄ°STEMLERÄ° ===\n    'gÃ¼neÅŸ verimlilik hesabÄ±': 'gunes_verimlilik_hesabi',\n    'gunes verimlilik hesabi': 'gunes_verimlilik_hesabi',\n    'ges Ã¼retim hesaplama': 'ges_uretim_hesaplama',\n    'ges uretim hesaplama': 'ges_uretim_hesaplama',\n    'ges kurulum hesaplama': 'ges_kurulum_hesaplama',\n\n    // === KURUMSAL HÄ°ZMETLER ===\n    'insan kaynaklarÄ± danÄ±ÅŸmanlÄ±ÄŸÄ±': 'insan_kaynaklari_danismanligi',\n    'stratejik planlama danÄ±ÅŸmanlÄ±ÄŸÄ±': 'stratejik_planlama_danismanligi',\n    'finansal danÄ±ÅŸmanlÄ±k': 'finansal_danismanlik',\n    'operasyonel iyileÅŸtirme': 'operasyonel_iyilestirme',\n    'kurumsal iletiÅŸim danÄ±ÅŸmanlÄ±ÄŸÄ±': 'kurumsal_iletisim_danismanligi',\n    'yasal danÄ±ÅŸmanlÄ±k': 'yasal_danismanlik',\n    'teknoloji danÄ±ÅŸmanlÄ±ÄŸÄ±': 'teknoloji_danismanligi',\n    'kurumsal eÄŸitim hizmetleri': 'kurumsal_egitim_hizmetleri'\n  };\n\n  for (const [exactPhrase, serviceKey] of Object.entries(exactMatches)) {\n    if (cleanMessage.includes(exactPhrase.toLowerCase())) {\n      console.log(`âœ… Tam ifade eÅŸleÅŸti: \"${exactPhrase}\" -> ${serviceKey}`);\n      \n      // Ã–nce servis olarak ara\n      for (const [categoryName, categoryServices] of Object.entries(services)) {\n        if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n          return { \n            type: 'service', \n            data: categoryServices[serviceKey], \n            category: categoryName, \n            name: serviceKey \n          };\n        }\n      }\n      \n      // Servis bulunamazsa kategori olarak ara\n      if (services[serviceKey]) {\n        return { type: 'category', data: services[serviceKey], name: serviceKey };\n      }\n    }\n  }\n\n  // ANAHTAR KELÄ°MELER (kategori eÅŸleÅŸtirme)\n  const keywordMatches = {\n    'sigorta': 'sigorta_ana_kategori',\n    'yazÄ±lÄ±m': 'yazilim_talepleri_ana_kategori',\n    'yazilim': 'yazilim_talepleri_ana_kategori',\n    'siber': 'siber_guvenlik_ana',\n    'gÃ¼venlik': 'siber_guvenlik_ana',\n    'lojistik': 'lojistik_hizmetleri_ana',\n    'nakliye': 'lojistik_hizmetleri_ana',\n    'ithalat': 'ithalat_ihracat_ana',\n    'ihracat': 'ithalat_ihracat_ana',\n    'denetim': 'profesyonel_denetleme_ana',\n    'denetleme': 'profesyonel_denetleme_ana',\n    'emlak': 'insaat_emlak_ana',\n    'inÅŸaat': 'insaat_emlak_ana',\n    'crm': 'crm_hizmetleri_ana',\n    'tekstil': 'tekstil_urunleri_ana',\n    'kozmetik': 'kozmetik_urunleri_ana',\n    'tur': 'tur_organizasyon_ana',\n    'turizm': 'tur_organizasyon_ana',\n    'gÃ¼neÅŸ': 'gunes_enerjisi_sistemleri_ana',\n    'enerji': 'gunes_enerjisi_sistemleri_ana',\n    'kurumsal': 'kurumsal_hizmetler_ana',\n    'danÄ±ÅŸmanlÄ±k': 'kurumsal_hizmetler_ana'\n  };\n\n  for (const [keyword, serviceKey] of Object.entries(keywordMatches)) {\n    if (cleanMessage.includes(keyword)) {\n      console.log(`âœ… Anahtar kelime eÅŸleÅŸti: \"${keyword}\" -> ${serviceKey}`);\n      \n      const categoryData = services[serviceKey];\n      if (categoryData) {\n        console.log(`âœ… Kategori bulundu: ${serviceKey}`);\n        return { type: 'category', data: categoryData, name: serviceKey };\n      } else {\n        console.log(`âŒ Kategori bulunamadÄ±: ${serviceKey}`);\n        // Alternatif kategori isimlerini dene\n        const alternativeKeys = Object.keys(services).filter(key => \n          key.includes(keyword.replace(/[^a-z0-9]/gi, ''))\n        );\n        if (alternativeKeys.length > 0) {\n          console.log(`ğŸ”„ Alternatif kategoriler:`, alternativeKeys);\n          const alternativeKey = alternativeKeys[0];\n          return { type: 'category', data: services[alternativeKey], name: alternativeKey };\n        }\n      }\n    }\n  }\n\n  console.log('âŒ EÅŸleÅŸme bulunamadÄ±');\n  return null;\n}\n\n// Diyalog cevabÄ± oluÅŸturma fonksiyonu - GÃœNCELLENDÄ°\nfunction createDiyalogCevabi(soru, dosyaAdi, tip) {\n  try {\n    console.log(`ğŸ’¬ Diyalog cevabÄ± oluÅŸturuluyor: ${dosyaAdi}.json, Tip: ${tip}`);\n    \n    const diyalogDosyasi = serviceLoader.loadJSON(`./genel_diyalog/${dosyaAdi}.json`);\n    \n    if (!diyalogDosyasi) {\n      console.log(`âŒ Diyalog dosyasÄ± bulunamadÄ±: ${dosyaAdi}`);\n      return createFallbackCevap(tip);\n    }\n\n    let cevap = '';\n    \n    switch (tip) {\n      case 'kimlik':\n        const kimlikCevaplari = diyalogDosyasi.kimlik_sorulari;\n        if (kimlikCevaplari) {\n          if (soru.includes('sen kimsin')) {\n            cevap = kimlikCevaplari.sen_kimsin;\n          } else if (soru.includes('ne yap')) {\n            cevap = kimlikCevaplari.ne_isyapiyorsun;\n          } else if (soru.includes('insan') || soru.includes('robot') || soru.includes('yapay zeka')) {\n            cevap = kimlikCevaplari.gercek_insan_misin;\n          }\n        }\n        break;\n        \n      case 'iletisim':\n        const iletisimCevaplari = diyalogDosyasi.insan_destegi;\n        if (iletisimCevaplari) {\n          if (soru.includes('insan ile') || soru.includes('canlÄ±')) {\n            cevap = iletisimCevaplari.insan_ile_gorus;\n          } else if (soru.includes('telefon') || soru.includes('numara')) {\n            cevap = iletisimCevaplari.telefon_numarasi;\n          } else if (soru.includes('web') || soru.includes('site')) {\n            cevap = iletisimCevaplari.web_sitesi;\n          } else {\n            cevap = iletisimCevaplari.insan_ile_gorus;\n          }\n        }\n        break;\n        \n      case 'firma':\n        const firmaBilgisi = diyalogDosyasi;\n        if (firmaBilgisi && firmaBilgisi.hizmet_alanlari) {\n          cevap = `ğŸ¢ *${firmaBilgisi.firma_adi || 'PlanB Global Network Ltd Åti'}*\\n\\n` +\n                 `ğŸ“‹ *Hizmet AlanlarÄ±:*\\n` +\n                 firmaBilgisi.hizmet_alanlari.map((hizmet, index) => `${index + 1}. ${hizmet}`).join('\\n') +\n                 `\\n\\n${firmaBilgisi.iletisim || 'Ä°nsan desteÄŸine ihtiyaÃ§ duyduÄŸunuzda sizi ilgili departmanlara yÃ¶nlendirebilirim.'}`;\n        }\n        break;\n    }\n\n    if (cevap) {\n      console.log(`âœ… Diyalog cevabÄ± oluÅŸturuldu: ${tip}`);\n      return {\n        type: 'diyalog',\n        data: { cevap: cevap },\n        category: 'genel_diyalog',\n        name: dosyaAdi\n      };\n    }\n    \n  } catch (error) {\n    console.log(`âŒ Diyalog cevabÄ± oluÅŸturma hatasÄ±: ${error.message}`);\n  }\n  \n  return createFallbackCevap(tip);\n}\n\n// Fallback cevap oluÅŸturma\nfunction createFallbackCevap(tip) {\n  let cevap = '';\n  \n  switch (tip) {\n    case 'kimlik':\n      cevap = 'Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?';\n      break;\n    case 'iletisim':\n      cevap = 'Ä°nsan desteÄŸine ihtiyaÃ§ duyduÄŸunuzda sizi ilgili departmanlara yÃ¶nlendirebilirim. Hangi konuda yardÄ±ma ihtiyacÄ±nÄ±z var?';\n      break;\n    case 'firma':\n      cevap = `ğŸ¢ *PlanB Global Network Ltd Åti*\\n\\n` +\n             `ğŸ“‹ *Hizmet AlanlarÄ±:*\\n` +\n             `1. Sigorta Hizmetleri\\n2. YazÄ±lÄ±m Talepleri\\n3. Siber GÃ¼venlik\\n4. Lojistik Hizmetleri\\n5. Ä°thalat Ä°hracat\\n6. Profesyonel Denetleme\\n7. Ä°nÅŸaat Emlak\\n8. CRM Hizmetleri\\n9. Tekstil ÃœrÃ¼nleri\\n10. Kozmetik ÃœrÃ¼nleri\\n11. Tur Organizasyon\\n12. GÃ¼neÅŸ Enerjisi Sistemleri\\n13. Kurumsal Hizmetler\\n\\n` +\n             `Ä°nsan desteÄŸine ihtiyaÃ§ duyduÄŸunuzda sizi ilgili departmanlara yÃ¶nlendirebilirim.`;\n      break;\n  }\n  \n  return {\n    type: 'diyalog',\n    data: { cevap: cevap },\n    category: 'genel_diyalog',\n    name: 'fallback'\n  };\n}\n\nmodule.exports = {\n  findMatchingService\n};","size_bytes":17535},"micro-modules/message/processServiceRequest.js":{"content":"// micro-modules/message/processServiceRequest.js\nconst findMatchingService = require('../utils/findMatchingService');\nconst showCategoryOptions = require('../menu/showCategoryOptions');\nconst startServiceFlow = require('../service/startServiceFlow');\nconst handleUnknownMessage = require('./handleUnknownMessage');\nconst sessionManager = require('../../core/sessionManager');\n\nasync function processServiceRequest(message, serviceRequest, services) {\n  const matchedService = findMatchingService(serviceRequest, services);\n  if (matchedService) {\n    if (matchedService.type === 'category') {\n      await showCategoryOptions(message, matchedService, services);\n      sessionManager.updateUserSession(message.from, { currentState: `submenu_${matchedService.name}` });\n    } else {\n      await startServiceFlow(message, matchedService);\n    }\n  } else {\n    await handleUnknownMessage(message, services);\n  }\n}\n\nmodule.exports = processServiceRequest;","size_bytes":950},"modules/messageHandler/errorHandler.js":{"content":"// modules/messageHandler/errorHandler.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendErrorMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('Hata mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\nasync function handleError(message, error) {\n  logger.error(`Mesaj iÅŸleme hatasÄ±: ${error.message}`);\n  console.error('âŒ Mesaj iÅŸlenirken hata:', error);\n  \n  try {\n    await sendErrorMessage(message, 'âŒ ÃœzgÃ¼nÃ¼m, bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');\n    \n    // Hata detayÄ±nÄ± logla\n    const errorDetails = {\n      userId: message.from,\n      message: message.body,\n      error: error.message,\n      stack: error.stack,\n      timestamp: new Date().toISOString()\n    };\n    \n    logger.error(`Hata detaylarÄ±: ${JSON.stringify(errorDetails)}`);\n    \n  } catch (replyError) {\n    logger.error(`Hata mesajÄ± gÃ¶nderilemedi: ${replyError.message}`);\n  }\n}\n\nasync function handleMediaError(message) {\n  try {\n    await sendErrorMessage(message, 'ğŸ“ Åu anda sadece metin mesajlarÄ±nÄ± iÅŸleyebiliyorum. LÃ¼tfen metin olarak yazÄ±n.');\n  } catch (error) {\n    logger.error(`Medya hatasÄ± mesajÄ± gÃ¶nderilemedi: ${error.message}`);\n  }\n}\n\nasync function handleUnknownCommand(message, contactName = '') {\n  const personalization = require('./personalization');\n  const unknownText = personalization.createPersonalizedUnknownMessage(contactName);\n  \n  try {\n    await sendErrorMessage(message, `${unknownText}\\n\\n` +\n                       `â€¢ \"sigorta\" - Sigorta hizmetleri\\n` +\n                       `â€¢ \"yazÄ±lÄ±m\" - YazÄ±lÄ±m geliÅŸtirme\\n` +\n                       `â€¢ \"lojistik\" - Nakliye hizmetleri\\n` +\n                       `â€¢ Veya diÄŸer hizmetlerimiz...\\n\\n` +\n                       `YardÄ±m iÃ§in \"menÃ¼\" yazabilirsiniz.`);\n  } catch (error) {\n    logger.error(`Bilinmeyen komut mesajÄ± gÃ¶nderilemedi: ${error.message}`);\n  }\n}\n\nmodule.exports = {\n  handleError,\n  handleMediaError,\n  handleUnknownCommand\n};","size_bytes":2227},"micro-modules/service/askNextQuestion.js":{"content":"// micro-modules/service/askNextQuestion.js\nconst sessionManager = require('../../core/sessionManager');\n\nasync function askNextQuestion(message, session) {\n  const currentQuestion = session.currentQuestions[session.currentQuestionIndex];\n  \n  if (currentQuestion) {\n    let questionText = `ğŸ“ *Soru ${session.currentQuestionIndex + 1}/${session.currentQuestions.length}*\\n\\n`;\n    questionText += `${currentQuestion.question}`;\n    \n    if (currentQuestion.field_type === 'number') {\n      questionText += `\\n\\nğŸ’¡ *LÃ¼tfen sadece sayÄ± giriniz.*`;\n    } else if (currentQuestion.field_type === 'date') {\n      questionText += `\\n\\nğŸ’¡ *Format: GÃ¼n/Ay/YÄ±l (Ã–rnek: 15/01/2024)*`;\n    } else if (currentQuestion.field_type === 'phone') {\n      questionText += `\\n\\nğŸ’¡ *Format: 5XX XXX XX XX*`;\n    }\n    \n    await message.reply(questionText);\n    \n    sessionManager.updateUserSession(message.from, {\n      currentState: 'collecting_answer',\n      waitingForResponse: true\n    });\n  } else {\n    const completeServiceFlow = require('./completeServiceFlow');\n    await completeServiceFlow(message, session);\n  }\n}\n\nmodule.exports = askNextQuestion;","size_bytes":1156},"micro-modules/service/handleAnswer.js":{"content":"// micro-modules/service/handleAnswer.js\nconst sessionManager = require('../../core/sessionManager');\nconst validationUtils = require('../../core/validationUtils');\nconst askNextQuestion = require('./askNextQuestion');\nconst completeServiceFlow = require('./completeServiceFlow');\n\nasync function handleAnswer(message, answer, session) {\n  const currentQuestion = session.currentQuestions[session.currentQuestionIndex];\n  const fieldName = currentQuestion.field_name;\n  \n  const validationResult = validationUtils.validateAnswer(answer, currentQuestion.field_type);\n  \n  if (!validationResult.isValid) {\n    await message.reply(`âŒ ${validationResult.errorMessage}\\n\\nLÃ¼tfen tekrar cevap verin:`);\n    return false;\n  }\n  \n  const updatedAnswers = {\n    ...session.collectedAnswers,\n    [fieldName]: validationResult.cleanedValue\n  };\n  \n  sessionManager.updateUserSession(message.from, {\n    collectedAnswers: updatedAnswers,\n    currentQuestionIndex: session.currentQuestionIndex + 1\n  });\n  \n  const updatedSession = sessionManager.getUserSession(message.from);\n  if (updatedSession.currentQuestionIndex < updatedSession.currentQuestions.length) {\n    await askNextQuestion(message, updatedSession);\n  } else {\n    await completeServiceFlow(message, updatedSession);\n  }\n  \n  return true;\n}\n\nmodule.exports = handleAnswer;","size_bytes":1327},"micro-modules/menu/handleNumberSelection.js":{"content":"// micro-modules/menu/handleNumberSelection.js\nconst sessionManager = require('../../core/sessionManager');\nconst handleSubMenuSelection = require('./handleSubMenuSelection');\nconst showCategoryOptions = require('./showCategoryOptions');\n\nasync function handleNumberSelection(message, number, services) {\n  const session = sessionManager.getUserSession(message.from);\n  const currentState = session?.currentState || 'main_menu';\n\n  console.log(`ğŸ”¢ SayÄ± iÅŸleniyor: ${number}, Durum: ${currentState}`);\n\n  if (currentState.startsWith('submenu_')) {\n    const categoryName = currentState.replace('submenu_', '');\n    await handleSubMenuSelection(message, number, categoryName, services);\n    return;\n  }\n\n  const mainCategories = [\n    'sigorta_ana_kategori',\n    'yazilim_talepleri_ana_kategori', \n    'siber_guvenlik_ana',\n    'lojistik_hizmetleri_ana',\n    'ithalat_ihracat_ana',\n    'profesyonel_denetleme_ana',\n    'insaat_emlak_ana',\n    'crm_hizmetleri_ana',\n    'tekstil_urunleri_ana',\n    'kozmetik_urunleri_ana',\n    'tur_organizasyon_ana',\n    'gunes_enerjisi_sistemleri_ana',\n    'kurumsal_hizmetler_ana'\n  ];\n\n  if (number >= 1 && number <= mainCategories.length) {\n    const selectedCategory = mainCategories[number - 1];\n    const categoryData = services[selectedCategory];\n    \n    if (categoryData) {\n      await showCategoryOptions(message, { data: categoryData, name: selectedCategory }, services);\n      sessionManager.updateUserSession(message.from, { currentState: `submenu_${selectedCategory}` });\n    } else {\n      await message.reply('âŒ Bu kategori bulunamadÄ±. LÃ¼tfen tekrar deneyin.');\n    }\n  } else {\n    await message.reply('âŒ GeÃ§ersiz numara. LÃ¼tfen 1-13 arasÄ± bir numara girin.');\n  }\n}\n\nmodule.exports = handleNumberSelection;","size_bytes":1769},"docs/MODULES.md":{"content":"","size_bytes":0},"micro-modules/service/completeServiceFlow.js":{"content":"// micro-modules/service/completeServiceFlow.js\nconst sessionManager = require('../../core/sessionManager');\nconst saveServiceApplication = require('./saveServiceApplication');\nconst serviceLoader = require('../../core/serviceLoader');\nconst showMainMenu = require('../menu/showMainMenu');\n\nasync function completeServiceFlow(message, session) {\n  if (!session.currentService || !session.currentService.data) {\n    console.log('âŒ Servis verisi bulunamadÄ±');\n    await message.reply('âŒ Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    \n    await showMainMenu(message, serviceLoader.loadAllServices());\n    return;\n  }\n  \n  const serviceData = session.currentService.data;\n  const serviceName = serviceData.service_name || session.currentService.name || 'Servis';\n  \n  console.log(`âœ… Servis tamamlandÄ±: ${serviceName}`);\n  console.log(`ğŸ“Š Toplanan cevaplar:`, session.collectedAnswers);\n  \n  let completionText = `ğŸ‰ *${serviceName}* baÅŸvurunuz tamamlandÄ±!\\n\\n`;\n  \n  if (session.currentQuestions.length > 0) {\n    completionText += `âœ… Toplam ${session.currentQuestions.length} soru cevaplandÄ±.\\n\\n`;\n  }\n  \n  completionText += serviceData.completion_message || 'En kÄ±sa sÃ¼rede size dÃ¶nÃ¼ÅŸ yapacaÄŸÄ±z.';\n\n  await message.reply(completionText);\n  \n  if (session.currentService.category !== 'fiyat_listeleri') {\n    await saveServiceApplication(session);\n  }\n  \n  sessionManager.updateUserSession(message.from, {\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: null\n  });\n  \n  setTimeout(async () => {\n    await showMainMenu(message, serviceLoader.loadAllServices());\n  }, 2000);\n}\n\nmodule.exports = completeServiceFlow;","size_bytes":1828},"modules/saleFlow/conversationManager.js":{"content":"// modules/saleFlow/conversationManager.js\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± baÅŸlat\nfunction startSaleConversation(userId) {\n  console.log(`ğŸ’° SatÄ±ÅŸ konuÅŸmasÄ± baÅŸlatÄ±lÄ±yor: ${userId}`);\n  \n  sessionManager.updateUserSession(userId, {\n    currentState: 'waiting_for_sale_response',\n    inSaleConversation: true,\n    saleStartTime: Date.now()\n  });\n}\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± bitir\nasync function endSaleConversation(userId) {\n  console.log(`ğŸ’° SatÄ±ÅŸ konuÅŸmasÄ± bitiriliyor: ${userId}`);\n  \n  const session = sessionManager.getUserSession(userId);\n  const saleDuration = session?.saleStartTime ? Date.now() - session.saleStartTime : 0;\n  \n  logger.info(`SatÄ±ÅŸ konuÅŸmasÄ± tamamlandÄ± - KullanÄ±cÄ±: ${userId}, SÃ¼re: ${saleDuration}ms`);\n  \n  sessionManager.updateUserSession(userId, {\n    currentState: 'main_menu',\n    inSaleConversation: false,\n    saleStartTime: null,\n    saleTimer: null\n  });\n}\n\n// SatÄ±ÅŸ istatistiklerini kaydet\nfunction logSaleStatistics(userId, responseType, success = false) {\n  const session = sessionManager.getUserSession(userId);\n  const saleDuration = session?.saleStartTime ? Date.now() - session.saleStartTime : 0;\n  \n  const stats = {\n    userId: userId,\n    responseType: responseType,\n    success: success,\n    duration: saleDuration,\n    timestamp: new Date().toISOString()\n  };\n  \n  logger.info(`SatÄ±ÅŸ istatistiÄŸi: ${JSON.stringify(stats)}`);\n  \n  // Ä°steÄŸe baÄŸlÄ±: VeritabanÄ±na veya dosyaya kaydet\n  saveSaleStatsToFile(stats);\n}\n\n// SatÄ±ÅŸ istatistiklerini dosyaya kaydet\nfunction saveSaleStatsToFile(stats) {\n  try {\n    const statsDir = './sales_stats';\n    if (!require('fs').existsSync(statsDir)) {\n      require('fs').mkdirSync(statsDir, { recursive: true });\n    }\n    \n    const filename = `sale_stats_${new Date().toISOString().split('T')[0]}.json`;\n    const filePath = require('path').join(statsDir, filename);\n    \n    let existingStats = [];\n    if (require('fs').existsSync(filePath)) {\n      const fileContent = require('fs').readFileSync(filePath, 'utf8');\n      existingStats = JSON.parse(fileContent);\n    }\n    \n    existingStats.push(stats);\n    require('fs').writeFileSync(filePath, JSON.stringify(existingStats, null, 2), 'utf8');\n    \n  } catch (error) {\n    logger.error(`SatÄ±ÅŸ istatistiÄŸi kaydetme hatasÄ±: ${error.message}`);\n  }\n}\n\n// SatÄ±ÅŸ baÅŸarÄ± oranÄ±nÄ± hesapla\nfunction calculateSaleSuccessRate() {\n  // Bu fonksiyon istatistik dosyalarÄ±nÄ± analiz edebilir\n  // Åu anlÄ±k basit bir implementasyon\n  return {\n    totalConversations: 0,\n    successfulSales: 0,\n    successRate: 0\n  };\n}\n\nmodule.exports = {\n  startSaleConversation,\n  endSaleConversation,\n  logSaleStatistics,\n  saveSaleStatsToFile,\n  calculateSaleSuccessRate\n};","size_bytes":2816},"modules/saleFlow.js":{"content":"// modules/saleFlow.js - ANA YÃ–NLENDÄ°RÄ°CÄ° DOSYA\nconst saleManager = require('./saleFlow/saleManager');\nconst responseHandler = require('./saleFlow/responseHandler');\nconst serviceFinder = require('./saleFlow/serviceFinder');\nconst conversationManager = require('./saleFlow/conversationManager');\nconst timeoutManager = require('./saleFlow/timeoutManager');\n\n// SatÄ±ÅŸ teklifi sorma\nasync function askForSale(message) {\n  await saleManager.askForSale(message);\n}\n\n// Servise Ã¶zel satÄ±ÅŸ teklifi sorma\nasync function askServiceSpecificSale(message, serviceName) {\n  await saleManager.askServiceSpecificSale(message, serviceName);\n}\n\n// SatÄ±ÅŸ cevabÄ±nÄ± iÅŸleme\nasync function handleSaleResponse(message, response, services) {\n  await responseHandler.handleSaleResponse(message, response, services);\n}\n\n// SatÄ±ÅŸ zaman aÅŸÄ±mÄ± iÅŸleme\nasync function handleSaleTimeout(userId) {\n  await timeoutManager.handleSaleTimeout(userId);\n}\n\n// YeÅŸil Sigorta servisini bul\nfunction findYesilSigortaService(services) {\n  return serviceFinder.findYesilSigortaService(services);\n}\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± baÅŸlat\nfunction startSaleConversation(userId) {\n  conversationManager.startSaleConversation(userId);\n}\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± bitir\nasync function endSaleConversation(userId) {\n  await conversationManager.endSaleConversation(userId);\n}\n\n// SatÄ±ÅŸ timer'Ä±nÄ± temizle\nfunction clearSaleTimer(userId) {\n  timeoutManager.clearSaleTimer(userId);\n}\n\n// TÃ¼m satÄ±ÅŸ timer'larÄ±nÄ± temizle\nfunction clearAllSaleTimers() {\n  timeoutManager.clearAllSaleTimers();\n}\n\n// SatÄ±ÅŸ istatistiklerini kaydet\nfunction logSaleStatistics(userId, responseType, success = false) {\n  conversationManager.logSaleStatistics(userId, responseType, success);\n}\n\nmodule.exports = {\n  // Ana fonksiyonlar\n  askForSale,\n  askServiceSpecificSale,\n  handleSaleResponse,\n  handleSaleTimeout,\n  \n  // YardÄ±mcÄ± fonksiyonlar\n  findYesilSigortaService,\n  startSaleConversation,\n  endSaleConversation,\n  clearSaleTimer,\n  clearAllSaleTimers,\n  logSaleStatistics,\n  \n  // Alt modÃ¼llere eriÅŸim iÃ§in\n  saleManager,\n  responseHandler,\n  serviceFinder,\n  conversationManager,\n  timeoutManager\n};","size_bytes":2167},"micro-modules/message/handleGreeting.js":{"content":"// micro-modules/message/handleGreeting.js\nconst serviceLoader = require('../../core/serviceLoader');\nconst sessionManager = require('../../core/sessionManager');\nconst getTimeBasedGreeting = require('../utils/getTimeBasedGreeting');\nconst startHelpTimer = require('../session/startHelpTimer');\n\nasync function handleGreeting(message, services) {\n  const greetings = serviceLoader.loadJSON('./data/genel_diyalog/selamlama_vedalasma.json');\n  const greetingType = getTimeBasedGreeting();\n  const greetingMsg = greetings?.selamlama?.[greetingType] || \n                     'Merhaba! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?';\n  \n  await message.reply(greetingMsg);\n  \n  setTimeout(async () => {\n    await message.reply('ğŸ¤” *Size yardÄ±mcÄ± olabilmem iÃ§in lÃ¼tfen bana hangi konuda yardÄ±m istediÄŸinizi yazarmÄ±sÄ±nÄ±z?*');\n    startHelpTimer(message.from, message, services);\n  }, 1000);\n  \n  return true;\n}\n\nmodule.exports = handleGreeting;","size_bytes":1022},"micro-modules/utils/messageFilters.js":{"content":"","size_bytes":0},"index.js":{"content":"// index.js - ARYA Bot Ana DosyasÄ± (MODÃœLER YAPILI - GÃœNCELLENMÄ°Å)\nconst { Client, LocalAuth } = require('whatsapp-web.js');\nconst qrcode = require('qrcode-terminal');\nconst express = require('express');\nconst path = require('path');\n\n// Hugging Face AsistanÄ±nÄ± ekle - EN ÃœSTE\nconst HuggingFaceAsistan = require('./huggingface-asistan');\nconst hfAsistan = new HuggingFaceAsistan();\n\n// ModÃ¼lleri import et\nconst logger = require('./modules/logger');\nconst sessionManager = require('./modules/sessionManager');\nconst serviceLoader = require('./modules/serviceLoader');\nconst messageHandler = require('./modules/messageHandler');\nconst menuHandler = require('./modules/menuHandler');\n\n// Global client utility - EKLENDÄ°\nconst { setGlobalClient } = require('./modules/utils/globalClient');\n\n// WhatsApp client oluÅŸturma\nconst client = new Client({\n  authStrategy: new LocalAuth({\n    dataPath: './session'\n  }),\n  puppeteer: {\n    headless: true,\n    args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage']\n  }\n});\n\n// Global client'Ä± baÅŸlat - EKLENDÄ°\nsetGlobalClient(client);\nconsole.log('ğŸŒ Global client instance baÅŸlatÄ±ldÄ±');\n\n// QR kodu oluÅŸturma\nclient.on('qr', (qr) => {\n  console.log('\\nğŸ“± WHATSAPP BAÄLANTI KODU:');\n  console.log('========================');\n  qrcode.generate(qr, { small: true });\n  console.log('========================');\n  logger.info('QR kodu oluÅŸturuldu - WhatsApp Web\\'e baÄŸlanmak iÃ§in tarayÄ±n');\n});\n\n// BaÄŸlantÄ± baÅŸarÄ±lÄ±\nclient.on('ready', () => {\n  console.log('\\nâœ… ARYA BOT BAÅARIYLA BAÄLANDI!');\n  console.log('ğŸ¤– Bot: ARYA');\n  console.log('ğŸ¢ Firma: PlanB Global Network Ltd Åti');\n  console.log('ğŸš€ GeliÅŸtirici: EurAsia Trade And Technology Bulgaria EOOD - Ã†SIR Ekibi');\n  \n  // Client'Ä±n gerÃ§ekten hazÄ±r olduÄŸunu kontrol et\n  if (client.info) {\n    console.log(`ğŸ“± BaÄŸlÄ± kullanÄ±cÄ±: ${client.info.pushname}`);\n    console.log(`ğŸ“ Telefon: ${client.info.wid.user}`);\n  }\n  \n  logger.info('ARYA Bot baÅŸlatÄ±ldÄ± ve WhatsApp\\'a baÄŸlandÄ±');\n});\n\n// BaÄŸlantÄ± hatasÄ±\nclient.on('auth_failure', (msg) => {\n  logger.error('WhatsApp baÄŸlantÄ± hatasÄ±: ' + msg);\n  console.log('âŒ WhatsApp baÄŸlantÄ± hatasÄ±. LÃ¼tfen tekrar deneyin.');\n  console.log('ğŸ’¡ Oturum dosyalarÄ±nÄ± silmek iÃ§in: rm -rf session/');\n});\n\n// BaÄŸlantÄ± kesildi - OTOMATÄ°K YENÄ°DEN BAÄLANMA\nclient.on('disconnected', (reason) => {\n  logger.warn('WhatsApp baÄŸlantÄ±sÄ± kesildi: ' + reason);\n  console.log('ğŸ”Œ WhatsApp baÄŸlantÄ±sÄ± kesildi. 5 saniye sonra yeniden baÄŸlanÄ±lÄ±yor...');\n  \n  setTimeout(() => {\n    console.log('ğŸ”„ WhatsApp baÄŸlantÄ±sÄ± yeniden deneniyor...');\n    client.initialize().catch(err => {\n      logger.error('Yeniden baÄŸlanma hatasÄ±: ' + err.message);\n      console.log('âŒ Yeniden baÄŸlanma baÅŸarÄ±sÄ±z. LÃ¼tfen manuel olarak kontrol edin.');\n    });\n  }, 5000);\n});\n\n// Mesaj alma - YENÄ° MANTIK (Hugging Face entegre edilmiÅŸ)\nclient.on('message', async (message) => {\n  try {\n    // Ã–nce modÃ¼ler mesaj iÅŸleyiciyi dene\n    await messageHandler.handleMessage(message);\n  } catch (error) {\n    logger.error(`Mesaj iÅŸleme hatasÄ±: ${error.message}`);\n    console.error('âŒ Mesaj iÅŸlenirken hata:', error);\n    \n    // ModÃ¼ler sistemde hata olursa, Hugging Face ile yanÄ±t ver\n    try {\n      console.log(`ğŸ“¨ Hugging Face ile yanÄ±t oluÅŸturuluyor: ${message.body}`);\n      \n      // Hugging Face ile akÄ±llÄ± yanÄ±t\n      const intelligentResponse = await hfAsistan.generateResponse(message.body);\n      await message.reply(intelligentResponse);\n      \n    } catch (hfError) {\n      console.error('âŒ Hugging Face yanÄ±t hatasÄ±:', hfError);\n      \n      // Son Ã§are olarak genel hata mesajÄ±\n      try {\n        await message.reply('âŒ ÃœzgÃ¼nÃ¼m, bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');\n      } catch (replyError) {\n        logger.error(`Hata mesajÄ± gÃ¶nderilemedi: ${replyError.message}`);\n      }\n    }\n  }\n});\n\n// Express sunucusu\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\n// Environment variable kontrolÃ¼\nif (!process.env.PORT) {\n  console.log('âš ï¸  PORT environment variable bulunamadÄ±, varsayÄ±lan 3000 kullanÄ±lÄ±yor');\n}\n\napp.use(express.json());\n\n// Health check endpoint\napp.get('/health', (req, res) => {\n  const botStatus = client.info ? 'connected' : 'disconnected';\n  \n  res.json({ \n    status: 'OK', \n    bot: 'ARYA', \n    version: '1.0.0',\n    company: 'PlanB Global Network Ltd Åti',\n    whatsapp_status: botStatus,\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime(),\n    memory_usage: process.memoryUsage()\n  });\n});\n\n// Services endpoint\napp.get('/services', (req, res) => {\n  try {\n    const services = serviceLoader.loadAllServices();\n    res.json({\n      success: true,\n      data: services,\n      count: Object.keys(services).length,\n      loaded_at: new Date().toISOString()\n    });\n  } catch (error) {\n    logger.error(`Services endpoint hatasÄ±: ${error.message}`);\n    res.status(500).json({\n      success: false,\n      error: 'Servisler yÃ¼klenirken hata oluÅŸtu'\n    });\n  }\n});\n\n// Root endpoint\napp.get('/', (req, res) => {\n  res.json({\n    message: 'ARYA Bot API Service',\n    endpoints: {\n      health: '/health',\n      services: '/services'\n    },\n    documentation: 'ARYA Bot iÃ§in REST API servisi'\n  });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({\n    error: 'Endpoint bulunamadÄ±',\n    available_endpoints: ['/health', '/services']\n  });\n});\n\n// Sunucuyu baÅŸlat\napp.listen(PORT, () => {\n  console.log(`ğŸŒ ARYA Bot API http://localhost:${PORT} adresinde Ã§alÄ±ÅŸÄ±yor`);\n  console.log(`ğŸ“Š Health check: http://localhost:${PORT}/health`);\n  console.log(`ğŸ“‹ Servisler: http://localhost:${PORT}/services`);\n  logger.info(`ARYA Bot API ${PORT} portunda baÅŸlatÄ±ldÄ±`);\n});\n\n// Botu baÅŸlat\nconsole.log('ğŸš€ ARYA Bot baÅŸlatÄ±lÄ±yor...');\nconsole.log('ğŸ“ ModÃ¼ler yapÄ± yÃ¼kleniyor...');\nconsole.log('ğŸ¤– Hugging Face AsistanÄ± aktif!');\n\nclient.initialize().catch(error => {\n  logger.error(`Bot baÅŸlatma hatasÄ±: ${error.message}`);\n  console.log('âŒ Bot baÅŸlatÄ±lamadÄ±:', error.message);\n  process.exit(1);\n});\n\n// Graceful shutdown\nprocess.on('SIGINT', async () => {\n  console.log('\\nğŸ›‘ ARYA Bot kapatÄ±lÄ±yor...');\n  \n  // TÃ¼m timer'larÄ± temizle - GÃœNCELLENDÄ°\n  const timeoutManager = require('./modules/saleFlow/timeoutManager');\n  timeoutManager.clearAllSaleTimers();\n  \n  sessionManager.userSessions.forEach(session => {\n    if (session.menuTimer) clearTimeout(session.menuTimer);\n    if (session.helpTimer) clearTimeout(session.helpTimer);\n    if (session.goodbyeTimer) clearTimeout(session.goodbyeTimer);\n  });\n  \n  // Client'Ä± temizle\n  try {\n    await client.destroy();\n    console.log('âœ… WhatsApp client temizlendi');\n  } catch (error) {\n    console.log('âš ï¸  Client temizleme hatasÄ±:', error.message);\n  }\n  \n  logger.info('ARYA Bot kapatÄ±ldÄ±');\n  console.log('ğŸ‘‹ ARYA Bot baÅŸarÄ±yla kapatÄ±ldÄ±');\n  process.exit(0);\n});\n\nprocess.on('SIGTERM', async () => {\n  console.log('\\nğŸ›‘ ARYA Bot SIGTERM sinyali aldÄ±, kapatÄ±lÄ±yor...');\n  await client.destroy();\n  process.exit(0);\n});\n\n// Beklenmeyen hatalar\nprocess.on('uncaughtException', (error) => {\n  logger.error(`Beklenmeyen hata: ${error.message}`);\n  console.log('âŒ Kritik hata oluÅŸtu:', error.message);\n  console.log('ğŸ”„ Bot yeniden baÅŸlatÄ±labilir...');\n});\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  logger.error(`Ä°ÅŸlenmemiÅŸ Promise: ${reason}`);\n  console.log('âš ï¸  Ä°ÅŸlenmemiÅŸ Promise hatasÄ±:', reason);\n});\n\n// BaÅŸlangÄ±Ã§ kontrolÃ¼\nsetTimeout(() => {\n  if (!client.info) {\n    console.log('â³ WhatsApp baÄŸlantÄ±sÄ± bekleniyor... QR kodu tarayÄ±n.');\n  }\n}, 3000);","size_bytes":7762},"test.js":{"content":"// bert-test.js\nconst HuggingFaceAsistan = require('./huggingface-asistan');\nconst asistan = new HuggingFaceAsistan();\n\nasync function testBert() {\n  const testMesajlari = [\n    \"Merhaba, trafik sigortasÄ± fiyatÄ± almak istiyorum\",\n    \"KiralÄ±k daire ilanÄ± vermek istiyorum\", \n    \"YazÄ±lÄ±m geliÅŸtirme hizmetiniz var mÄ±?\",\n    \"GÃ¼neÅŸ enerjisi kurulum fiyatÄ± nedir?\",\n    \"NasÄ±lsÄ±nÄ±z?\"\n  ];\n\n  for (let mesaj of testMesajlari) {\n    console.log(`\\nğŸ§ª Test: \"${mesaj}\"`);\n    const yanit = await asistan.generateResponse(mesaj);\n    console.log(`ğŸ¤– YanÄ±t: \"${yanit}\"`);\n    await new Promise(resolve => setTimeout(resolve, 3000)); // 3 sn bekle\n  }\n}\n\ntestBert();","size_bytes":677},"micro-modules/session/startMenuTimer.js":{"content":"// micro-modules/session/startMenuTimer.js\nconst logger = require('../../core/logger');\nconst sessionManager = require('../../core/sessionManager');\nconst showMainMenu = require('../menu/showMainMenu');\n\nfunction startMenuTimer(userId, message, services) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.menuTimer) {\n    clearTimeout(session.menuTimer);\n  }\n\n  const timer = setTimeout(async () => {\n    const currentSession = sessionManager.getUserSession(userId);\n    if (currentSession && currentSession.waitingForResponse) {\n      logger.info(`â° MenÃ¼ zaman aÅŸÄ±mÄ± - KullanÄ±cÄ±: ${userId}`);\n      await showMainMenu(message, services);\n      sessionManager.updateUserSession(userId, { \n        waitingForResponse: false, \n        menuTimer: null,\n        currentState: 'main_menu'\n      });\n    }\n  }, 60000);\n\n  sessionManager.updateUserSession(userId, { \n    waitingForResponse: true, \n    menuTimer: timer,\n    currentState: 'waiting_for_service'\n  });\n}\n\nmodule.exports = startMenuTimer;","size_bytes":1036},"micro-modules/utils/parseMessage.js":{"content":"// micro-modules/utils/parseMessage.js\nfunction parseMessage(message) {\n  const cleanMessage = message.toLowerCase().trim();\n  \n  let greetingPart = '';\n  let servicePart = '';\n  \n  const greetingWords = ['merhaba', 'selam', 'hi', 'hello', 'hey', 'gÃ¼naydÄ±n', 'iyi gÃ¼nler', 'iyi akÅŸamlar', 'naber', 'slm', 'sa'];\n  \n  for (const word of greetingWords) {\n    if (cleanMessage.includes(word)) {\n      const index = cleanMessage.indexOf(word);\n      greetingPart = message.substring(0, index + word.length);\n      servicePart = message.substring(index + word.length).trim();\n      break;\n    }\n  }\n  \n  if (!greetingPart) {\n    servicePart = message;\n  }\n  \n  return { greetingPart, servicePart };\n}\n\nmodule.exports = parseMessage;","size_bytes":731},"modules/utils/globalClient.js":{"content":"// modules/utils/globalClient.js - GÃœNCELLENDÄ°\nlet globalClient = null;\n\nfunction setGlobalClient(client) {\n  globalClient = client;\n}\n\nfunction getGlobalClient() {\n  return globalClient;\n}\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme fonksiyonu ekle\nasync function sendMessageWithoutQuote(chatId, message) {\n  if (!globalClient) {\n    throw new Error('Global client baÅŸlatÄ±lmamÄ±ÅŸ');\n  }\n  \n  try {\n    const chat = await globalClient.getChatById(chatId);\n    await chat.sendMessage(message);\n    return true;\n  } catch (error) {\n    console.error('Mesaj gÃ¶nderme hatasÄ±:', error);\n    throw error;\n  }\n}\n\nmodule.exports = {\n  setGlobalClient,\n  getGlobalClient,\n  sendMessageWithoutQuote\n};","size_bytes":687},"modules/messageHandler/validation.js":{"content":"const logger = require('../logger');\n\nfunction validateMessage(message) {\n  // Temel validasyonlar\n  if (message.fromMe) {\n    return { isValid: false, reason: 'fromMe' };\n  }\n  \n  if (message.from === 'status@broadcast') {\n    return { isValid: false, reason: 'status_broadcast' };\n  }\n  \n  if (message.isGroupMsg) {\n    return { isValid: false, reason: 'group_message' };\n  }\n  \n  const messageBody = message.body?.toLowerCase().trim();\n  if (!messageBody || messageBody.length === 0) {\n    return { isValid: false, reason: 'empty_message' };\n  }\n  \n  if (message.hasMedia) {\n    return { isValid: false, reason: 'has_media' };\n  }\n  \n  return { isValid: true, messageBody };\n}\n\nfunction validateInput(message, expectedType) {\n  const cleanMessage = message.trim();\n  \n  switch (expectedType) {\n    case 'number':\n      const number = parseInt(cleanMessage);\n      if (isNaN(number)) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz sayÄ± formatÄ±. LÃ¼tfen sadece rakam girin.'\n        };\n      }\n      return { isValid: true, value: number };\n      \n    case 'text':\n      if (cleanMessage.length < 2) {\n        return {\n          isValid: false,\n          errorMessage: 'Cevap Ã§ok kÄ±sa. LÃ¼tfen daha detaylÄ± bilgi verin.'\n        };\n      }\n      return { isValid: true, value: cleanMessage };\n      \n    default:\n      return { isValid: true, value: cleanMessage };\n  }\n}\n\nmodule.exports = {\n  validateMessage,\n  validateInput\n};","size_bytes":1468},"modules/saleFlow/serviceFinder.js":{"content":"// modules/saleFlow/serviceFinder.js\nconst logger = require('../logger');\n\n// YeÅŸil Sigorta servisini bul - DÃœZELTÄ°LDÄ°\nfunction findYesilSigortaService(services) {\n  console.log(`ğŸ” YeÅŸil Sigorta servisi aranÄ±yor...`);\n  \n  for (const [categoryName, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object' && categoryServices['yesil_sigorta']) { // yesil_sigortasi â†’ yesil_sigorta\n      console.log(`âœ… YeÅŸil Sigorta bulundu: ${categoryName}/yesil_sigorta`);\n      return {\n        type: 'service',\n        data: categoryServices['yesil_sigorta'],\n        category: categoryName,\n        name: 'yesil_sigorta'\n      };\n    }\n  }\n  \n  console.log(`âŒ YeÅŸil Sigorta servisi bulunamadÄ±`);\n  \n  // Alternatif servisleri kontrol et\n  const alternativeServices = findAlternativeServices(services);\n  if (alternativeServices.length > 0) {\n    console.log(`ğŸ’¡ Alternatif servisler bulundu:`, alternativeServices);\n  }\n  \n  return null;\n}\n\n// Alternatif servisleri bul\nfunction findAlternativeServices(services) {\n  const alternatives = [];\n  const targetServices = ['yesil_sigorta', 'trafik_sigortasi', 'kasko']; // yesil_sigortasi â†’ yesil_sigorta\n  \n  for (const serviceKey of targetServices) {\n    for (const [categoryName, categoryServices] of Object.entries(services)) {\n      if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n        alternatives.push({\n          name: serviceKey,\n          category: categoryName,\n          displayName: categoryServices[serviceKey].service_name || serviceKey\n        });\n      }\n    }\n  }\n  \n  return alternatives;\n}\n\n// TÃ¼m sigorta servislerini listele\nfunction getAllInsuranceServices(services) {\n  const insuranceServices = [];\n  \n  // Sigorta kategorilerinde ara\n  const insuranceCategories = ['sigorta_hizmetleri', 'sigorta_ana_kategori'];\n  \n  for (const category of insuranceCategories) {\n    if (services[category]) {\n      for (const [serviceKey, serviceData] of Object.entries(services[category])) {\n        if (typeof serviceData === 'object' && serviceData.service_name) {\n          insuranceServices.push({\n            key: serviceKey,\n            name: serviceData.service_name,\n            category: category\n          });\n        }\n      }\n    }\n  }\n  \n  return insuranceServices;\n}\n\n// Servis Ã¶ncelik sÄ±ralamasÄ± - DÃœZELTÄ°LDÄ°\nfunction getServicePriority(serviceName) {\n  const priorityMap = {\n    'yesil_sigorta': 1, // yesil_sigortasi â†’ yesil_sigorta\n    'trafik_sigortasi': 2,\n    'kasko': 3,\n    'konut_sigortasi': 4,\n    'dask': 5\n  };\n  \n  return priorityMap[serviceName] || 999;\n}\n\nmodule.exports = {\n  findYesilSigortaService,\n  findAlternativeServices,\n  getAllInsuranceServices,\n  getServicePriority\n};","size_bytes":2752},"modules/saleFlow/timeoutManager.js":{"content":"// modules/saleFlow/timeoutManager.js\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { getGlobalClient } = require('../utils/globalClient');\n\n// SatÄ±ÅŸ zaman aÅŸÄ±mÄ± baÅŸlat\nfunction startSaleTimeout(userId, message) {\n  const session = sessionManager.getUserSession(userId);\n  \n  // Ã–nceki timer'Ä± temizle\n  if (session && session.saleTimer) {\n    clearTimeout(session.saleTimer);\n  }\n  \n  console.log(`â° SatÄ±ÅŸ zaman aÅŸÄ±mÄ± baÅŸlatÄ±ldÄ±: ${userId}`);\n  \n  const saleTimer = setTimeout(async () => {\n    await handleSaleTimeout(userId);\n  }, 5 * 60 * 1000); // 5 dakika\n  \n  // KonuÅŸmayÄ± baÅŸlat\n  const conversationManager = require('./conversationManager');\n  conversationManager.startSaleConversation(userId);\n  \n  sessionManager.updateUserSession(userId, {\n    saleTimer: saleTimer,\n    currentState: 'waiting_for_sale_response'\n  });\n}\n\n// SatÄ±ÅŸ zaman aÅŸÄ±mÄ± iÅŸleme - CLIENT FIX Ä°LE GÃœNCELLENDÄ°\nasync function handleSaleTimeout(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.currentState === 'waiting_for_sale_response') {\n    logger.info(`â° SatÄ±ÅŸ zaman aÅŸÄ±mÄ± - KullanÄ±cÄ±: ${userId}`);\n    \n    try {\n      // Global client instance'Ä±nÄ± kullan\n      const client = getGlobalClient();\n      \n      if (client && client.info) {\n        const chat = await client.getChatById(userId);\n        await chat.sendMessage('â° *Cevap sÃ¼resi doldu*\\n\\n' +\n                              'YeÅŸil Sigorta ihtiyacÄ±nÄ±z olduÄŸunda tekrar \"yeÅŸil sigorta\" yazabilirsiniz. ğŸ›¡ï¸\\n\\n' +\n                              'Ä°yi gÃ¼nler dilerim! âœ¨');\n        logger.info(`Zaman aÅŸÄ±mÄ± mesajÄ± gÃ¶nderildi: ${userId}`);\n      } else {\n        logger.warn('Client instance hazÄ±r deÄŸil, zaman aÅŸÄ±mÄ± mesajÄ± gÃ¶nderilemedi');\n      }\n      \n    } catch (error) {\n      logger.error(`Zaman aÅŸÄ±mÄ± mesajÄ± gÃ¶nderme hatasÄ±: ${error.message}`);\n    }\n    \n    // KonuÅŸmayÄ± bitir\n    const conversationManager = require('./conversationManager');\n    await conversationManager.endSaleConversation(userId);\n    conversationManager.logSaleStatistics(userId, 'timeout', false);\n  }\n}\n\n// SatÄ±ÅŸ timer'Ä±nÄ± temizle\nfunction clearSaleTimer(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.saleTimer) {\n    clearTimeout(session.saleTimer);\n    sessionManager.updateUserSession(userId, { saleTimer: null });\n    console.log(`â° SatÄ±ÅŸ timer temizlendi: ${userId}`);\n  }\n}\n\n// TÃ¼m satÄ±ÅŸ timer'larÄ±nÄ± temizle (shutdown iÃ§in)\nfunction clearAllSaleTimers() {\n  const sessions = sessionManager.userSessions;\n  let clearedCount = 0;\n  \n  sessions.forEach((session, userId) => {\n    if (session.saleTimer) {\n      clearTimeout(session.saleTimer);\n      clearedCount++;\n    }\n  });\n  \n  console.log(`â° ${clearedCount} satÄ±ÅŸ timer temizlendi`);\n}\n\nmodule.exports = {\n  startSaleTimeout,\n  handleSaleTimeout,\n  clearSaleTimer,\n  clearAllSaleTimers\n};","size_bytes":3005},"modules/menuHandler/serviceConverter.js":{"content":"// modules/menuHandler/serviceConverter.js\nconst logger = require('../logger');\n\n// Servis anahtarÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼rme - DÃœZELTÄ°LDÄ°\nfunction convertToServiceKey(categoryName) {\n  const conversions = {\n    // === SÄ°GORTA HÄ°ZMETLERÄ° ===\n    'YeÅŸil Sigorta': 'yesil_sigorta', // yesil_sigortasi â†’ yesil_sigorta\n    'Trafik SigortasÄ±': 'trafik_sigortasi',\n    'KASKO': 'kasko',\n    'Koltuk SigortasÄ±': 'koltuk_sigortasi',\n    'DASK': 'dask',\n    'Konut SigortasÄ±': 'konut_sigortasi',\n    'Ä°ÅŸyeri SigortasÄ±': 'isyeri_sigortasi',\n    'Seyahat SaÄŸlÄ±k SigortasÄ±': 'seyahat_saglik_sigortasi',\n    'TamamlayÄ±cÄ± SaÄŸlÄ±k SigortasÄ±': 'tamamlayici_saglik_sigortasi',\n    'Ã–zel SaÄŸlÄ±k SigortasÄ±': 'ozel_saglik_sigortasi',\n\n    // === YAZILIM TALEPLERÄ° ===\n    'Ã–zel YazÄ±lÄ±m GeliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'Mobil Uygulama GeliÅŸtirme': 'mobil_uygulama_gelistirme',\n\n    // === SÄ°BER GÃœVENLÄ°K ===\n    'Genel AÄŸ GÃ¼venliÄŸi': 'genel_ag_guvenligi',\n    'KullanÄ±cÄ± GÃ¼venliÄŸi': 'kullanici_guvenligi',\n    'Veri GÃ¼venliÄŸi': 'veri_guvenligi',\n    'Uygulama GÃ¼venliÄŸi': 'uygulama_guvenligi',\n    'Kimlik ve EriÅŸim YÃ¶netimi': 'kimlik_erisim_yonetimi',\n    'GÃ¼venlik YÃ¶netimi': 'guvenlik_yonetimi',\n    'Penetrasyon Test Talebi': 'penetrasyon_test_talebi',\n    'EÄŸitim Talepleri': 'egitim_talepleri',\n\n    // === LOJÄ°STÄ°K HÄ°ZMETLERÄ° ===\n    'YurtiÃ§i YÃ¼k Nakli': 'yurtici_yuk_nakli',\n    'YurtdÄ±ÅŸÄ± YÃ¼k Nakli': 'yurtdisi_yuk_nakli',\n    'Depo/Antrepo Hizmeti': 'depo_antrepo_hizmeti',\n\n    // === Ä°THALAT Ä°HRACAT ===\n    'YurtdÄ±ÅŸÄ± MÃ¼ÅŸteri AraÅŸtÄ±rma': 'yurtdisi_musteri_arastirma',\n    'YurtiÃ§i TedarikÃ§i AraÅŸtÄ±rma': 'yurtici_tedarikci_arastirma',\n    'GÃ¼mrÃ¼k Operasyon Hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'YurtiÃ§i ÃœrÃ¼n AraÅŸtÄ±rma': 'yurtici_urun_arastirma',\n    'YurtdÄ±ÅŸÄ± Pazar AraÅŸtÄ±rma': 'yurtdisi_pazar_arastirma',\n\n    // === PROFESYONEL DENETLEME ===\n    'Ä°Ã§ Denetim Hizmeti': 'ic_denetim_hizmeti',\n    'TedarikÃ§i MÃ¼ÅŸteri Mali Denetim': 'tedarikci_musteri_mali_denetim',\n    'TedarikÃ§i Kalite Denetim': 'tedarikci_kalite_denetim',\n    'TedarikÃ§i Ãœretim Denetleme': 'tedarikci_uretim_denetleme',\n    'Firma Temsil Hizmeti': 'firma_temsil_hizmeti',\n\n    // === Ä°NÅAAT EMLAK ===\n    'SatÄ±lÄ±k Gayrimenkul': 'satilik_gayrimenkul',\n    'KiralÄ±k Gayrimenkul': 'kiralik_gayrimenkul',\n    'YurtdÄ±ÅŸÄ± Gayrimenkul YatÄ±rÄ±m': 'yurtdisi_gayrimenkul_yatirim',\n    'Ä°nÅŸaat TaahhÃ¼t Hizmeti': 'insaat_taahhut_hizmeti',\n\n    // === CRM HÄ°ZMETLERÄ° ===\n    'MÃ¼ÅŸteri SeÃ§imi': 'musteri_secimi',\n    'MÃ¼ÅŸteri Edinme': 'musteri_edinme',\n    'MÃ¼ÅŸteri Koruma': 'musteri_koruma',\n    'MÃ¼ÅŸteri DerinleÅŸtirme': 'musteri_derinlestirme',\n\n    // === TEKSTÄ°L ÃœRÃœNLERÄ° ===\n    'Erkek Giyim': 'erkek_giyim',\n    'KadÄ±n Giyim': 'kadin_giyim',\n    'Ev Tekstil ÃœrÃ¼nleri': 'ev_tekstil_urunleri',\n\n    // === KOZMETÄ°K ÃœRÃœNLERÄ° ===\n    'ParfÃ¼m': 'parfum',\n    'Deodorant': 'deodorant',\n    'KiÅŸisel BakÄ±m': 'kisisel_bakim',\n    'Medikal Kozmetik': 'medikal_kozmetik',\n\n    // === TUR ORGANÄ°ZASYON ===\n    'YurtiÃ§i Ã–zel Gezi Talebi': 'yurtici_ozel_gezi_talebi',\n    'YurtdÄ±ÅŸÄ± Ã–zel Gezi Talebi': 'yurtdisi_ozel_gezi_talebi',\n    'Personel Servis Talebi': 'personel_servis_talebi',\n\n    // === GÃœNEÅ ENERJÄ°SÄ° SÄ°STEMLERÄ° ===\n    'GÃ¼neÅŸ Verimlilik HesabÄ±': 'gunes_verimlilik_hesabi',\n    'GES Ãœretim Hesaplama': 'ges_uretim_hesaplama',\n    'GES Kurulum Hesaplama': 'ges_kurulum_hesaplama',\n\n    // === KURUMSAL HÄ°ZMETLER ===\n    'Ä°nsan KaynaklarÄ± DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'insan_kaynaklari_danismanligi',\n    'Stratejik Planlama DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'stratejik_planlama_danismanligi',\n    'Finansal DanÄ±ÅŸmanlÄ±k': 'finansal_danismanlik',\n    'Operasyonel Ä°yileÅŸtirme': 'operasyonel_iyilestirme',\n    'Kurumsal Ä°letiÅŸim DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'kurumsal_iletisim_danismanligi',\n    'Yasal DanÄ±ÅŸmanlÄ±k': 'yasal_danismanlik',\n    'Teknoloji DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'teknoloji_danismanlik',\n    'Kurumsal EÄŸitim Hizmetleri': 'kurumsal_egitim_hizmetleri'\n  };\n\n  const serviceKey = conversions[categoryName];\n  \n  if (serviceKey) {\n    console.log(`ğŸ”„ Servis dÃ¶nÃ¼ÅŸÃ¼mÃ¼: \"${categoryName}\" -> \"${serviceKey}\"`);\n    return serviceKey;\n  } else {\n    // Fallback: otomatik dÃ¶nÃ¼ÅŸÃ¼m\n    const autoConverted = categoryName.toLowerCase()\n      .replace(/ /g, '_')\n      .replace(/[Ä±Ä°]/g, 'i')\n      .replace(/[ÅŸÅ]/g, 's')\n      .replace(/[ÄŸÄ]/g, 'g')\n      .replace(/[Ã¼Ãœ]/g, 'u')\n      .replace(/[Ã§Ã‡]/g, 'c')\n      .replace(/[Ã¶Ã–]/g, 'o');\n    \n    console.log(`âš ï¸  Servis bulunamadÄ±, otomatik dÃ¶nÃ¼ÅŸÃ¼m: \"${categoryName}\" -> \"${autoConverted}\"`);\n    return autoConverted;\n  }\n}\n\n// TÃ¼m mevcut servis anahtarlarÄ±nÄ± listele - DÃœZELTÄ°LDÄ°\nfunction getAllServiceKeys() {\n  return {\n    sigorta: [\n      'yesil_sigorta', // yesil_sigortasi â†’ yesil_sigorta\n      'trafik_sigortasi',\n      'kasko',\n      'koltuk_sigortasi',\n      'dask',\n      'konut_sigortasi',\n      'isyeri_sigortasi',\n      'seyahat_saglik_sigortasi',\n      'tamamlayici_saglik_sigortasi',\n      'ozel_saglik_sigortasi'\n    ],\n    // ... diÄŸer kategoriler aynÄ± kalacak\n    yazilim: [\n      'ozel_yazilim_gelistirme', 'mobil_uygulama_gelistirme'\n    ],\n    siber_guvenlik: [\n      'genel_ag_guvenligi',\n      'kullanici_guvenligi',\n      'veri_guvenligi',\n      'uygulama_guvenligi',\n      'kimlik_erisim_yonetimi',\n      'guvenlik_yonetimi',\n      'penetrasyon_test_talebi',\n      'egitim_talepleri'\n    ],\n    lojistik: [\n      'yurtici_yuk_nakli', 'yurtdisi_yuk_nakli', 'depo_antrepo_hizmeti'\n    ],\n    ithalat_ihracat: [\n      'yurtdisi_musteri_arastirma',\n      'yurtici_tedarikci_arastirma',\n      'gumruk_operasyon_hizmetleri',\n      'yurtici_urun_arastirma',\n      'yurtdisi_pazar_arastirma'\n    ],\n    profesyonel_denetleme: [\n      'ic_denetim_hizmeti',\n      'tedarikci_musteri_mali_denetim',\n      'tedarikci_kalite_denetim',\n      'tedarikci_uretim_denetleme',\n      'firma_temsil_hizmeti'\n    ],\n    insaat_emlak: [\n      'satilik_gayrimenkul',\n      'kiralik_gayrimenkul',\n      'yurtdisi_gayrimenkul_yatirim',\n      'insaat_taahhut_hizmeti'\n    ],\n    crm: [\n      'musteri_secimi',\n      'musteri_edinme',\n      'musteri_koruma',\n      'musteri_derinlestirme'\n    ],\n    tekstil: [ 'erkek_giyim', 'kadin_giyim', 'ev_tekstil_urunleri' ],\n    kozmetik: [ 'parfum', 'deodorant', 'kisisel_bakim', 'medikal_kozmetik' ],\n    tur: [\n      'yurtici_ozel_gezi_talebi',\n      'yurtdisi_ozel_gezi_talebi',\n      'personel_servis_talebi'\n    ],\n    gunes_enerjisi: [\n      'gunes_verimlilik_hesabi',\n      'ges_uretim_hesaplama',\n      'ges_kurulum_hesaplama'\n    ],\n    kurumsal: [\n      'insan_kaynaklari_danismanligi',\n      'stratejik_planlama_danismanligi',\n      'finansal_danismanlik',\n      'operasyonel_iyilestirme',\n      'kurumsal_iletisim_danismanligi',\n      'yasal_danismanlik',\n      'teknoloji_danismanlik',\n      'kurumsal_egitim_hizmetleri'\n    ]\n  };\n}\n\n// Servis anahtarÄ±nÄ± doÄŸrula\nfunction validateServiceKey(serviceKey, services) {\n  for (const [category, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n      return {\n        isValid: true,\n        category: category,\n        serviceData: categoryServices[serviceKey]\n      };\n    }\n  }\n  \n  return {\n    isValid: false,\n    error: `Servis bulunamadÄ±: ${serviceKey}`\n  };\n}\n\nmodule.exports = {\n  convertToServiceKey,\n  getAllServiceKeys,\n  validateServiceKey\n};","size_bytes":7517},"micro-modules/session/startHelpTimer.js":{"content":"// micro-modules/session/startHelpTimer.js\nconst logger = require('../../core/logger');\nconst sessionManager = require('../../core/sessionManager');\nconst showMainMenu = require('../menu/showMainMenu');\nconst handleGoodbye = require('./handleGoodbye');\n\nfunction startHelpTimer(userId, message, services) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.helpTimer) {\n    clearTimeout(session.helpTimer);\n  }\n  if (session && session.goodbyeTimer) {\n    clearTimeout(session.goodbyeTimer);\n  }\n\n  logger.info(`â° YardÄ±m timer baÅŸlatÄ±ldÄ± - KullanÄ±cÄ±: ${userId}`);\n\n  const helpTimer = setTimeout(async () => {\n    const currentSession = sessionManager.getUserSession(userId);\n    if (currentSession && currentSession.waitingForHelp) {\n      logger.info(`â° YardÄ±m zaman aÅŸÄ±mÄ± - MenÃ¼ gÃ¶steriliyor: ${userId}`);\n      \n      await showMainMenu(message, services);\n      \n      const goodbyeTimer = setTimeout(async () => {\n        await handleGoodbye(message);\n      }, 3 * 60 * 1000);\n      \n      sessionManager.updateUserSession(userId, { \n        waitingForHelp: false, \n        helpTimer: null,\n        goodbyeTimer: goodbyeTimer\n      });\n    }\n  }, 3 * 60 * 1000);\n\n  sessionManager.updateUserSession(userId, { \n    waitingForHelp: true, \n    helpTimer: helpTimer\n  });\n}\n\nmodule.exports = startHelpTimer;","size_bytes":1357},"modules/messageHandler/greetingManager.js":{"content":"// modules/messageHandler/greetingManager.js - GÃœNCELLENDÄ°\nconst serviceLoader = require('../serviceLoader');\nconst personalization = require('./personalization');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendGreetingMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('Selamlama mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\nfunction getTimeBasedGreeting() {\n  const hour = new Date().getHours();\n  \n  if (hour >= 5 && hour < 11) return 'gunaydin';\n  if (hour >= 11 && hour < 17) return 'merhaba';\n  return 'iyi_aksamlar';\n}\n\nasync function handleGreeting(message, services, contactName = '') {\n  const greetingType = getTimeBasedGreeting();\n  const greetingMsg = personalization.createPersonalizedGreeting(contactName, greetingType);\n  \n  await sendGreetingMessage(message, greetingMsg);\n  \n  // Hemen ardÄ±ndan yardÄ±m sorusunu sor\n  setTimeout(async () => {\n    const helpQuestion = contactName ? \n      `ğŸ¤” ${contactName}, size yardÄ±mcÄ± olabilmem iÃ§in lÃ¼tfen bana hangi konuda yardÄ±m istediÄŸinizi yazarmÄ±sÄ±nÄ±z?` :\n      `ğŸ¤” Size yardÄ±mcÄ± olabilmem iÃ§in lÃ¼tfen bana hangi konuda yardÄ±m istediÄŸinizi yazarmÄ±sÄ±nÄ±z?`;\n    \n    await sendGreetingMessage(message, helpQuestion);\n    \n    const sessionManager = require('../sessionManager');\n    sessionManager.startHelpTimer(message.from, message, services);\n  }, 1000);\n  \n  return true;\n}\n\n// TeÅŸekkÃ¼r mesajÄ±nÄ± iÅŸle - GÃœNCELLENDÄ°\nasync function handleThanks(message, contactName = '') {\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const thanksResponses = greetings?.tesekkur?.tesekkur_cevaplari || [\n    'ğŸ™ Rica ederim! Size yardÄ±mcÄ± olabildiÄŸim iÃ§in ben teÅŸekkÃ¼r ederim. ğŸ¯'\n  ];\n  \n  // Rastgele bir teÅŸekkÃ¼r cevabÄ± seÃ§\n  const randomThanks = thanksResponses[Math.floor(Math.random() * thanksResponses.length)];\n  \n  let thanksMsg = randomThanks;\n  if (contactName) {\n    thanksMsg = `${contactName}, ${randomThanks.toLowerCase()}`;\n  }\n  \n  thanksMsg += `\\n\\nBaÅŸka bir konuda yardÄ±ma ihtiyacÄ±nÄ±z varsa \"menÃ¼\" yazabilirsiniz.`;\n  \n  await sendGreetingMessage(message, thanksMsg);\n  return true;\n}\n\n// VedalaÅŸma mesajÄ±nÄ± iÅŸle - GÃœNCELLENDÄ°\nasync function handleGoodbye(message, contactName = '') {\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const goodbyeResponses = greetings?.vedalasma?.hoscakal || [\n    'ğŸ‘‹ HoÅŸÃ§a kalÄ±n! PlanB Global Network Ltd Åti adÄ±na iyi gÃ¼nler dilerim.'\n  ];\n  \n  // Rastgele bir vedalaÅŸma mesajÄ± seÃ§\n  const randomGoodbye = goodbyeResponses[Math.floor(Math.random() * goodbyeResponses.length)];\n  \n  let goodbyeMsg = randomGoodbye;\n  if (contactName) {\n    goodbyeMsg = `${contactName}, ${randomGoodbye}`;\n  }\n  \n  await sendGreetingMessage(message, goodbyeMsg);\n  \n  // Oturumu temizle\n  const sessionManager = require('../sessionManager');\n  sessionManager.updateUserSession(message.from, {\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  return true;\n}\n\nmodule.exports = {\n  getTimeBasedGreeting,\n  handleGreeting,\n  handleThanks,\n  handleGoodbye\n};","size_bytes":3426},"README.md":{"content":"# ARYA Bot ğŸ¤–\n\n**PlanB Global Network Ltd Åti iÃ§in WhatsApp Business Otomasyon Sistemi**\n\n## ğŸ“‹ Genel BakÄ±ÅŸ\n\nARYA Bot, 12 ana kategori ve 70+ alt hizmet sunan kapsamlÄ± bir WhatsApp Business otomasyon Ã§Ã¶zÃ¼mÃ¼dÃ¼r. MÃ¼ÅŸteri etkileÅŸimlerini otomatikleÅŸtirir ve iÅŸ sÃ¼reÃ§lerini optimize eder.\n\n## ğŸš€ Ã–zellikler\n\n### Ana Hizmet Kategorileri\n- ğŸ›¡ï¸ **Sigorta Hizmetleri** (Trafik, Kasko, DASK, Konut, vb.)\n- ğŸ’» **YazÄ±lÄ±m Talepleri** (Ã–zel YazÄ±lÄ±m, Mobil Uygulama)\n- ğŸ”’ **Siber GÃ¼venlik** (AÄŸ GÃ¼venliÄŸi, Penetrasyon Testi, EÄŸitim)\n- ğŸšš **Lojistik Hizmetleri** (YurtiÃ§i/YurtdÄ±ÅŸÄ± Nakliye, Depolama)\n- ğŸŒ **Ä°thalat Ä°hracat** (Pazar AraÅŸtÄ±rmasÄ±, GÃ¼mrÃ¼k Hizmetleri)\n- ğŸ“Š **Profesyonel Denetleme** (Ä°Ã§ Denetim, TedarikÃ§i Denetimi)\n- ğŸ  **Ä°nÅŸaat Emlak** (Gayrimenkul, TaahhÃ¼t Hizmetleri)\n- ğŸ¤ **CRM Hizmetleri** (MÃ¼ÅŸteri SeÃ§imi, Edinme, Koruma)\n- ğŸ‘• **Tekstil ÃœrÃ¼nleri** (Erkek/KadÄ±n Giyim, Ev Tekstili)\n- ğŸ’„ **Kozmetik ÃœrÃ¼nleri** (ParfÃ¼m, KiÅŸisel BakÄ±m, Medikal)\n- âœˆï¸ **Tur Organizasyon** (YurtiÃ§i/YurtdÄ±ÅŸÄ± Gezi, Servis)\n- â˜€ï¸ **GÃ¼neÅŸ Enerjisi** (GES Kurulum, Verimlilik Hesaplama)\n- ğŸ¢ **Kurumsal Hizmetler** (DanÄ±ÅŸmanlÄ±k, EÄŸitim, Strateji)\n\n## ğŸ› ï¸ Kurulum\n\n### Gereksinimler\n- Node.js 16.0.0 veya Ã¼zeri\n- WhatsApp Business API eriÅŸimi\n\n### AdÄ±mlar\n1. Depoyu klonlayÄ±n:\n```bash\ngit clone https://github.com/planb-global/arya-bot.git\ncd arya-bot","size_bytes":1438},"modules/messageHandler.js":{"content":"// modules/messageHandler.js - BASÄ°TLEÅTÄ°RÄ°LMÄ°Å VERSÄ°YON\nconst logger = require('./logger');\nconst messageParser = require('./messageHandler/messageParser');\nconst sessionRouter = require('./messageHandler/sessionRouter');\nconst contactManager = require('./messageHandler/contactManager');\nconst validation = require('./messageHandler/validation');\nconst errorHandler = require('./messageHandler/errorHandler');\nconst { sendMessageWithoutQuote } = require('./utils/globalClient');\n\n// Hugging Face AsistanÄ±nÄ± ekle\nconst HuggingFaceAsistan = require('../huggingface-asistan');\nconst hfAsistan = new HuggingFaceAsistan();\n\n// Global servis durumu deÄŸiÅŸkeni - basit Ã§Ã¶zÃ¼m\nlet serviceFound = false;\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendReply(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n    logger.info(`ğŸ“¤ Mesaj gÃ¶nderildi (alÄ±ntÄ±sÄ±z): ${message.from}`);\n  } catch (error) {\n    logger.error(`Mesaj gÃ¶nderme hatasÄ±: ${error.message}`);\n    // Fallback: normal reply kullan\n    try {\n      await message.reply(text);\n    } catch (fallbackError) {\n      logger.error(`Fallback mesaj gÃ¶nderme de baÅŸarÄ±sÄ±z: ${fallbackError.message}`);\n    }\n  }\n}\n\n// Hugging Face ile yanÄ±t oluÅŸtur\nasync function generateHuggingFaceResponse(message) {\n  try {\n    console.log('ğŸ¤– Hugging Face ile yanÄ±t oluÅŸturuluyor...');\n    const hfResponse = await hfAsistan.generateResponse(message.body);\n    console.log(`ğŸ’¬ Hugging Face YanÄ±tÄ±: \"${hfResponse}\"`);\n    await sendReply(message, hfResponse);\n    return true;\n  } catch (hfError) {\n    console.error('âŒ Hugging Face yanÄ±t hatasÄ±:', hfError);\n    return false;\n  }\n}\n\n// Servis durumunu kontrol et (basit fonksiyon)\nfunction checkServiceFound() {\n  return serviceFound;\n}\n\n// Ana mesaj iÅŸleme fonksiyonu - BASÄ°TLEÅTÄ°RÄ°LMÄ°Å\nasync function handleMessage(message) {\n  try {\n    // Servis bulma durumunu sÄ±fÄ±rla\n    serviceFound = false;\n    console.log(`ğŸ” Servis bulundu durumu: ${serviceFound}`);\n    \n    // 1. MesajÄ± doÄŸrula\n    const validationResult = validation.validateMessage(message);\n    if (!validationResult.isValid) {\n      if (validationResult.reason === 'has_media') {\n        await errorHandler.handleMediaError(message);\n      }\n      return;\n    }\n\n    // 2. MÃ¼ÅŸteri bilgilerini al ve logla\n    const contactInfo = await contactManager.logContactInteraction(message, 'Mesaj alÄ±ndÄ±');\n    \n    // 3. Oturumu baÅŸlat/gÃ¼ncelle\n    const sessionManager = require('./sessionManager');\n    let session = sessionManager.getUserSession(message.from);\n    \n    console.log(`ğŸ” Oturum durumu: ${session.currentState}, Mesaj: \"${validationResult.messageBody}\"`);\n    \n    // 4. KullanÄ±cÄ± cevap verdiÄŸinde tÃ¼m timer'larÄ± durdur\n    sessionManager.stopHelpTimer(message.from);\n    sessionManager.stopMenuTimer(message.from);\n    \n    // 5. MesajÄ± ayrÄ±ÅŸtÄ±r\n    const parsedMessage = messageParser.parseMessage(validationResult.messageBody);\n    \n    console.log(`ğŸ“ Mesaj ayrÄ±ÅŸtÄ±rma: Orijinal=\"${validationResult.messageBody}\", Selamlama=\"${parsedMessage.greetingPart}\", Ä°ÅŸlem=\"${parsedMessage.servicePart}\"`);\n    \n    // 6. Oturum durumuna gÃ¶re yÃ¶nlendir\n    await sessionRouter.route(message, parsedMessage, contactInfo.name, () => {\n      // Callback: servis bulunduÄŸunda Ã§aÄŸrÄ±lacak\n      serviceFound = true;\n      console.log('âœ… Servis bulundu - Hugging Face atlanacak');\n    });\n    \n    // 7. EÄŸer modÃ¼ler sistem servis bulamazsa, Hugging Face'e yÃ¶nlendir\n    if (!serviceFound) {\n      console.log('ğŸ” ModÃ¼ler sistem servis bulamadÄ±, Hugging Face deneniyor...');\n      const hfSuccess = await generateHuggingFaceResponse(message);\n      \n      if (!hfSuccess) {\n        // Hugging Face de baÅŸarÄ±sÄ±z olursa genel hata mesajÄ±\n        await sendReply(message, 'âŒ ÃœzgÃ¼nÃ¼m, bu konuda size yardÄ±mcÄ± olamadÄ±m. LÃ¼tfen baÅŸka bir soru sormayÄ± deneyin veya \"yardÄ±m\" yazarak hizmetlerimizi gÃ¶rÃ¼n.');\n      }\n    }\n    \n  } catch (error) {\n    console.log(`âŒ Mesaj iÅŸleme hatasÄ±: ${error.message}`);\n    \n    // Hata durumunda Hugging Face'i dene\n    console.log('ğŸ”„ Hata durumunda Hugging Face deneniyor...');\n    try {\n      const hfSuccess = await generateHuggingFaceResponse(message);\n      if (!hfSuccess) {\n        await errorHandler.handleError(message, error);\n      }\n    } catch (finalError) {\n      await errorHandler.handleError(message, finalError);\n    }\n  }\n}\n\nmodule.exports = {\n  handleMessage,\n  sendReply,\n  checkServiceFound,\n  generateHuggingFaceResponse,\n  getTimeBasedGreeting: require('./messageHandler/greetingManager').getTimeBasedGreeting,\n  isGreeting: messageParser.isGreeting,\n  parseMessage: messageParser.parseMessage,\n  handleGreeting: require('./messageHandler/greetingManager').handleGreeting,\n  findMatchingService: require('./messageHandler/serviceMatcher').findMatchingService,\n  createPersonalizedGreeting: require('./messageHandler/personalization').createPersonalizedGreeting\n};","size_bytes":5034},"micro-modules/session/handleGoodbye.js":{"content":"// micro-modules/session/handleGoodbye.js\nconst serviceLoader = require('../../core/serviceLoader');\nconst sessionManager = require('../../core/sessionManager');\nconst logger = require('../../core/logger');\n\nasync function handleGoodbye(message) {\n  const greetings = serviceLoader.loadJSON('./data/genel_diyalog/selamlama_vedalasma.json');\n  const goodbyeMsg = greetings?.vedalasma?.hoscakal?.[0] || \n                    'HoÅŸÃ§a kalÄ±n! PlanB Global Network Ltd Åti adÄ±na iyi gÃ¼nler dilerim.';\n  \n  await message.reply(goodbyeMsg);\n  \n  logger.info(`ğŸ‘‹ VedalaÅŸma mesajÄ± gÃ¶nderildi - KullanÄ±cÄ±: ${message.from}`);\n  \n  sessionManager.updateUserSession(message.from, {\n    currentState: 'main_menu',\n    waitingForHelp: false,\n    helpTimer: null,\n    goodbyeTimer: null\n  });\n}\n\nmodule.exports = handleGoodbye;","size_bytes":821},"huggingface-asistan.js":{"content":"// huggingface-asistan.js - TÃœRKÃ‡E BERT Ä°LE\nconst fetch = require('node-fetch');\n\nclass HuggingFaceAsistan {\n  constructor() {\n    this.apiKey = \"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\"; // Token'Ä±nÄ±z burada\n    this.model = \"akdeniz27/bert-base-turkish-cased-ner\"; // TÃœRKÃ‡E BERT\n  }\n\n  async generateResponse(userMessage, userId = \"default\") {\n    try {\n      console.log(`ğŸ¤– TÃ¼rkÃ§e BERT'e sorgu: \"${userMessage}\"`);\n\n      // BERT iÃ§in farklÄ± bir API endpoint'i kullanÄ±yoruz\n      const response = await fetch(\n        `https://api-inference.huggingface.co/models/${this.model}`,\n        {\n          method: \"POST\",\n          headers: { \n            \"Authorization\": `Bearer ${this.apiKey}`,\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            inputs: {\n              \"source_sentence\": userMessage,\n              \"sentences\": [\n                \"sigorta talebi\",\n                \"emlak ilanÄ±\", \n                \"yazÄ±lÄ±m hizmeti\",\n                \"enerji danÄ±ÅŸmanlÄ±ÄŸÄ±\",\n                \"genel soru\"\n              ]\n            }\n          })\n        }\n      );\n\n      console.log(\"ğŸ“¡ Status:\", response.status);\n      \n      if (response.status === 200) {\n        const data = await response.json();\n        console.log(\"ğŸ“Š BERT YanÄ±tÄ±:\", data);\n        \n        // BERT benzerlik skorlarÄ±nÄ± iÅŸle\n        return this.processBertResponse(data, userMessage);\n      } else {\n        console.log(\"âŒ BERT HatasÄ±:\", response.status);\n        return this.getSmartFallback(userMessage);\n      }\n      \n    } catch (error) {\n      console.error(\"âŒ BERT BaÄŸlantÄ± HatasÄ±:\", error.message);\n      return this.getSmartFallback(userMessage);\n    }\n  }\n\n  processBertResponse(bertScores, userMessage) {\n    // BERT benzerlik skorlarÄ±nÄ± iÅŸle\n    // bertScores: [0.8, 0.6, 0.3, 0.2, 0.1] gibi bir dizi\n    \n    if (!bertScores || !Array.isArray(bertScores)) {\n      return this.getSmartFallback(userMessage);\n    }\n\n    const categories = [\"sigorta\", \"emlak\", \"yazilim\", \"enerji\", \"genel\"];\n    const maxScore = Math.max(...bertScores);\n    const bestMatchIndex = bertScores.indexOf(maxScore);\n    const bestCategory = categories[bestMatchIndex];\n\n    console.log(`ğŸ¯ BERT Tahmini: ${bestCategory} (skor: ${maxScore})`);\n\n    // En yÃ¼ksek skora gÃ¶re yanÄ±t ver\n    return this.getCategoryResponse(bestCategory, userMessage);\n  }\n\n  getCategoryResponse(category, message) {\n    const lowerMessage = message.toLowerCase();\n    \n    switch(category) {\n      case \"sigorta\":\n        if (lowerMessage.includes('trafik')) {\n          return 'Trafik sigortasÄ± teklifi iÃ§in aracÄ±nÄ±zÄ±n plakasÄ±nÄ± Ã¶ÄŸrenebilir miyim? ğŸš—';\n        }\n        if (lowerMessage.includes('kasko')) {\n          return 'Kasko sigortasÄ± iÃ§in aracÄ±nÄ±zÄ±n marka ve modelini sorabilir miyim? ğŸ›¡ï¸';\n        }\n        return 'Sigorta hizmetlerimiz hakkÄ±nda size nasÄ±l yardÄ±mcÄ± olabilirim? ğŸ›¡ï¸ Trafik, kasko veya DASK?';\n      \n      case \"emlak\":\n        if (lowerMessage.includes('kira')) {\n          return 'KiralÄ±k konut iÃ§in hangi lokasyonda ve ne bÃ¼yÃ¼klÃ¼kte daire arÄ±yorsunuz? ğŸ ';\n        }\n        return 'Emlak hizmetlerimizle ilgili yardÄ±mcÄ± olabilirim. ğŸ  KiralÄ±k mÄ± satÄ±lÄ±k mÄ±?';\n      \n      case \"yazilim\":\n        return 'YazÄ±lÄ±m geliÅŸtirme hizmetlerimiz iÃ§in size Ã¶zel Ã§Ã¶zÃ¼m sunabiliriz! ğŸ’» Mobil uygulama mÄ± web sitesi mi?';\n      \n      case \"enerji\":\n        return 'GÃ¼neÅŸ enerjisi Ã§Ã¶zÃ¼mlerimiz hakkÄ±nda detaylÄ± bilgi verebilirim â˜€ï¸ Kurulum mu danÄ±ÅŸmanlÄ±k mÄ±?';\n      \n      default:\n        return 'Size nasÄ±l yardÄ±mcÄ± olabilirim? ğŸŒŸ Sigorta, emlak, enerji veya yazÄ±lÄ±m hizmetlerimiz hakkÄ±nda bilgi alabilirsiniz.';\n    }\n  }\n\n  getSmartFallback(message) {\n    const lowerMessage = message.toLowerCase();\n    \n    if (lowerMessage.includes('sigorta')) {\n      return 'Sigorta hizmetlerimiz hakkÄ±nda bilgi verebilirim! ğŸ›¡ï¸';\n    }\n    if (lowerMessage.includes('kira') || lowerMessage.includes('emlak')) {\n      return 'Emlak hizmetlerimizle ilgili yardÄ±mcÄ± olabilirim. ğŸ ';\n    }\n    if (lowerMessage.includes('yazÄ±lÄ±m') || lowerMessage.includes('yazilim')) {\n      return 'YazÄ±lÄ±m geliÅŸtirme hizmetlerimiz iÃ§in bilgi alabilirsiniz! ğŸ’»';\n    }\n    if (lowerMessage.includes('enerji') || lowerMessage.includes('gÃ¼neÅŸ')) {\n      return 'GÃ¼neÅŸ enerjisi Ã§Ã¶zÃ¼mlerimiz hakkÄ±nda detaylÄ± bilgi verebilirim â˜€ï¸';\n    }\n    \n    return 'Size nasÄ±l yardÄ±mcÄ± olabilirim? ğŸŒŸ';\n  }\n}\n\nmodule.exports = HuggingFaceAsistan;","size_bytes":4580},"micro-modules/service/handlePriceList.js":{"content":"// micro-modules/service/handlePriceList.js\nconst saleFlow = require('../../handlers/saleFlow');\n\nasync function handlePriceList(message, service) {\n  const priceData = service.data;\n  \n  console.log(`ğŸ’° Fiyat listesi iÅŸleniyor: ${service.name}`, priceData);\n  \n  let priceText = `ğŸ’° *${service.name.replace(/_/g, ' ').toUpperCase()}*\\n\\n`;\n  \n  if (priceData.fiyat_tablosu) {\n    for (const [aracTipi, fiyatlar] of Object.entries(priceData.fiyat_tablosu)) {\n      priceText += `*${aracTipi}:*\\n`;\n      for (const [sure, fiyat] of Object.entries(fiyatlar)) {\n        const sureText = sure.replace('_gun', ' gÃ¼n').replace('15_gun', '15 gÃ¼n').replace('30_gun', '30 gÃ¼n').replace('90_gun', '90 gÃ¼n');\n        priceText += `  â€¢ ${sureText}: ${fiyat}\\n`;\n      }\n      priceText += '\\n';\n    }\n  }\n  \n  if (priceData.Ã¶nemli_bilgilendirme) {\n    priceText += `âš ï¸ *Ã–nemli Bilgilendirme:*\\n${priceData.Ã¶nemli_bilgilendirme}\\n\\n`;\n  }\n  \n  if (priceData.aciklama) {\n    priceText += `ğŸ“ *AÃ§Ä±klama:* ${priceData.aciklama}\\n\\n`;\n  }\n  \n  await message.reply(priceText);\n  \n  setTimeout(async () => {\n    await saleFlow.askForSale(message);\n  }, 2000);\n}\n\nmodule.exports = handlePriceList;","size_bytes":1200},"modules/menuHandler/subMenu.js":{"content":"// modules/menuHandler/subMenu.js\nconst logger = require('../logger');\nconst serviceConverter = require('./serviceConverter');\n\n// Alt menÃ¼ seÃ§imini iÅŸleme\nasync function handleSubMenuSelection(message, number, categoryName, services) {\n  console.log(`ğŸ¯ Alt menÃ¼ seÃ§imi: Kategori: ${categoryName}, SayÄ±: ${number}`);\n  \n  const categoryData = services[categoryName];\n  \n  if (!categoryData || !categoryData.category_options) {\n    await message.reply('âŒ Alt menÃ¼ bulunamadÄ±. Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor.');\n    const sessionManager = require('../sessionManager');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    const mainMenu = require('./mainMenu');\n    await mainMenu.showMainMenu(message, services);\n    return;\n  }\n\n  const selectedOption = categoryData.category_options.find(opt => opt.option_number === number);\n  \n  if (selectedOption) {\n    console.log(`âœ… Alt menÃ¼ seÃ§ildi: ${selectedOption.category_name}`);\n    \n    const serviceKey = serviceConverter.convertToServiceKey(selectedOption.category_name);\n    \n    // Servis anahtarÄ±nÄ± doÄŸrula\n    const validation = serviceConverter.validateServiceKey(serviceKey, services);\n    \n    if (validation.isValid) {\n      const foundService = {\n        type: 'service',\n        data: validation.serviceData,\n        category: validation.category,\n        name: serviceKey\n      };\n      \n      console.log(`âœ… Servis bulundu: ${validation.category}/${serviceKey}`);\n      const serviceFlow = require('../serviceFlow');\n      await serviceFlow.startServiceFlow(message, foundService);\n    } else {\n      console.log(`âŒ Servis bulunamadÄ±: ${serviceKey}`);\n      \n      // Debug iÃ§in tÃ¼m servisleri listele\n      const allServices = serviceConverter.getAllServiceKeys();\n      console.log('ğŸ“‹ Mevcut servisler:', allServices);\n      \n      // Hangi kategoride aradÄ±ÄŸÄ±nÄ± gÃ¶ster\n      console.log(`ğŸ” Arama yapÄ±lan kategoriler:`, Object.keys(services).filter(key => \n        key.includes('sigorta') || key.includes('yazilim') || key.includes('lojistik')\n      ));\n      \n      await message.reply(`âœ… *${selectedOption.category_name}* seÃ§ildi!\\n\\n` +\n                         `Bu hizmetle ilgili detaylÄ± bilgi iÃ§in en kÄ±sa sÃ¼rede sizinle iletiÅŸime geÃ§eceÄŸiz.\\n\\n` +\n                         `_Servis dosyasÄ± henÃ¼z hazÄ±rlanÄ±yor, yakÄ±nda aktif olacaktÄ±r._`);\n      \n      const sessionManager = require('../sessionManager');\n      sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n      const mainMenu = require('./mainMenu');\n      await mainMenu.showMainMenu(message, services);\n    }\n  } else {\n    const validNumbers = categoryData.category_options.map(opt => opt.option_number);\n    await message.reply(`âŒ GeÃ§ersiz numara. LÃ¼tfen ${Math.min(...validNumbers)}-${Math.max(...validNumbers)} arasÄ± bir numara girin.`);\n  }\n}\n\n// Kategori seÃ§eneklerini gÃ¶ster\nasync function showCategoryOptions(message, category, services) {\n  const categoryData = category.data;\n  \n  if (!categoryData) {\n    await message.reply('âŒ Kategori verileri bulunamadÄ±. Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor.');\n    const sessionManager = require('../sessionManager');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    const mainMenu = require('./mainMenu');\n    await mainMenu.showMainMenu(message, services);\n    return;\n  }\n  \n  let optionsText = `ğŸ¯ *${categoryData.bot_greeting || category.name.replace(/_/g, ' ').toUpperCase()}*\\n\\n`;\n  \n  if (categoryData.category_options && categoryData.category_options.length > 0) {\n    categoryData.category_options.forEach(option => {\n      optionsText += `${option.option_number}. ${option.category_name}\\n`;\n    });\n    \n    optionsText += `\\n${categoryData.completion_message || 'LÃ¼tfen bir numara seÃ§in:'}`;\n    \n    await message.reply(optionsText);\n  } else {\n    await message.reply('âŒ Bu kategoride henÃ¼z hizmet bulunmuyor. Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor.');\n    const sessionManager = require('../sessionManager');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    const mainMenu = require('./mainMenu');\n    await mainMenu.showMainMenu(message, services);\n  }\n}\n\n// Kategori seÃ§eneklerini doÄŸrula\nfunction validateCategoryOptions(categoryData) {\n  if (!categoryData || !categoryData.category_options) {\n    return { isValid: false, error: 'Kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  const validOptions = categoryData.category_options.filter(opt => \n    opt.option_number && opt.category_name && opt.category_name.trim().length > 0\n  );\n  \n  if (validOptions.length === 0) {\n    return { isValid: false, error: 'GeÃ§erli kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  // SayÄ±larÄ±n sÄ±ralÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol et\n  const numbers = validOptions.map(opt => opt.option_number).sort((a, b) => a - b);\n  const isSequential = numbers.every((num, index) => num === index + 1);\n  \n  if (!isSequential) {\n    console.log('âš ï¸  Kategori numaralarÄ± sÄ±ralÄ± deÄŸil:', numbers);\n  }\n  \n  return { \n    isValid: true, \n    options: validOptions,\n    count: validOptions.length,\n    isSequential: isSequential\n  };\n}\n\n// Kategori bilgilerini getir\nfunction getCategoryInfo(categoryName, services) {\n  const categoryData = services[categoryName];\n  if (!categoryData) {\n    return null;\n  }\n  \n  const validation = validateCategoryOptions(categoryData);\n  \n  return {\n    name: categoryName,\n    displayName: categoryData.bot_greeting || categoryName.replace(/_/g, ' '),\n    options: validation.isValid ? validation.options : [],\n    optionCount: validation.isValid ? validation.count : 0,\n    isValid: validation.isValid,\n    error: validation.error,\n    completionMessage: categoryData.completion_message || 'LÃ¼tfen bir numara seÃ§in:'\n  };\n}\n\n// Servis arama (debug iÃ§in)\nfunction searchServiceInAllCategories(serviceKey, services) {\n  console.log(`ğŸ” Servis aranÄ±yor: ${serviceKey}`);\n  \n  const foundIn = [];\n  \n  for (const [categoryName, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n      foundIn.push({\n        category: categoryName,\n        service: categoryServices[serviceKey]\n      });\n    }\n  }\n  \n  if (foundIn.length > 0) {\n    console.log(`âœ… Servis bulundu:`, foundIn.map(f => f.category));\n    return foundIn;\n  } else {\n    console.log(`âŒ Servis hiÃ§bir kategoride bulunamadÄ±: ${serviceKey}`);\n    \n    // Benzer servisleri Ã¶ner\n    const similarServices = findSimilarServices(serviceKey, services);\n    if (similarServices.length > 0) {\n      console.log(`ğŸ’¡ Benzer servisler:`, similarServices);\n    }\n    \n    return [];\n  }\n}\n\n// Benzer servisleri bul\nfunction findSimilarServices(serviceKey, services) {\n  const similar = [];\n  const searchTerm = serviceKey.toLowerCase();\n  \n  for (const [categoryName, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object') {\n      for (const [key, serviceData] of Object.entries(categoryServices)) {\n        if (key.toLowerCase().includes(searchTerm) || \n            (serviceData.service_name && serviceData.service_name.toLowerCase().includes(searchTerm))) {\n          similar.push({\n            category: categoryName,\n            key: key,\n            name: serviceData.service_name || key\n          });\n        }\n      }\n    }\n  }\n  \n  return similar;\n}\n\nmodule.exports = {\n  handleSubMenuSelection,\n  showCategoryOptions,\n  validateCategoryOptions,\n  getCategoryInfo,\n  searchServiceInAllCategories,\n  findSimilarServices\n};","size_bytes":7597},"guncelaryakodlar.js":{"content":"// GÃœNCELLENMÄ°Å ARYA BOT KODLARI - TEK DOSYA\n// TÃ¼m JavaScript dosyalarÄ± burada birleÅŸtirilmiÅŸtir\n============================================================\n\n\n============================================================\n// DOSYA: modules/utils/globalclient.js\n============================================================\n\n// modules/utils/globalClient.js - GÃœNCELLENDÄ°\nlet globalClient = null;\n\nfunction setGlobalClient(client) {\n  globalClient = client;\n}\n\nfunction getGlobalClient() {\n  return globalClient;\n}\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme fonksiyonu ekle\nasync function sendMessageWithoutQuote(chatId, message) {\n  if (!globalClient) {\n    throw new Error('Global client baÅŸlatÄ±lmamÄ±ÅŸ');\n  }\n  \n  try {\n    const chat = await globalClient.getChatById(chatId);\n    await chat.sendMessage(message);\n    return true;\n  } catch (error) {\n    console.error('Mesaj gÃ¶nderme hatasÄ±:', error);\n    throw error;\n  }\n}\n\nmodule.exports = {\n  setGlobalClient,\n  getGlobalClient,\n  sendMessageWithoutQuote\n};\n\n\n============================================================\n// DOSYA: modules/logger.js\n============================================================\n\n// Basit logger fonksiyonu\nconst logger = {\n  info: (message) => console.log(`[INFO] ${new Date().toISOString()}: ${message}`),\n  error: (message) => console.error(`[ERROR] ${new Date().toISOString()}: ${message}`),\n  warn: (message) => console.warn(`[WARN] ${new Date().toISOString()}: ${message}`)\n};\n\nmodule.exports = logger;\n\n\n============================================================\n// DOSYA: modules/validationutils.js\n============================================================\n\n// Cevap doÄŸrulama\nfunction validateAnswer(answer, fieldType) {\n  const cleanAnswer = answer.trim();\n  \n  switch (fieldType) {\n    case 'number':\n      const number = parseInt(cleanAnswer);\n      if (isNaN(number)) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz sayÄ± formatÄ±. LÃ¼tfen sadece rakam girin.'\n        };\n      }\n      return { isValid: true, cleanedValue: number };\n      \n    case 'date':\n      const dateRegex = /^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/;\n      const match = cleanAnswer.match(dateRegex);\n      if (!match) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz tarih formatÄ±. LÃ¼tfen GÃ¼n/Ay/YÄ±l formatÄ±nda girin (Ã–rnek: 15/01/2024).'\n        };\n      }\n      return { isValid: true, cleanedValue: cleanAnswer };\n      \n    case 'phone':\n      const phoneRegex = /^[5][0-9]{2}\\s?[0-9]{3}\\s?[0-9]{2}\\s?[0-9]{2}$/;\n      const cleanPhone = cleanAnswer.replace(/\\s/g, '');\n      if (!phoneRegex.test(cleanPhone)) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz telefon formatÄ±. LÃ¼tfen 5XX XXX XX XX formatÄ±nda girin.'\n        };\n      }\n      return { isValid: true, cleanedValue: cleanAnswer };\n      \n    case 'text':\n    default:\n      if (cleanAnswer.length < 2) {\n        return {\n          isValid: false,\n          errorMessage: 'Cevap Ã§ok kÄ±sa. LÃ¼tfen daha detaylÄ± bilgi verin.'\n        };\n      }\n      return { isValid: true, cleanedValue: cleanAnswer };\n  }\n}\n\nmodule.exports = {\n  validateAnswer\n};\n\n\n============================================================\n// DOSYA: modules/serviceloader.js\n============================================================\n\nconst fs = require('fs');\nconst path = require('path');\nconst logger = require('./logger');\n\n// JSON verilerini yÃ¼kleme fonksiyonu\nfunction loadJSON(filePath) {\n  try {\n    if (fs.existsSync(filePath)) {\n      const data = fs.readFileSync(filePath, 'utf8');\n      return JSON.parse(data);\n    }\n    return null;\n  } catch (error) {\n    logger.error(`JSON yÃ¼kleme hatasÄ± (${filePath}): ${error.message}`);\n    return null;\n  }\n}\n\n// TÃ¼m servisleri yÃ¼kle\nfunction loadAllServices() {\n  const services = {};\n  \n  // Ana kategorileri yÃ¼kle\n  const anaKategoriDosyalari = fs.readdirSync('./ana_kategoriler');\n  anaKategoriDosyalari.forEach(file => {\n    if (file.endsWith('.json')) {\n      const key = file.replace('.json', '');\n      services[key] = loadJSON(path.join('./ana_kategoriler', file));\n    }\n  });\n  \n  // Data klasÃ¶rÃ¼ndeki servisleri yÃ¼kle\n  const dataKlasorleri = fs.readdirSync('./data');\n  dataKlasorleri.forEach(klasor => {\n    const klasorYolu = path.join('./data', klasor);\n    if (fs.statSync(klasorYolu).isDirectory()) {\n      services[klasor] = {};\n      const servisDosyalari = fs.readdirSync(klasorYolu);\n      servisDosyalari.forEach(file => {\n        if (file.endsWith('.json')) {\n          const servisAdi = file.replace('.json', '');\n          services[klasor][servisAdi] = loadJSON(path.join(klasorYolu, file));\n        }\n      });\n    }\n  });\n  \n  // Fiyat listelerini yÃ¼kle\n  const fiyatKlasoru = './fiyat_listeleri';\n  if (fs.existsSync(fiyatKlasoru)) {\n    services['fiyat_listeleri'] = {};\n    const fiyatDosyalari = fs.readdirSync(fiyatKlasoru);\n    fiyatDosyalari.forEach(file => {\n      if (file.endsWith('.json')) {\n        const fiyatAdi = file.replace('.json', '');\n        services['fiyat_listeleri'][fiyatAdi] = loadJSON(path.join(fiyatKlasoru, file));\n      }\n    });\n  }\n  \n  return services;\n}\n\nmodule.exports = {\n  loadJSON,\n  loadAllServices\n};\n\n\n============================================================\n// DOSYA: modules/sessionmanager.js\n============================================================\n\nconst logger = require('./logger');\n\n// KullanÄ±cÄ± oturumlarÄ±nÄ± takip etmek iÃ§in\nconst userSessions = new Map();\n\n// KullanÄ±cÄ± oturumu oluÅŸtur\nfunction createUserSession(userId) {\n  const session = {\n    userId: userId,\n    lastActivity: Date.now(),\n    waitingForResponse: false,\n    waitingForHelp: false,\n    menuTimer: null,\n    saleTimer: null,\n    helpTimer: null,\n    goodbyeTimer: null,\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: null\n  };\n  \n  userSessions.set(userId, session);\n  return session;\n}\n\n// KullanÄ±cÄ± oturumunu gÃ¼ncelle\nfunction updateUserSession(userId, updates) {\n  const session = userSessions.get(userId) || createUserSession(userId);\n  Object.assign(session, updates);\n  session.lastActivity = Date.now();\n  userSessions.set(userId, session);\n  return session;\n}\n\n// YardÄ±m timer'Ä± baÅŸlat\nfunction startHelpTimer(userId, message, services) {\n  const session = getUserSession(userId);\n  if (session && session.helpTimer) {\n    clearTimeout(session.helpTimer);\n  }\n  if (session && session.goodbyeTimer) {\n    clearTimeout(session.goodbyeTimer);\n  }\n\n  logger.info(`â° YardÄ±m timer baÅŸlatÄ±ldÄ± - KullanÄ±cÄ±: ${userId}`);\n\n  // 1. Timer: 3 dakika sonra menÃ¼yÃ¼ gÃ¶ster\n  const helpTimer = setTimeout(async () => {\n    const currentSession = getUserSession(userId);\n    if (currentSession && currentSession.waitingForHelp) {\n      logger.info(`â° YardÄ±m zaman aÅŸÄ±mÄ± - MenÃ¼ gÃ¶steriliyor: ${userId}`);\n      \n      const menuHandler = require('./menuHandler');\n      await menuHandler.showMainMenu(message, services);\n      \n      // 2. Timer: 3 dakika sonra vedalaÅŸma\n      const goodbyeTimer = setTimeout(async () => {\n        await handleGoodbye(message);\n      }, 3 * 60 * 1000); // 3 dakika\n      \n      updateUserSession(userId, { \n        waitingForHelp: false, \n        helpTimer: null,\n        goodbyeTimer: goodbyeTimer\n      });\n    }\n  }, 3 * 60 * 1000); // 3 dakika\n\n  updateUserSession(userId, { \n    waitingForHelp: true, \n    helpTimer: helpTimer\n  });\n}\n\n// VedalaÅŸma iÅŸlemi\nasync function handleGoodbye(message) {\n  const serviceLoader = require('./serviceLoader');\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const goodbyeMsg = greetings?.vedalasma?.hoscakal?.[0] || \n                    'HoÅŸÃ§a kalÄ±n! PlanB Global Network Ltd Åti adÄ±na iyi gÃ¼nler dilerim.';\n  \n  await message.reply(goodbyeMsg);\n  \n  logger.info(`ğŸ‘‹ VedalaÅŸma mesajÄ± gÃ¶nderildi - KullanÄ±cÄ±: ${message.from}`);\n  \n  // Oturumu temizle\n  updateUserSession(message.from, {\n    currentState: 'main_menu',\n    waitingForHelp: false,\n    helpTimer: null,\n    goodbyeTimer: null\n  });\n}\n\n// YardÄ±m timer'Ä±nÄ± durdur (kullanÄ±cÄ± cevap verdiÄŸinde)\nfunction stopHelpTimer(userId) {\n  const session = getUserSession(userId);\n  if (session) {\n    if (session.helpTimer) {\n      clearTimeout(session.helpTimer);\n      logger.info(`â° YardÄ±m timer durduruldu - KullanÄ±cÄ±: ${userId}`);\n    }\n    if (session.goodbyeTimer) {\n      clearTimeout(session.goodbyeTimer);\n      logger.info(`â° VedalaÅŸma timer durduruldu - KullanÄ±cÄ±: ${userId}`);\n    }\n    updateUserSession(userId, { \n      waitingForHelp: false, \n      helpTimer: null,\n      goodbyeTimer: null\n    });\n  }\n}\n\n// MenÃ¼ zamanlayÄ±cÄ± baÅŸlat\nfunction startMenuTimer(userId, message, services) {\n  const session = getUserSession(userId);\n  if (session && session.menuTimer) {\n    clearTimeout(session.menuTimer);\n  }\n\n  const timer = setTimeout(async () => {\n    const currentSession = getUserSession(userId);\n    if (currentSession && currentSession.waitingForResponse) {\n      logger.info(`â° MenÃ¼ zaman aÅŸÄ±mÄ± - KullanÄ±cÄ±: ${userId}`);\n      const menuHandler = require('./menuHandler');\n      await menuHandler.showMainMenu(message, services);\n      updateUserSession(userId, { \n        waitingForResponse: false, \n        menuTimer: null,\n        currentState: 'main_menu'\n      });\n    }\n  }, 60000);\n\n  updateUserSession(userId, { \n    waitingForResponse: true, \n    menuTimer: timer,\n    currentState: 'waiting_for_service'\n  });\n}\n\n// MenÃ¼ zamanlayÄ±cÄ±yÄ± durdur\nfunction stopMenuTimer(userId) {\n  const session = getUserSession(userId);\n  if (session && session.menuTimer) {\n    clearTimeout(session.menuTimer);\n    updateUserSession(userId, { \n      waitingForResponse: false, \n      menuTimer: null\n    });\n  }\n}\n\n// SatÄ±ÅŸ zamanlayÄ±cÄ±sÄ±nÄ± temizle\nfunction clearSaleTimer(userId) {\n  const session = getUserSession(userId);\n  if (session && session.saleTimer) {\n    clearTimeout(session.saleTimer);\n    updateUserSession(userId, { saleTimer: null });\n  }\n}\n\n// Oturumu getir\nfunction getUserSession(userId) {\n  return userSessions.get(userId);\n}\n\nmodule.exports = {\n  createUserSession,\n  updateUserSession,\n  startMenuTimer,\n  stopMenuTimer,\n  clearSaleTimer,\n  getUserSession,\n  userSessions,\n  startHelpTimer,\n  stopHelpTimer,\n  handleGoodbye\n};\n\n\n============================================================\n// DOSYA: modules/menuHandler/numberhandler.js\n============================================================\n\n// modules/menuHandler/numberHandler.js - TAMAMEN GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendNumberMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('SayÄ± mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// SayÄ± seÃ§imini iÅŸleme\nasync function handleNumberSelection(message, number, services) {\n  const session = sessionManager.getUserSession(message.from);\n  const currentState = session?.currentState || 'main_menu';\n\n  console.log(`ğŸ”¢ SayÄ± iÅŸleniyor: ${number}, Durum: ${currentState}`);\n\n  // Alt menÃ¼ durumu kontrolÃ¼\n  if (currentState.startsWith('submenu_')) {\n    const categoryName = currentState.replace('submenu_', '');\n    const subMenu = require('./subMenu');\n    await subMenu.handleSubMenuSelection(message, number, categoryName, services);\n    return;\n  }\n\n  // Ana menÃ¼ durumu\n  const mainMenu = require('./mainMenu');\n  const mainCategories = mainMenu.getMainCategories();\n\n  // SayÄ± aralÄ±ÄŸÄ±nÄ± kontrol et\n  if (number >= 1 && number <= mainCategories.length) {\n    const selectedCategory = mainCategories[number - 1];\n    const categoryData = services[selectedCategory];\n    \n    if (categoryData) {\n      console.log(`âœ… Kategori seÃ§ildi: ${selectedCategory}`);\n      const subMenu = require('./subMenu');\n      await subMenu.showCategoryOptions(message, { data: categoryData, name: selectedCategory }, services);\n      sessionManager.updateUserSession(message.from, { currentState: `submenu_${selectedCategory}` });\n    } else {\n      console.log(`âŒ Kategori verisi bulunamadÄ±: ${selectedCategory}`);\n      await sendNumberMessage(message, 'âŒ Bu kategori bulunamadÄ±. LÃ¼tfen tekrar deneyin.');\n      \n      // Ana menÃ¼yÃ¼ tekrar gÃ¶ster\n      setTimeout(async () => {\n        await mainMenu.showMainMenu(message, services);\n      }, 1000);\n    }\n  } else {\n    console.log(`âŒ GeÃ§ersiz sayÄ± aralÄ±ÄŸÄ±: ${number}, Beklenen: 1-${mainCategories.length}`);\n    await sendNumberMessage(message, `âŒ GeÃ§ersiz numara. LÃ¼tfen 1-${mainCategories.length} arasÄ± bir numara girin.`);\n    \n    // Ana menÃ¼yÃ¼ tekrar gÃ¶ster\n    setTimeout(async () => {\n      await mainMenu.showMainMenu(message, services);\n    }, 1000);\n  }\n}\n\n// SayÄ± doÄŸrulama\nfunction validateNumberInput(number, min, max) {\n  console.log(`ğŸ” SayÄ± doÄŸrulanÄ±yor: ${number}, Min: ${min}, Max: ${max}`);\n  \n  // SayÄ±sal deÄŸilse\n  if (isNaN(number)) {\n    return { \n      isValid: false, \n      error: 'GeÃ§ersiz sayÄ± formatÄ±. LÃ¼tfen sadece rakam girin.' \n    };\n  }\n  \n  const parsedNumber = parseInt(number);\n  \n  // AralÄ±k kontrolÃ¼\n  if (parsedNumber < min || parsedNumber > max) {\n    return { \n      isValid: false, \n      error: `LÃ¼tfen ${min}-${max} arasÄ± bir numara girin` \n    };\n  }\n  \n  return { \n    isValid: true, \n    number: parsedNumber \n  };\n}\n\n// MenÃ¼ numaralarÄ±nÄ± formatla\nfunction formatMenuNumbers(options, startFrom = 1) {\n  console.log(`ğŸ“ MenÃ¼ numaralarÄ± formatlanÄ±yor: ${options.length} seÃ§enek, BaÅŸlangÄ±Ã§: ${startFrom}`);\n  \n  const formattedOptions = options.map((option, index) => {\n    // EÄŸer option_number zaten varsa, onu kullan\n    if (option.option_number) {\n      return option;\n    }\n    \n    // Yoksa yeni numara ata\n    return {\n      ...option,\n      option_number: startFrom + index\n    };\n  });\n  \n  console.log(`âœ… ${formattedOptions.length} seÃ§enek formatlandÄ±`);\n  return formattedOptions;\n}\n\n// GeÃ§erli sayÄ± aralÄ±ÄŸÄ±nÄ± getir\nfunction getValidNumberRange(session, services) {\n  const currentState = session?.currentState || 'main_menu';\n  \n  if (currentState.startsWith('submenu_')) {\n    const categoryName = currentState.replace('submenu_', '');\n    const categoryData = services[categoryName];\n    \n    if (categoryData && categoryData.category_options) {\n      const numbers = categoryData.category_options.map(opt => opt.option_number);\n      return {\n        min: Math.min(...numbers),\n        max: Math.max(...numbers),\n        count: numbers.length,\n        type: 'submenu'\n      };\n    }\n  } else {\n    // Ana menÃ¼\n    const mainMenu = require('./mainMenu');\n    const mainCategories = mainMenu.getMainCategories();\n    return {\n      min: 1,\n      max: mainCategories.length,\n      count: mainCategories.length,\n      type: 'main_menu'\n    };\n  }\n  \n  return {\n    min: 1,\n    max: 1,\n    count: 0,\n    type: 'unknown'\n  };\n}\n\n// Hata mesajÄ± gÃ¶nder\nasync function sendErrorMessage(message, session, services) {\n  const range = getValidNumberRange(session, services);\n  \n  let errorMessage = '';\n  \n  switch (range.type) {\n    case 'main_menu':\n      errorMessage = `âŒ GeÃ§ersiz numara. LÃ¼tfen 1-${range.max} arasÄ± bir numara girin.`;\n      break;\n    case 'submenu':\n      errorMessage = `âŒ GeÃ§ersiz numara. LÃ¼tfen ${range.min}-${range.max} arasÄ± bir numara girin.`;\n      break;\n    default:\n      errorMessage = 'âŒ GeÃ§ersiz seÃ§im. LÃ¼tfen menÃ¼den bir numara seÃ§in.';\n  }\n  \n  await sendNumberMessage(message, errorMessage);\n  \n  // Duruma gÃ¶re uygun menÃ¼yÃ¼ tekrar gÃ¶ster\n  setTimeout(async () => {\n    if (range.type === 'main_menu') {\n      const mainMenu = require('./mainMenu');\n      await mainMenu.showMainMenu(message, services);\n    } else if (range.type === 'submenu') {\n      const categoryName = session.currentState.replace('submenu_', '');\n      const categoryData = services[categoryName];\n      if (categoryData) {\n        const subMenu = require('./subMenu');\n        await subMenu.showCategoryOptions(message, { data: categoryData, name: categoryName }, services);\n      }\n    }\n  }, 1000);\n}\n\n// SayÄ± giriÅŸini iÅŸle (ana fonksiyon)\nasync function processNumberInput(message, input, services) {\n  const session = sessionManager.getUserSession(message.from);\n  const range = getValidNumberRange(session, services);\n  \n  console.log(`ğŸ”¢ SayÄ± iÅŸleniyor: \"${input}\", Durum: ${session?.currentState}, Beklenen aralÄ±k: ${range.min}-${range.max}`);\n  \n  // SayÄ±yÄ± doÄŸrula\n  const validation = validateNumberInput(input, range.min, range.max);\n  \n  if (!validation.isValid) {\n    console.log(`âŒ SayÄ± doÄŸrulama baÅŸarÄ±sÄ±z: ${validation.error}`);\n    await sendNumberMessage(message, `âŒ ${validation.error}`);\n    return false;\n  }\n  \n  const number = validation.number;\n  console.log(`âœ… SayÄ± doÄŸrulandÄ±: ${number}`);\n  \n  // SayÄ±yÄ± iÅŸle\n  await handleNumberSelection(message, number, services);\n  return true;\n}\n\n// Debug bilgilerini logla\nfunction logNumberProcessing(session, number, services) {\n  const range = getValidNumberRange(session, services);\n  \n  console.log('ğŸ” SAYI Ä°ÅLEME DEBUG:');\n  console.log(`- Mevcut durum: ${session?.currentState || 'main_menu'}`);\n  console.log(`- Girilen sayÄ±: ${number}`);\n  console.log(`- Beklenen aralÄ±k: ${range.min}-${range.max}`);\n  console.log(`- MenÃ¼ tipi: ${range.type}`);\n  console.log(`- SeÃ§enek sayÄ±sÄ±: ${range.count}`);\n  \n  if (range.type === 'submenu') {\n    const categoryName = session.currentState.replace('submenu_', '');\n    const categoryData = services[categoryName];\n    if (categoryData && categoryData.category_options) {\n      console.log(`- Mevcut seÃ§enekler:`, categoryData.category_options.map(opt => ({\n        num: opt.option_number,\n        name: opt.category_name\n      })));\n    }\n  }\n}\n\nmodule.exports = {\n  handleNumberSelection,\n  validateNumberInput,\n  formatMenuNumbers,\n  getValidNumberRange,\n  sendErrorMessage,\n  processNumberInput,\n  logNumberProcessing\n};\n\n\n============================================================\n// DOSYA: modules/menuHandler/serviceconverter.js\n============================================================\n\n// modules/menuHandler/serviceConverter.js\nconst logger = require('../logger');\n\n// Servis anahtarÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼rme - DÃœZELTÄ°LDÄ°\nfunction convertToServiceKey(categoryName) {\n  const conversions = {\n    // === SÄ°GORTA HÄ°ZMETLERÄ° ===\n    'YeÅŸil Sigorta': 'yesil_sigorta', // yesil_sigortasi â†’ yesil_sigorta\n    'Trafik SigortasÄ±': 'trafik_sigortasi',\n    'KASKO': 'kasko',\n    'Koltuk SigortasÄ±': 'koltuk_sigortasi',\n    'DASK': 'dask',\n    'Konut SigortasÄ±': 'konut_sigortasi',\n    'Ä°ÅŸyeri SigortasÄ±': 'isyeri_sigortasi',\n    'Seyahat SaÄŸlÄ±k SigortasÄ±': 'seyahat_saglik_sigortasi',\n    'TamamlayÄ±cÄ± SaÄŸlÄ±k SigortasÄ±': 'tamamlayici_saglik_sigortasi',\n    'Ã–zel SaÄŸlÄ±k SigortasÄ±': 'ozel_saglik_sigortasi',\n\n    // === YAZILIM TALEPLERÄ° ===\n    'Ã–zel YazÄ±lÄ±m GeliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'Mobil Uygulama GeliÅŸtirme': 'mobil_uygulama_gelistirme',\n\n    // === SÄ°BER GÃœVENLÄ°K ===\n    'Genel AÄŸ GÃ¼venliÄŸi': 'genel_ag_guvenligi',\n    'KullanÄ±cÄ± GÃ¼venliÄŸi': 'kullanici_guvenligi',\n    'Veri GÃ¼venliÄŸi': 'veri_guvenligi',\n    'Uygulama GÃ¼venliÄŸi': 'uygulama_guvenligi',\n    'Kimlik ve EriÅŸim YÃ¶netimi': 'kimlik_erisim_yonetimi',\n    'GÃ¼venlik YÃ¶netimi': 'guvenlik_yonetimi',\n    'Penetrasyon Test Talebi': 'penetrasyon_test_talebi',\n    'EÄŸitim Talepleri': 'egitim_talepleri',\n\n    // === LOJÄ°STÄ°K HÄ°ZMETLERÄ° ===\n    'YurtiÃ§i YÃ¼k Nakli': 'yurtici_yuk_nakli',\n    'YurtdÄ±ÅŸÄ± YÃ¼k Nakli': 'yurtdisi_yuk_nakli',\n    'Depo/Antrepo Hizmeti': 'depo_antrepo_hizmeti',\n\n    // === Ä°THALAT Ä°HRACAT ===\n    'YurtdÄ±ÅŸÄ± MÃ¼ÅŸteri AraÅŸtÄ±rma': 'yurtdisi_musteri_arastirma',\n    'YurtiÃ§i TedarikÃ§i AraÅŸtÄ±rma': 'yurtici_tedarikci_arastirma',\n    'GÃ¼mrÃ¼k Operasyon Hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'YurtiÃ§i ÃœrÃ¼n AraÅŸtÄ±rma': 'yurtici_urun_arastirma',\n    'YurtdÄ±ÅŸÄ± Pazar AraÅŸtÄ±rma': 'yurtdisi_pazar_arastirma',\n\n    // === PROFESYONEL DENETLEME ===\n    'Ä°Ã§ Denetim Hizmeti': 'ic_denetim_hizmeti',\n    'TedarikÃ§i MÃ¼ÅŸteri Mali Denetim': 'tedarikci_musteri_mali_denetim',\n    'TedarikÃ§i Kalite Denetim': 'tedarikci_kalite_denetim',\n    'TedarikÃ§i Ãœretim Denetleme': 'tedarikci_uretim_denetleme',\n    'Firma Temsil Hizmeti': 'firma_temsil_hizmeti',\n\n    // === Ä°NÅAAT EMLAK ===\n    'SatÄ±lÄ±k Gayrimenkul': 'satilik_gayrimenkul',\n    'KiralÄ±k Gayrimenkul': 'kiralik_gayrimenkul',\n    'YurtdÄ±ÅŸÄ± Gayrimenkul YatÄ±rÄ±m': 'yurtdisi_gayrimenkul_yatirim',\n    'Ä°nÅŸaat TaahhÃ¼t Hizmeti': 'insaat_taahhut_hizmeti',\n\n    // === CRM HÄ°ZMETLERÄ° ===\n    'MÃ¼ÅŸteri SeÃ§imi': 'musteri_secimi',\n    'MÃ¼ÅŸteri Edinme': 'musteri_edinme',\n    'MÃ¼ÅŸteri Koruma': 'musteri_koruma',\n    'MÃ¼ÅŸteri DerinleÅŸtirme': 'musteri_derinlestirme',\n\n    // === TEKSTÄ°L ÃœRÃœNLERÄ° ===\n    'Erkek Giyim': 'erkek_giyim',\n    'KadÄ±n Giyim': 'kadin_giyim',\n    'Ev Tekstil ÃœrÃ¼nleri': 'ev_tekstil_urunleri',\n\n    // === KOZMETÄ°K ÃœRÃœNLERÄ° ===\n    'ParfÃ¼m': 'parfum',\n    'Deodorant': 'deodorant',\n    'KiÅŸisel BakÄ±m': 'kisisel_bakim',\n    'Medikal Kozmetik': 'medikal_kozmetik',\n\n    // === TUR ORGANÄ°ZASYON ===\n    'YurtiÃ§i Ã–zel Gezi Talebi': 'yurtici_ozel_gezi_talebi',\n    'YurtdÄ±ÅŸÄ± Ã–zel Gezi Talebi': 'yurtdisi_ozel_gezi_talebi',\n    'Personel Servis Talebi': 'personel_servis_talebi',\n\n    // === GÃœNEÅ ENERJÄ°SÄ° SÄ°STEMLERÄ° ===\n    'GÃ¼neÅŸ Verimlilik HesabÄ±': 'gunes_verimlilik_hesabi',\n    'GES Ãœretim Hesaplama': 'ges_uretim_hesaplama',\n    'GES Kurulum Hesaplama': 'ges_kurulum_hesaplama',\n\n    // === KURUMSAL HÄ°ZMETLER ===\n    'Ä°nsan KaynaklarÄ± DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'insan_kaynaklari_danismanligi',\n    'Stratejik Planlama DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'stratejik_planlama_danismanligi',\n    'Finansal DanÄ±ÅŸmanlÄ±k': 'finansal_danismanlik',\n    'Operasyonel Ä°yileÅŸtirme': 'operasyonel_iyilestirme',\n    'Kurumsal Ä°letiÅŸim DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'kurumsal_iletisim_danismanligi',\n    'Yasal DanÄ±ÅŸmanlÄ±k': 'yasal_danismanlik',\n    'Teknoloji DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'teknoloji_danismanlik',\n    'Kurumsal EÄŸitim Hizmetleri': 'kurumsal_egitim_hizmetleri'\n  };\n\n  const serviceKey = conversions[categoryName];\n  \n  if (serviceKey) {\n    console.log(`ğŸ”„ Servis dÃ¶nÃ¼ÅŸÃ¼mÃ¼: \"${categoryName}\" -> \"${serviceKey}\"`);\n    return serviceKey;\n  } else {\n    // Fallback: otomatik dÃ¶nÃ¼ÅŸÃ¼m\n    const autoConverted = categoryName.toLowerCase()\n      .replace(/ /g, '_')\n      .replace(/[Ä±Ä°]/g, 'i')\n      .replace(/[ÅŸÅ]/g, 's')\n      .replace(/[ÄŸÄ]/g, 'g')\n      .replace(/[Ã¼Ãœ]/g, 'u')\n      .replace(/[Ã§Ã‡]/g, 'c')\n      .replace(/[Ã¶Ã–]/g, 'o');\n    \n    console.log(`âš ï¸  Servis bulunamadÄ±, otomatik dÃ¶nÃ¼ÅŸÃ¼m: \"${categoryName}\" -> \"${autoConverted}\"`);\n    return autoConverted;\n  }\n}\n\n// TÃ¼m mevcut servis anahtarlarÄ±nÄ± listele - DÃœZELTÄ°LDÄ°\nfunction getAllServiceKeys() {\n  return {\n    sigorta: [\n      'yesil_sigorta', // yesil_sigortasi â†’ yesil_sigorta\n      'trafik_sigortasi',\n      'kasko',\n      'koltuk_sigortasi',\n      'dask',\n      'konut_sigortasi',\n      'isyeri_sigortasi',\n      'seyahat_saglik_sigortasi',\n      'tamamlayici_saglik_sigortasi',\n      'ozel_saglik_sigortasi'\n    ],\n    // ... diÄŸer kategoriler aynÄ± kalacak\n    yazilim: [\n      'ozel_yazilim_gelistirme', 'mobil_uygulama_gelistirme'\n    ],\n    siber_guvenlik: [\n      'genel_ag_guvenligi',\n      'kullanici_guvenligi',\n      'veri_guvenligi',\n      'uygulama_guvenligi',\n      'kimlik_erisim_yonetimi',\n      'guvenlik_yonetimi',\n      'penetrasyon_test_talebi',\n      'egitim_talepleri'\n    ],\n    lojistik: [\n      'yurtici_yuk_nakli', 'yurtdisi_yuk_nakli', 'depo_antrepo_hizmeti'\n    ],\n    ithalat_ihracat: [\n      'yurtdisi_musteri_arastirma',\n      'yurtici_tedarikci_arastirma',\n      'gumruk_operasyon_hizmetleri',\n      'yurtici_urun_arastirma',\n      'yurtdisi_pazar_arastirma'\n    ],\n    profesyonel_denetleme: [\n      'ic_denetim_hizmeti',\n      'tedarikci_musteri_mali_denetim',\n      'tedarikci_kalite_denetim',\n      'tedarikci_uretim_denetleme',\n      'firma_temsil_hizmeti'\n    ],\n    insaat_emlak: [\n      'satilik_gayrimenkul',\n      'kiralik_gayrimenkul',\n      'yurtdisi_gayrimenkul_yatirim',\n      'insaat_taahhut_hizmeti'\n    ],\n    crm: [\n      'musteri_secimi',\n      'musteri_edinme',\n      'musteri_koruma',\n      'musteri_derinlestirme'\n    ],\n    tekstil: [ 'erkek_giyim', 'kadin_giyim', 'ev_tekstil_urunleri' ],\n    kozmetik: [ 'parfum', 'deodorant', 'kisisel_bakim', 'medikal_kozmetik' ],\n    tur: [\n      'yurtici_ozel_gezi_talebi',\n      'yurtdisi_ozel_gezi_talebi',\n      'personel_servis_talebi'\n    ],\n    gunes_enerjisi: [\n      'gunes_verimlilik_hesabi',\n      'ges_uretim_hesaplama',\n      'ges_kurulum_hesaplama'\n    ],\n    kurumsal: [\n      'insan_kaynaklari_danismanligi',\n      'stratejik_planlama_danismanligi',\n      'finansal_danismanlik',\n      'operasyonel_iyilestirme',\n      'kurumsal_iletisim_danismanligi',\n      'yasal_danismanlik',\n      'teknoloji_danismanlik',\n      'kurumsal_egitim_hizmetleri'\n    ]\n  };\n}\n\n// Servis anahtarÄ±nÄ± doÄŸrula\nfunction validateServiceKey(serviceKey, services) {\n  for (const [category, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n      return {\n        isValid: true,\n        category: category,\n        serviceData: categoryServices[serviceKey]\n      };\n    }\n  }\n  \n  return {\n    isValid: false,\n    error: `Servis bulunamadÄ±: ${serviceKey}`\n  };\n}\n\nmodule.exports = {\n  convertToServiceKey,\n  getAllServiceKeys,\n  validateServiceKey\n};\n\n\n============================================================\n// DOSYA: modules/menuHandler/categorymanager.js\n============================================================\n\n// modules/menuHandler/categoryManager.js\nconst logger = require('../logger');\n\n// Kategori verilerini yÃ¼kle\nfunction loadCategoryData(categoryName, services) {\n  console.log(`ğŸ“ Kategori yÃ¼kleniyor: ${categoryName}`);\n  \n  // Ã–nce ana kategorilerde ara\n  if (services[categoryName]) {\n    return services[categoryName];\n  }\n  \n  // Alternatif isimlerle dene\n  const alternativeNames = getAlternativeCategoryNames(categoryName);\n  for (const altName of alternativeNames) {\n    if (services[altName]) {\n      console.log(`ğŸ”„ Alternatif kategori bulundu: ${altName}`);\n      return services[altName];\n    }\n  }\n  \n  console.log(`âŒ Kategori bulunamadÄ±: ${categoryName}`);\n  return null;\n}\n\n// Alternatif kategori isimlerini getir\nfunction getAlternativeCategoryNames(categoryName) {\n  const alternatives = [];\n  \n  // \"_ana\" ekle/Ã§Ä±kar\n  if (categoryName.includes('_ana')) {\n    alternatives.push(categoryName.replace('_ana', ''));\n  } else {\n    alternatives.push(categoryName + '_ana');\n  }\n  \n  // \"_kategori\" ekle/Ã§Ä±kar\n  if (categoryName.includes('_kategori')) {\n    alternatives.push(categoryName.replace('_kategori', ''));\n  } else {\n    alternatives.push(categoryName + '_kategori');\n  }\n  \n  // \"_hizmetleri\" ekle/Ã§Ä±kar\n  if (categoryName.includes('_hizmetleri')) {\n    alternatives.push(categoryName.replace('_hizmetleri', ''));\n  } else {\n    alternatives.push(categoryName + '_hizmetleri');\n  }\n  \n  return alternatives.filter((value, index, self) => self.indexOf(value) === index);\n}\n\n// Kategori seÃ§eneklerini doÄŸrula\nfunction validateCategoryOptions(categoryData) {\n  if (!categoryData || !categoryData.category_options) {\n    return { isValid: false, error: 'Kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  const options = categoryData.category_options;\n  const validOptions = options.filter(opt => \n    opt.option_number && opt.category_name && opt.category_name.trim().length > 0\n  );\n  \n  if (validOptions.length === 0) {\n    return { isValid: false, error: 'GeÃ§erli kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  return { \n    isValid: true, \n    options: validOptions,\n    count: validOptions.length \n  };\n}\n\n// Kategori bilgilerini getir\nfunction getCategoryInfo(categoryName, services) {\n  const categoryData = loadCategoryData(categoryName, services);\n  if (!categoryData) {\n    return null;\n  }\n  \n  return {\n    name: categoryName,\n    displayName: categoryData.bot_greeting || categoryName.replace(/_/g, ' '),\n    options: categoryData.category_options || [],\n    completionMessage: categoryData.completion_message || 'LÃ¼tfen bir numara seÃ§in:'\n  };\n}\n\nmodule.exports = {\n  loadCategoryData,\n  getAlternativeCategoryNames,\n  validateCategoryOptions,\n  getCategoryInfo\n};\n\n\n============================================================\n// DOSYA: modules/menuHandler/submenu.js\n============================================================\n\n// modules/menuHandler/subMenu.js\nconst logger = require('../logger');\nconst serviceConverter = require('./serviceConverter');\n\n// Alt menÃ¼ seÃ§imini iÅŸleme\nasync function handleSubMenuSelection(message, number, categoryName, services) {\n  console.log(`ğŸ¯ Alt menÃ¼ seÃ§imi: Kategori: ${categoryName}, SayÄ±: ${number}`);\n  \n  const categoryData = services[categoryName];\n  \n  if (!categoryData || !categoryData.category_options) {\n    await message.reply('âŒ Alt menÃ¼ bulunamadÄ±. Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor.');\n    const sessionManager = require('../sessionManager');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    const mainMenu = require('./mainMenu');\n    await mainMenu.showMainMenu(message, services);\n    return;\n  }\n\n  const selectedOption = categoryData.category_options.find(opt => opt.option_number === number);\n  \n  if (selectedOption) {\n    console.log(`âœ… Alt menÃ¼ seÃ§ildi: ${selectedOption.category_name}`);\n    \n    const serviceKey = serviceConverter.convertToServiceKey(selectedOption.category_name);\n    \n    // Servis anahtarÄ±nÄ± doÄŸrula\n    const validation = serviceConverter.validateServiceKey(serviceKey, services);\n    \n    if (validation.isValid) {\n      const foundService = {\n        type: 'service',\n        data: validation.serviceData,\n        category: validation.category,\n        name: serviceKey\n      };\n      \n      console.log(`âœ… Servis bulundu: ${validation.category}/${serviceKey}`);\n      const serviceFlow = require('../serviceFlow');\n      await serviceFlow.startServiceFlow(message, foundService);\n    } else {\n      console.log(`âŒ Servis bulunamadÄ±: ${serviceKey}`);\n      \n      // Debug iÃ§in tÃ¼m servisleri listele\n      const allServices = serviceConverter.getAllServiceKeys();\n      console.log('ğŸ“‹ Mevcut servisler:', allServices);\n      \n      // Hangi kategoride aradÄ±ÄŸÄ±nÄ± gÃ¶ster\n      console.log(`ğŸ” Arama yapÄ±lan kategoriler:`, Object.keys(services).filter(key => \n        key.includes('sigorta') || key.includes('yazilim') || key.includes('lojistik')\n      ));\n      \n      await message.reply(`âœ… *${selectedOption.category_name}* seÃ§ildi!\\n\\n` +\n                         `Bu hizmetle ilgili detaylÄ± bilgi iÃ§in en kÄ±sa sÃ¼rede sizinle iletiÅŸime geÃ§eceÄŸiz.\\n\\n` +\n                         `_Servis dosyasÄ± henÃ¼z hazÄ±rlanÄ±yor, yakÄ±nda aktif olacaktÄ±r._`);\n      \n      const sessionManager = require('../sessionManager');\n      sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n      const mainMenu = require('./mainMenu');\n      await mainMenu.showMainMenu(message, services);\n    }\n  } else {\n    const validNumbers = categoryData.category_options.map(opt => opt.option_number);\n    await message.reply(`âŒ GeÃ§ersiz numara. LÃ¼tfen ${Math.min(...validNumbers)}-${Math.max(...validNumbers)} arasÄ± bir numara girin.`);\n  }\n}\n\n// Kategori seÃ§eneklerini gÃ¶ster\nasync function showCategoryOptions(message, category, services) {\n  const categoryData = category.data;\n  \n  if (!categoryData) {\n    await message.reply('âŒ Kategori verileri bulunamadÄ±. Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor.');\n    const sessionManager = require('../sessionManager');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    const mainMenu = require('./mainMenu');\n    await mainMenu.showMainMenu(message, services);\n    return;\n  }\n  \n  let optionsText = `ğŸ¯ *${categoryData.bot_greeting || category.name.replace(/_/g, ' ').toUpperCase()}*\\n\\n`;\n  \n  if (categoryData.category_options && categoryData.category_options.length > 0) {\n    categoryData.category_options.forEach(option => {\n      optionsText += `${option.option_number}. ${option.category_name}\\n`;\n    });\n    \n    optionsText += `\\n${categoryData.completion_message || 'LÃ¼tfen bir numara seÃ§in:'}`;\n    \n    await message.reply(optionsText);\n  } else {\n    await message.reply('âŒ Bu kategoride henÃ¼z hizmet bulunmuyor. Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor.');\n    const sessionManager = require('../sessionManager');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    const mainMenu = require('./mainMenu');\n    await mainMenu.showMainMenu(message, services);\n  }\n}\n\n// Kategori seÃ§eneklerini doÄŸrula\nfunction validateCategoryOptions(categoryData) {\n  if (!categoryData || !categoryData.category_options) {\n    return { isValid: false, error: 'Kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  const validOptions = categoryData.category_options.filter(opt => \n    opt.option_number && opt.category_name && opt.category_name.trim().length > 0\n  );\n  \n  if (validOptions.length === 0) {\n    return { isValid: false, error: 'GeÃ§erli kategori seÃ§enekleri bulunamadÄ±' };\n  }\n  \n  // SayÄ±larÄ±n sÄ±ralÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol et\n  const numbers = validOptions.map(opt => opt.option_number).sort((a, b) => a - b);\n  const isSequential = numbers.every((num, index) => num === index + 1);\n  \n  if (!isSequential) {\n    console.log('âš ï¸  Kategori numaralarÄ± sÄ±ralÄ± deÄŸil:', numbers);\n  }\n  \n  return { \n    isValid: true, \n    options: validOptions,\n    count: validOptions.length,\n    isSequential: isSequential\n  };\n}\n\n// Kategori bilgilerini getir\nfunction getCategoryInfo(categoryName, services) {\n  const categoryData = services[categoryName];\n  if (!categoryData) {\n    return null;\n  }\n  \n  const validation = validateCategoryOptions(categoryData);\n  \n  return {\n    name: categoryName,\n    displayName: categoryData.bot_greeting || categoryName.replace(/_/g, ' '),\n    options: validation.isValid ? validation.options : [],\n    optionCount: validation.isValid ? validation.count : 0,\n    isValid: validation.isValid,\n    error: validation.error,\n    completionMessage: categoryData.completion_message || 'LÃ¼tfen bir numara seÃ§in:'\n  };\n}\n\n// Servis arama (debug iÃ§in)\nfunction searchServiceInAllCategories(serviceKey, services) {\n  console.log(`ğŸ” Servis aranÄ±yor: ${serviceKey}`);\n  \n  const foundIn = [];\n  \n  for (const [categoryName, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n      foundIn.push({\n        category: categoryName,\n        service: categoryServices[serviceKey]\n      });\n    }\n  }\n  \n  if (foundIn.length > 0) {\n    console.log(`âœ… Servis bulundu:`, foundIn.map(f => f.category));\n    return foundIn;\n  } else {\n    console.log(`âŒ Servis hiÃ§bir kategoride bulunamadÄ±: ${serviceKey}`);\n    \n    // Benzer servisleri Ã¶ner\n    const similarServices = findSimilarServices(serviceKey, services);\n    if (similarServices.length > 0) {\n      console.log(`ğŸ’¡ Benzer servisler:`, similarServices);\n    }\n    \n    return [];\n  }\n}\n\n// Benzer servisleri bul\nfunction findSimilarServices(serviceKey, services) {\n  const similar = [];\n  const searchTerm = serviceKey.toLowerCase();\n  \n  for (const [categoryName, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object') {\n      for (const [key, serviceData] of Object.entries(categoryServices)) {\n        if (key.toLowerCase().includes(searchTerm) || \n            (serviceData.service_name && serviceData.service_name.toLowerCase().includes(searchTerm))) {\n          similar.push({\n            category: categoryName,\n            key: key,\n            name: serviceData.service_name || key\n          });\n        }\n      }\n    }\n  }\n  \n  return similar;\n}\n\nmodule.exports = {\n  handleSubMenuSelection,\n  showCategoryOptions,\n  validateCategoryOptions,\n  getCategoryInfo,\n  searchServiceInAllCategories,\n  findSimilarServices\n};\n\n\n============================================================\n// DOSYA: modules/menuHandler/navigation.js\n============================================================\n\n// modules/menuHandler/navigation.js\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\n\n// Ana menÃ¼ye dÃ¶n\nasync function returnToMainMenu(message, services, contactName = '') {\n  console.log(`ğŸ  Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor`);\n  \n  sessionManager.updateUserSession(message.from, { \n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  const mainMenu = require('./mainMenu');\n  \n  if (contactName) {\n    await message.reply(`ğŸ‘‹ ${contactName}, ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z!`);\n  }\n  \n  await mainMenu.showMainMenu(message, services);\n}\n\n// Ã–nceki menÃ¼ye dÃ¶n\nasync function goBackToPreviousMenu(message, services, currentState) {\n  console.log(`â†©ï¸ Ã–nceki menÃ¼ye dÃ¶nÃ¼lÃ¼yor: ${currentState}`);\n  \n  if (currentState.startsWith('submenu_')) {\n    const categoryName = currentState.replace('submenu_', '');\n    const categoryManager = require('./categoryManager');\n    const subMenu = require('./subMenu');\n    \n    const categoryData = categoryManager.loadCategoryData(categoryName, services);\n    if (categoryData) {\n      await subMenu.showCategoryOptions(message, { data: categoryData, name: categoryName }, services);\n      return;\n    }\n  }\n  \n  // Ã–nceki menÃ¼ bulunamazsa ana menÃ¼ye dÃ¶n\n  await returnToMainMenu(message, services);\n}\n\n// MenÃ¼ geÃ§miÅŸini yÃ¶net\nfunction updateMenuHistory(userId, newState) {\n  const session = sessionManager.getUserSession(userId);\n  const history = session.menuHistory || [];\n  \n  // Son state'i history'e ekle (tekrarlarÄ± Ã¶nle)\n  if (history.length === 0 || history[history.length - 1] !== session.currentState) {\n    history.push(session.currentState);\n  }\n  \n  // History'yi sÄ±nÄ±rla (max 10)\n  if (history.length > 10) {\n    history.shift();\n  }\n  \n  sessionManager.updateUserSession(userId, { \n    menuHistory: history,\n    currentState: newState\n  });\n  \n  return history;\n}\n\n// MenÃ¼ durumunu kontrol et\nfunction getMenuStateInfo(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (!session) return null;\n  \n  return {\n    currentState: session.currentState,\n    menuHistory: session.menuHistory || [],\n    inService: session.currentService !== null,\n    waitingForResponse: session.waitingForResponse || false\n  };\n}\n\n// MenÃ¼ zaman aÅŸÄ±mÄ±nÄ± kontrol et\nfunction checkMenuTimeout(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (!session || !session.lastActivity) return false;\n  \n  const timeoutDuration = 10 * 60 * 1000; // 10 dakika\n  const timeSinceLastActivity = Date.now() - session.lastActivity;\n  \n  return timeSinceLastActivity > timeoutDuration;\n}\n\nmodule.exports = {\n  returnToMainMenu,\n  goBackToPreviousMenu,\n  updateMenuHistory,\n  getMenuStateInfo,\n  checkMenuTimeout\n};\n\n\n============================================================\n// DOSYA: modules/menuHandler/mainmenu.js\n============================================================\n\n// modules/menuHandler/mainMenu.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// Ana menÃ¼ gÃ¶ster - GÃœNCELLENDÄ°\nasync function showMainMenu(message, services) {\n  let menuText = `ğŸ“‹ *ANA HÄ°ZMET KATEGORÄ°LERÄ°*\\n\\n`;\n  \n  const mainCategories = [\n    'ğŸ›¡ï¸  Sigorta Hizmetleri',\n    'ğŸ’» YazÄ±lÄ±m Talepleri', \n    'ğŸ”’ Siber GÃ¼venlik',\n    'ğŸšš Lojistik Hizmetleri',\n    'ğŸŒ Ä°thalat Ä°hracat',\n    'ğŸ“Š Profesyonel Denetleme',\n    'ğŸ  Ä°nÅŸaat Emlak',\n    'ğŸ¤ CRM Hizmetleri',\n    'ğŸ‘• Tekstil ÃœrÃ¼nleri',\n    'ğŸ’„ Kozmetik ÃœrÃ¼nleri',\n    'âœˆï¸  Tur Organizasyon',\n    'â˜€ï¸  GÃ¼neÅŸ Enerjisi',\n    'ğŸ¢ Kurumsal Hizmetler'\n  ];\n  \n  mainCategories.forEach((category, index) => {\n    menuText += `${index + 1}. ${category}\\n`;\n  });\n  \n  menuText += `\\nÄ°lgilendiÄŸiniz hizmetin *numarasÄ±nÄ±* yazÄ±n veya *doÄŸrudan hizmet adÄ±nÄ±* belirtin.`;\n  \n  try {\n    await sendMessageWithoutQuote(message.from, menuText);\n  } catch (error) {\n    console.error('MenÃ¼ gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(menuText);\n  }\n  \n  // MenÃ¼ gÃ¶sterildikten sonra timer baÅŸlat\n  const sessionManager = require('../sessionManager');\n  sessionManager.startMenuTimer(message.from, message, services);\n}\n\n// Ana menÃ¼ kategorilerini getir\nfunction getMainCategories() {\n  return [\n    'sigorta_ana_kategori',\n    'yazilim_talepleri_ana_kategori', \n    'siber_guvenlik_ana',\n    'lojistik_hizmetleri_ana',\n    'ithalat_ihracat_ana',\n    'profesyonel_denetleme_ana',\n    'insaat_emlak_ana',\n    'crm_hizmetleri_ana',\n    'tekstil_urunleri_ana',\n    'kozmetik_urunleri_ana',\n    'tur_organizasyon_ana',\n    'gunes_enerjisi_sistemleri_ana',\n    'kurumsal_hizmetler_ana'\n  ];\n}\n\nmodule.exports = {\n  showMainMenu,\n  getMainCategories\n};\n\n\n============================================================\n// DOSYA: modules/menuhandler.js\n============================================================\n\n// modules/menuHandler.js - ANA YÃ–NLENDÄ°RÄ°CÄ° DOSYA\nconst mainMenu = require('./menuHandler/mainMenu');\nconst subMenu = require('./menuHandler/subMenu');\nconst numberHandler = require('./menuHandler/numberHandler');\nconst serviceConverter = require('./menuHandler/serviceConverter');\nconst categoryManager = require('./menuHandler/categoryManager');\nconst navigation = require('./menuHandler/navigation');\n\n// Ana menÃ¼ gÃ¶ster\nasync function showMainMenu(message, services) {\n  await mainMenu.showMainMenu(message, services);\n}\n\n// SayÄ± seÃ§imini iÅŸle\nasync function handleNumberSelection(message, number, services) {\n  await numberHandler.handleNumberSelection(message, number, services);\n}\n\n// Alt menÃ¼ seÃ§imini iÅŸle\nasync function handleSubMenuSelection(message, number, categoryName, services) {\n  await subMenu.handleSubMenuSelection(message, number, categoryName, services);\n}\n\n// Kategori seÃ§eneklerini gÃ¶ster\nasync function showCategoryOptions(message, category, services) {\n  await subMenu.showCategoryOptions(message, category, services);\n}\n\n// Servis anahtarÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r\nfunction convertToServiceKey(categoryName) {\n  return serviceConverter.convertToServiceKey(categoryName);\n}\n\n// Ana menÃ¼ye dÃ¶n\nasync function returnToMainMenu(message, services, contactName = '') {\n  await navigation.returnToMainMenu(message, services, contactName);\n}\n\nmodule.exports = {\n  showMainMenu,\n  handleNumberSelection,\n  handleSubMenuSelection,\n  showCategoryOptions,\n  convertToServiceKey,\n  returnToMainMenu,\n  \n  // Alt modÃ¼llere eriÅŸim iÃ§in\n  mainMenu,\n  subMenu,\n  numberHandler,\n  serviceConverter,\n  categoryManager,\n  navigation\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler/validation.js\n============================================================\n\nconst logger = require('../logger');\n\nfunction validateMessage(message) {\n  // Temel validasyonlar\n  if (message.fromMe) {\n    return { isValid: false, reason: 'fromMe' };\n  }\n  \n  if (message.from === 'status@broadcast') {\n    return { isValid: false, reason: 'status_broadcast' };\n  }\n  \n  if (message.isGroupMsg) {\n    return { isValid: false, reason: 'group_message' };\n  }\n  \n  const messageBody = message.body?.toLowerCase().trim();\n  if (!messageBody || messageBody.length === 0) {\n    return { isValid: false, reason: 'empty_message' };\n  }\n  \n  if (message.hasMedia) {\n    return { isValid: false, reason: 'has_media' };\n  }\n  \n  return { isValid: true, messageBody };\n}\n\nfunction validateInput(message, expectedType) {\n  const cleanMessage = message.trim();\n  \n  switch (expectedType) {\n    case 'number':\n      const number = parseInt(cleanMessage);\n      if (isNaN(number)) {\n        return {\n          isValid: false,\n          errorMessage: 'GeÃ§ersiz sayÄ± formatÄ±. LÃ¼tfen sadece rakam girin.'\n        };\n      }\n      return { isValid: true, value: number };\n      \n    case 'text':\n      if (cleanMessage.length < 2) {\n        return {\n          isValid: false,\n          errorMessage: 'Cevap Ã§ok kÄ±sa. LÃ¼tfen daha detaylÄ± bilgi verin.'\n        };\n      }\n      return { isValid: true, value: cleanMessage };\n      \n    default:\n      return { isValid: true, value: cleanMessage };\n  }\n}\n\nmodule.exports = {\n  validateMessage,\n  validateInput\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler/personalization.js\n============================================================\n\nconst serviceLoader = require('../serviceLoader');\n\nfunction createPersonalizedGreeting(contactName, greetingType) {\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const baseGreeting = greetings?.selamlama?.[greetingType] || \n                      'Merhaba! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?';\n  \n  if (contactName && contactName.trim().length > 0) {\n    const personalizedGreetings = {\n      gunaydin: `ğŸŒ GÃ¼naydÄ±n ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`,\n      merhaba: `ğŸ‘‹ Merhaba ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`,\n      iyi_aksamlar: `ğŸŒ™ Ä°yi akÅŸamlar ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`\n    };\n    \n    return personalizedGreetings[greetingType] || \n           `ğŸ‘‹ Merhaba ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`;\n  }\n  \n  return baseGreeting;\n}\n\nfunction createPersonalizedUnknownMessage(contactName) {\n  const baseText = `ğŸ¤” AnlayamadÄ±m. LÃ¼tfen aÅŸaÄŸÄ±daki seÃ§eneklerden birini belirtin:`;\n  \n  if (contactName) {\n    return `ğŸ¤” ${contactName}, anlayamadÄ±m. LÃ¼tfen aÅŸaÄŸÄ±daki seÃ§eneklerden birini belirtin:`;\n  }\n  \n  return baseText;\n}\n\nmodule.exports = {\n  createPersonalizedGreeting,\n  createPersonalizedUnknownMessage\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler/servicematcher.js\n============================================================\n\n// modules/messageHandler/serviceMatcher.js\nconst logger = require('../logger');\n\nfunction findMatchingService(message, services) {\n  const cleanMessage = message.toLowerCase().replace(/[.,!?]/g, '').trim();\n  \n  console.log(`ğŸ” Servis aranÄ±yor: \"${cleanMessage}\"`);\n\n  // Ã–NCE: FÄ°YAT SORGULARI\n  const priceQueries = {\n    'yeÅŸil sigorta fiyat': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta fiyat': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatÄ±': 'yesil_sigorta_fiyatlari', \n    'yesil sigorta fiyati': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta ne kadar': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta ne kadar': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta Ã¼creti': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta ucreti': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatlarÄ±': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatlari': 'yesil_sigorta_fiyatlari',\n    'trafik sigortasÄ± fiyat': 'trafik_sigortasi_fiyat_akisi',\n    'trafik sigortasi fiyat': 'trafik_sigortasi_fiyat_akisi'\n  };\n\n  for (const [priceQuery, serviceKey] of Object.entries(priceQueries)) {\n    if (cleanMessage.includes(priceQuery)) {\n      console.log(`ğŸ’° Fiyat sorgusu eÅŸleÅŸti: \"${priceQuery}\" -> ${serviceKey}`);\n      \n      if (services['fiyat_listeleri'] && services['fiyat_listeleri'][serviceKey]) {\n        return { \n          type: 'service', \n          data: services['fiyat_listeleri'][serviceKey], \n          category: 'fiyat_listeleri', \n          name: serviceKey \n        };\n      }\n    }\n  }\n\n  // TAM EÅLEÅMELER - TÃœM SERVÄ°SLER\n  const exactMatches = {\n    // === SÄ°GORTA HÄ°ZMETLERÄ° ===\n    'yeÅŸil sigorta': 'yesil_sigorta',\n    'yesil sigorta': 'yesil_sigorta',\n    'trafik sigortasÄ±': 'trafik_sigortasi',\n    'trafik sigortasi': 'trafik_sigortasi',\n    'kasko sigortasÄ±': 'kasko',\n    'kasko sigortasi': 'kasko',\n    'koltuk sigortasÄ±': 'koltuk_sigortasi',\n    'koltuk sigortasi': 'koltuk_sigortasi',\n    'dask sigortasÄ±': 'dask',\n    'dask sigortasi': 'dask',\n    'konut sigortasÄ±': 'konut_sigortasi',\n    'konut sigortasi': 'konut_sigortasi',\n    'iÅŸyeri sigortasÄ±': 'isyeri_sigortasi',\n    'isyeri sigortasi': 'isyeri_sigortasi',\n    'seyahat saÄŸlÄ±k sigortasÄ±': 'seyahat_saglik_sigortasi',\n    'seyahat saglik sigortasi': 'seyahat_saglik_sigortasi',\n    'tamamlayÄ±cÄ± saÄŸlÄ±k sigortasÄ±': 'tamamlayici_saglik_sigortasi',\n    'tamamlayici saglik sigortasi': 'tamamlayici_saglik_sigortasi',\n    'Ã¶zel saÄŸlÄ±k sigortasÄ±': 'ozel_saglik_sigortasi',\n    'ozel saglik sigortasi': 'ozel_saglik_sigortasi',\n\n    // === YAZILIM TALEPLERÄ° ===\n    'Ã¶zel yazÄ±lÄ±m geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'ozel yazilim geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'yazÄ±lÄ±m geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'yazilim geliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'mobil uygulama geliÅŸtirme': 'mobil_uygulama_gelistirme',\n    'mobil uygulama': 'mobil_uygulama_gelistirme',\n    'uygulama geliÅŸtirme': 'mobil_uygulama_gelistirme',\n\n    // === SÄ°BER GÃœVENLÄ°K ===\n    'genel aÄŸ gÃ¼venliÄŸi': 'genel_ag_guvenligi',\n    'genel ag guvenligi': 'genel_ag_guvenligi',\n    'kullanÄ±cÄ± gÃ¼venliÄŸi': 'kullanici_guvenligi',\n    'kullanici guvenligi': 'kullanici_guvenligi',\n    'veri gÃ¼venliÄŸi': 'veri_guvenligi',\n    'veri guvenligi': 'veri_guvenligi',\n    'uygulama gÃ¼venliÄŸi': 'uygulama_guvenligi',\n    'uygulama guvenligi': 'uygulama_guvenligi',\n    'kimlik ve eriÅŸim yÃ¶netimi': 'kimlik_erisim_yonetimi',\n    'kimlik erisim yonetimi': 'kimlik_erisim_yonetimi',\n    'gÃ¼venlik yÃ¶netimi': 'guvenlik_yonetimi',\n    'guvenlik yonetimi': 'guvenlik_yonetimi',\n    'penetrasyon test talebi': 'penetrasyon_test_talebi',\n    'penetrasyon test': 'penetrasyon_test_talebi',\n    'siber gÃ¼venlik eÄŸitimi': 'egitim_talepleri',\n    'siber guvenlik egitimi': 'egitim_talepleri',\n\n    // === LOJÄ°STÄ°K HÄ°ZMETLERÄ° ===\n    'yurtiÃ§i yÃ¼k nakli': 'yurtici_yuk_nakli',\n    'yurtici yuk nakli': 'yurtici_yuk_nakli',\n    'yurtiÃ§i nakliye': 'yurtici_yuk_nakli',\n    'yurtdÄ±ÅŸÄ± yÃ¼k nakli': 'yurtdisi_yuk_nakli',\n    'yurtdisi yuk nakli': 'yurtdisi_yuk_nakli',\n    'yurtdÄ±ÅŸÄ± nakliye': 'yurtdisi_yuk_nakli',\n    'depo antrepo hizmeti': 'depo_antrepo_hizmeti',\n    'depo hizmeti': 'depo_antrepo_hizmeti',\n    'antrepo hizmeti': 'depo_antrepo_hizmeti',\n\n    // === Ä°THALAT Ä°HRACAT ===\n    'yurtdÄ±ÅŸÄ± mÃ¼ÅŸteri araÅŸtÄ±rma': 'yurtdisi_musteri_arastirma',\n    'yurtdisi musteri arastirma': 'yurtdisi_musteri_arastirma',\n    'yurtiÃ§i tedarikÃ§i araÅŸtÄ±rma': 'yurtici_tedarikci_arastirma',\n    'yurtici tedarikci arastirma': 'yurtici_tedarikci_arastirma',\n    'gÃ¼mrÃ¼k operasyon hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'gumruk operasyon hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'gÃ¼mrÃ¼k hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'yurtiÃ§i Ã¼rÃ¼n araÅŸtÄ±rma': 'yurtici_urun_arastirma',\n    'yurtici urun arastirma': 'yurtici_urun_arastirma',\n    'yurtdÄ±ÅŸÄ± pazar araÅŸtÄ±rma': 'yurtdisi_pazar_arastirma',\n    'yurtdisi pazar arastirma': 'yurtdisi_pazar_arastirma',\n\n    // === PROFESYONEL DENETLEME ===\n    'iÃ§ denetim hizmeti': 'ic_denetim_hizmeti',\n    'ic denetim hizmeti': 'ic_denetim_hizmeti',\n    'tedarikÃ§i mÃ¼ÅŸteri mali denetim': 'tedarikci_musteri_mali_denetim',\n    'tedarikci musteri mali denetim': 'tedarikci_musteri_mali_denetim',\n    'tedarikÃ§i kalite denetim': 'tedarikci_kalite_denetim',\n    'tedarikci kalite denetim': 'tedarikci_kalite_denetim',\n    'tedarikÃ§i Ã¼retim denetleme': 'tedarikci_uretim_denetleme',\n    'tedarikci uretim denetleme': 'tedarikci_uretim_denetleme',\n    'firma temsil hizmeti': 'firma_temsil_hizmeti',\n\n    // === Ä°NÅAAT EMLAK ===\n    'satÄ±lÄ±k gayrimenkul': 'satilik_gayrimenkul',\n    'satilik gayrimenkul': 'satilik_gayrimenkul',\n    'kiralÄ±k gayrimenkul': 'kiralik_gayrimenkul',\n    'kiralik gayrimenkul': 'kiralik_gayrimenkul',\n    'yurtdÄ±ÅŸÄ± gayrimenkul yatÄ±rÄ±m': 'yurtdisi_gayrimenkul_yatirim',\n    'yurtdisi gayrimenkul yatirim': 'yurtdisi_gayrimenkul_yatirim',\n    'inÅŸaat taahhÃ¼t hizmeti': 'insaat_taahhut_hizmeti',\n    'insaat taahhut hizmeti': 'insaat_taahhut_hizmeti',\n\n    // === CRM HÄ°ZMETLERÄ° ===\n    'mÃ¼ÅŸteri seÃ§imi': 'musteri_secimi',\n    'musteri secimi': 'musteri_secimi',\n    'mÃ¼ÅŸteri edinme': 'musteri_edinme',\n    'musteri edinme': 'musteri_edinme',\n    'mÃ¼ÅŸteri koruma': 'musteri_koruma',\n    'musteri koruma': 'musteri_koruma',\n    'mÃ¼ÅŸteri derinleÅŸtirme': 'musteri_derinlestirme',\n    'musteri derinlestirme': 'musteri_derinlestirme',\n\n    // === TEKSTÄ°L ÃœRÃœNLERÄ° ===\n    'erkek giyim': 'erkek_giyim',\n    'kadÄ±n giyim': 'kadin_giyim',\n    'kadin giyim': 'kadin_giyim',\n    'ev tekstil Ã¼rÃ¼nleri': 'ev_tekstil_urunleri',\n    'ev tekstil urunleri': 'ev_tekstil_urunleri',\n\n    // === KOZMETÄ°K ÃœRÃœNLERÄ° ===\n    'parfÃ¼m': 'parfum',\n    'parfum': 'parfum',\n    'deodorant': 'deodorant',\n    'kiÅŸisel bakÄ±m': 'kisisel_bakim',\n    'kisisel bakim': 'kisisel_bakim',\n    'medikal kozmetik': 'medikal_kozmetik',\n\n    // === TUR ORGANÄ°ZASYON ===\n    'yurtiÃ§i Ã¶zel gezi talebi': 'yurtici_ozel_gezi_talebi',\n    'yurtici ozel gezi talebi': 'yurtici_ozel_gezi_talebi',\n    'yurtdÄ±ÅŸÄ± Ã¶zel gezi talebi': 'yurtdisi_ozel_gezi_talebi',\n    'yurtdisi ozel gezi talebi': 'yurtdisi_ozel_gezi_talebi',\n    'personel servis talebi': 'personel_servis_talebi',\n\n    // === GÃœNEÅ ENERJÄ°SÄ° SÄ°STEMLERÄ° ===\n    'gÃ¼neÅŸ verimlilik hesabÄ±': 'gunes_verimlilik_hesabi',\n    'gunes verimlilik hesabi': 'gunes_verimlilik_hesabi',\n    'ges Ã¼retim hesaplama': 'ges_uretim_hesaplama',\n    'ges uretim hesaplama': 'ges_uretim_hesaplama',\n    'ges kurulum hesaplama': 'ges_kurulum_hesaplama',\n\n    // === KURUMSAL HÄ°ZMETLER ===\n    'insan kaynaklarÄ± danÄ±ÅŸmanlÄ±ÄŸÄ±': 'insan_kaynaklari_danismanligi',\n    'stratejik planlama danÄ±ÅŸmanlÄ±ÄŸÄ±': 'stratejik_planlama_danismanligi',\n    'finansal danÄ±ÅŸmanlÄ±k': 'finansal_danismanlik',\n    'operasyonel iyileÅŸtirme': 'operasyonel_iyilestirme',\n    'kurumsal iletiÅŸim danÄ±ÅŸmanlÄ±ÄŸÄ±': 'kurumsal_iletisim_danismanligi',\n    'yasal danÄ±ÅŸmanlÄ±k': 'yasal_danismanlik',\n    'teknoloji danÄ±ÅŸmanlÄ±ÄŸÄ±': 'teknoloji_danismanligi',\n    'kurumsal eÄŸitim hizmetleri': 'kurumsal_egitim_hizmetleri'\n  };\n\n  for (const [exactPhrase, serviceKey] of Object.entries(exactMatches)) {\n    if (cleanMessage.includes(exactPhrase.toLowerCase())) {\n      console.log(`âœ… Tam ifade eÅŸleÅŸti: \"${exactPhrase}\" -> ${serviceKey}`);\n      \n      // Ã–nce servis olarak ara\n      for (const [categoryName, categoryServices] of Object.entries(services)) {\n        if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n          return { \n            type: 'service', \n            data: categoryServices[serviceKey], \n            category: categoryName, \n            name: serviceKey \n          };\n        }\n      }\n      \n      // Servis bulunamazsa kategori olarak ara\n      if (services[serviceKey]) {\n        return { type: 'category', data: services[serviceKey], name: serviceKey };\n      }\n    }\n  }\n\n  // ANAHTAR KELÄ°MELER (kategori eÅŸleÅŸtirme) - DÃœZELTÄ°LDÄ°\n  const keywordMatches = {\n    'sigorta': 'sigorta_ana_kategori',\n    'yazÄ±lÄ±m': 'yazilim_talepleri_ana_kategori',\n    'yazilim': 'yazilim_talepleri_ana_kategori',\n    'siber': 'siber_guvenlik_ana',\n    'gÃ¼venlik': 'siber_guvenlik_ana',\n    'lojistik': 'lojistik_hizmetleri_ana',\n    'nakliye': 'lojistik_hizmetleri_ana',\n    'ithalat': 'ithalat_ihracat_ana',\n    'ihracat': 'ithalat_ihracat_ana',\n    'denetim': 'profesyonel_denetleme_ana',\n    'denetleme': 'profesyonel_denetleme_ana',\n    'emlak': 'insaat_emlak_ana',\n    'inÅŸaat': 'insaat_emlak_ana',\n    'crm': 'crm_hizmetleri_ana',\n    'tekstil': 'tekstil_urunleri_ana',\n    'kozmetik': 'kozmetik_urunleri_ana',\n    'tur': 'tur_organizasyon_ana',\n    'turizm': 'tur_organizasyon_ana',\n    'gÃ¼neÅŸ': 'gunes_enerjisi_sistemleri_ana',\n    'enerji': 'gunes_enerjisi_sistemleri_ana',\n    'kurumsal': 'kurumsal_hizmetler_ana',\n    'danÄ±ÅŸmanlÄ±k': 'kurumsal_hizmetler_ana'\n  };\n\n  for (const [keyword, serviceKey] of Object.entries(keywordMatches)) {\n    if (cleanMessage.includes(keyword)) {\n      console.log(`âœ… Anahtar kelime eÅŸleÅŸti: \"${keyword}\" -> ${serviceKey}`);\n      \n      const categoryData = services[serviceKey];\n      if (categoryData) {\n        console.log(`âœ… Kategori bulundu: ${serviceKey}`);\n        return { type: 'category', data: categoryData, name: serviceKey };\n      } else {\n        console.log(`âŒ Kategori bulunamadÄ±: ${serviceKey}`);\n        // Alternatif kategori isimlerini dene\n        const alternativeKeys = Object.keys(services).filter(key => \n          key.includes(keyword.replace(/[^a-z0-9]/gi, ''))\n        );\n        if (alternativeKeys.length > 0) {\n          console.log(`ğŸ”„ Alternatif kategoriler:`, alternativeKeys);\n          const alternativeKey = alternativeKeys[0];\n          return { type: 'category', data: services[alternativeKey], name: alternativeKey };\n        }\n      }\n    }\n  }\n\n  console.log('âŒ EÅŸleÅŸme bulunamadÄ±');\n  return null;\n}\n\nmodule.exports = {\n  findMatchingService\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler/errorhandler.js\n============================================================\n\n// modules/messageHandler/errorHandler.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendErrorMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('Hata mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\nasync function handleError(message, error) {\n  logger.error(`Mesaj iÅŸleme hatasÄ±: ${error.message}`);\n  console.error('âŒ Mesaj iÅŸlenirken hata:', error);\n  \n  try {\n    await sendErrorMessage(message, 'âŒ ÃœzgÃ¼nÃ¼m, bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');\n    \n    // Hata detayÄ±nÄ± logla\n    const errorDetails = {\n      userId: message.from,\n      message: message.body,\n      error: error.message,\n      stack: error.stack,\n      timestamp: new Date().toISOString()\n    };\n    \n    logger.error(`Hata detaylarÄ±: ${JSON.stringify(errorDetails)}`);\n    \n  } catch (replyError) {\n    logger.error(`Hata mesajÄ± gÃ¶nderilemedi: ${replyError.message}`);\n  }\n}\n\nasync function handleMediaError(message) {\n  try {\n    await sendErrorMessage(message, 'ğŸ“ Åu anda sadece metin mesajlarÄ±nÄ± iÅŸleyebiliyorum. LÃ¼tfen metin olarak yazÄ±n.');\n  } catch (error) {\n    logger.error(`Medya hatasÄ± mesajÄ± gÃ¶nderilemedi: ${error.message}`);\n  }\n}\n\nasync function handleUnknownCommand(message, contactName = '') {\n  const personalization = require('./personalization');\n  const unknownText = personalization.createPersonalizedUnknownMessage(contactName);\n  \n  try {\n    await sendErrorMessage(message, `${unknownText}\\n\\n` +\n                       `â€¢ \"sigorta\" - Sigorta hizmetleri\\n` +\n                       `â€¢ \"yazÄ±lÄ±m\" - YazÄ±lÄ±m geliÅŸtirme\\n` +\n                       `â€¢ \"lojistik\" - Nakliye hizmetleri\\n` +\n                       `â€¢ Veya diÄŸer hizmetlerimiz...\\n\\n` +\n                       `YardÄ±m iÃ§in \"menÃ¼\" yazabilirsiniz.`);\n  } catch (error) {\n    logger.error(`Bilinmeyen komut mesajÄ± gÃ¶nderilemedi: ${error.message}`);\n  }\n}\n\nmodule.exports = {\n  handleError,\n  handleMediaError,\n  handleUnknownCommand\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler/greetingmanager.js\n============================================================\n\n// modules/messageHandler/greetingManager.js - GÃœNCELLENDÄ°\nconst serviceLoader = require('../serviceLoader');\nconst personalization = require('./personalization');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendGreetingMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('Selamlama mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\nfunction getTimeBasedGreeting() {\n  const hour = new Date().getHours();\n  \n  if (hour >= 5 && hour < 11) return 'gunaydin';\n  if (hour >= 11 && hour < 17) return 'merhaba';\n  return 'iyi_aksamlar';\n}\n\nasync function handleGreeting(message, services, contactName = '') {\n  const greetingType = getTimeBasedGreeting();\n  const greetingMsg = personalization.createPersonalizedGreeting(contactName, greetingType);\n  \n  await sendGreetingMessage(message, greetingMsg);\n  \n  // Hemen ardÄ±ndan yardÄ±m sorusunu sor\n  setTimeout(async () => {\n    const helpQuestion = contactName ? \n      `ğŸ¤” ${contactName}, size yardÄ±mcÄ± olabilmem iÃ§in lÃ¼tfen bana hangi konuda yardÄ±m istediÄŸinizi yazarmÄ±sÄ±nÄ±z?` :\n      `ğŸ¤” Size yardÄ±mcÄ± olabilmem iÃ§in lÃ¼tfen bana hangi konuda yardÄ±m istediÄŸinizi yazarmÄ±sÄ±nÄ±z?`;\n    \n    await sendGreetingMessage(message, helpQuestion);\n    \n    const sessionManager = require('../sessionManager');\n    sessionManager.startHelpTimer(message.from, message, services);\n  }, 1000);\n  \n  return true;\n}\n\n// TeÅŸekkÃ¼r mesajÄ±nÄ± iÅŸle - GÃœNCELLENDÄ°\nasync function handleThanks(message, contactName = '') {\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const thanksResponses = greetings?.tesekkur?.tesekkur_cevaplari || [\n    'ğŸ™ Rica ederim! Size yardÄ±mcÄ± olabildiÄŸim iÃ§in ben teÅŸekkÃ¼r ederim. ğŸ¯'\n  ];\n  \n  // Rastgele bir teÅŸekkÃ¼r cevabÄ± seÃ§\n  const randomThanks = thanksResponses[Math.floor(Math.random() * thanksResponses.length)];\n  \n  let thanksMsg = randomThanks;\n  if (contactName) {\n    thanksMsg = `${contactName}, ${randomThanks.toLowerCase()}`;\n  }\n  \n  thanksMsg += `\\n\\nBaÅŸka bir konuda yardÄ±ma ihtiyacÄ±nÄ±z varsa \"menÃ¼\" yazabilirsiniz.`;\n  \n  await sendGreetingMessage(message, thanksMsg);\n  return true;\n}\n\n// VedalaÅŸma mesajÄ±nÄ± iÅŸle - GÃœNCELLENDÄ°\nasync function handleGoodbye(message, contactName = '') {\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const goodbyeResponses = greetings?.vedalasma?.hoscakal || [\n    'ğŸ‘‹ HoÅŸÃ§a kalÄ±n! PlanB Global Network Ltd Åti adÄ±na iyi gÃ¼nler dilerim.'\n  ];\n  \n  // Rastgele bir vedalaÅŸma mesajÄ± seÃ§\n  const randomGoodbye = goodbyeResponses[Math.floor(Math.random() * goodbyeResponses.length)];\n  \n  let goodbyeMsg = randomGoodbye;\n  if (contactName) {\n    goodbyeMsg = `${contactName}, ${randomGoodbye}`;\n  }\n  \n  await sendGreetingMessage(message, goodbyeMsg);\n  \n  // Oturumu temizle\n  const sessionManager = require('../sessionManager');\n  sessionManager.updateUserSession(message.from, {\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  return true;\n}\n\nmodule.exports = {\n  getTimeBasedGreeting,\n  handleGreeting,\n  handleThanks,\n  handleGoodbye\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler/contactmanager.js\n============================================================\n\n// modules/messageHandler/contactManager.js\nconst logger = require('../logger');\n\nasync function getContactInfo(message) {\n  try {\n    const contact = await message.getContact();\n    const contactName = contact.name || contact.pushname || '';\n    const phoneNumber = contact.id.user || '';\n    \n    console.log(`ğŸ‘¤ MÃ¼ÅŸteri bilgisi: ${contactName} (${phoneNumber})`);\n    \n    return {\n      name: contactName,\n      phone: phoneNumber,\n      isBusiness: contact.isBusiness || false,\n      isEnterprise: contact.isEnterprise || false\n    };\n  } catch (contactError) {\n    logger.error(`MÃ¼ÅŸteri bilgisi alÄ±namadÄ±: ${contactError.message}`);\n    console.log('âš ï¸  MÃ¼ÅŸteri bilgisi alÄ±namadÄ±:', contactError.message);\n    \n    return {\n      name: '',\n      phone: '',\n      isBusiness: false,\n      isEnterprise: false\n    };\n  }\n}\n\n// logContactInteraction fonksiyonunu ekliyoruz\nasync function logContactInteraction(message, action) {\n  const contactInfo = await getContactInfo(message);\n  \n  logger.info(`ğŸ“ ${action} - MÃ¼ÅŸteri: ${contactInfo.name} (${contactInfo.phone}) - Mesaj: \"${message.body}\"`);\n  \n  return contactInfo;\n}\n\nmodule.exports = {\n  getContactInfo,\n  logContactInteraction  // Bu fonksiyonu ekledik\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler/sessionrouter.js\n============================================================\n\n// modules/messageHandler/sessionRouter.js - GÃœNCELLENDÄ°\nconst sessionManager = require('../sessionManager');\nconst serviceLoader = require('../serviceLoader');\nconst menuHandler = require('../menuHandler');\nconst serviceFlow = require('../serviceFlow');\nconst greetingManager = require('./greetingManager');\nconst serviceMatcher = require('./serviceMatcher');\nconst messageParser = require('./messageParser');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendResponse(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    // Fallback: normal reply\n    await message.reply(text);\n  }\n}\n\nasync function route(message, parsedMessage, contactName = '') {\n  const { greetingPart, servicePart, cleanMessage, originalMessage } = parsedMessage;\n  const services = serviceLoader.loadAllServices();\n  const session = sessionManager.getUserSession(message.from);\n  \n  console.log(`ğŸ” Route: Durum=${session?.currentState}, Mesaj=${cleanMessage}`);\n  \n  // TEÅEKKÃœR MESAJLARI - EN Ã–NCELÄ°KLÄ°\n  if (messageParser.isThanksMessage(cleanMessage)) {\n    console.log(`ğŸ™ TeÅŸekkÃ¼r mesajÄ± algÄ±landÄ±`);\n    await greetingManager.handleThanks(message, contactName);\n    return;\n  }\n  \n  // VEDALAÅMA MESAJLARI - Ã–NCELÄ°KLÄ°\n  if (messageParser.isGoodbyeMessage(cleanMessage)) {\n    console.log(`ğŸ‘‹ VedalaÅŸma mesajÄ± algÄ±landÄ±`);\n    await greetingManager.handleGoodbye(message, contactName);\n    return;\n  }\n  \n  // Ã‡IKIÅ KOMUTLARI - Ã–NCELÄ°KLÄ°\n  if (isExitCommand(cleanMessage)) {\n    console.log(`ğŸšª Ã‡Ä±kÄ±ÅŸ komutu algÄ±landÄ±`);\n    await handleExitCommand(message, services, contactName);\n    return;\n  }\n  \n  // DÄ°ÄER HÄ°ZMETLER Ä°STEÄÄ° - Ã–NCELÄ°KLÄ°\n  if (messageParser.isOtherServicesRequest(cleanMessage)) {\n    console.log(`ğŸ”„ DiÄŸer hizmetler isteÄŸi algÄ±landÄ±`);\n    await handleOtherServicesRequest(message, services, contactName);\n    return;\n  }\n  \n  // Ã–NCE: SatÄ±ÅŸ cevabÄ± durumunu kontrol et\n  if (session && session.currentState === 'waiting_for_sale_response') {\n    const saleFlow = require('../saleFlow');\n    await saleFlow.handleSaleResponse(message, cleanMessage, services);\n    return;\n  }\n  \n  // SONRA: Soru-cevap akÄ±ÅŸÄ±\n  if (session && session.currentState === 'collecting_answer') {\n    const success = await serviceFlow.handleAnswer(message, cleanMessage, session);\n    return;\n  }\n  \n  // MENÃœ Ä°STEÄÄ° - Ã–NCELÄ°KLÄ°\n  if (messageParser.isMenuRequest(cleanMessage)) {\n    console.log(`ğŸ“‹ MenÃ¼ isteÄŸi algÄ±landÄ±`);\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    await menuHandler.showMainMenu(message, services);\n    return;\n  }\n  \n  // SAYI SEÃ‡Ä°MÄ° - Ã–NCELÄ°KLÄ°\n  if (messageParser.isNumberInput(cleanMessage)) {\n    const number = parseInt(cleanMessage);\n    console.log(`ğŸ”¢ SayÄ± seÃ§imi algÄ±landÄ±: ${number}, Durum: ${session?.currentState}`);\n    await menuHandler.handleNumberSelection(message, number, services);\n    return;\n  }\n  \n  // YARDIM Ä°STEÄÄ°\n  if (messageParser.isHelpRequest(cleanMessage)) {\n    console.log(`â“ YardÄ±m isteÄŸi algÄ±landÄ±`);\n    await handleHelpRequest(message, services, contactName);\n    return;\n  }\n  \n  // Ä°PTAL Ä°STEÄÄ°\n  if (messageParser.isCancelRequest(cleanMessage)) {\n    console.log(`â¹ï¸ Ä°ptal isteÄŸi algÄ±landÄ±`);\n    await handleCancelRequest(message, services, contactName);\n    return;\n  }\n  \n  // EÄŸer selamlama varsa, Ã¶nce selamla\n  if (greetingPart && messageParser.isGreeting(greetingPart)) {\n    await greetingManager.handleGreeting(message, services, contactName);\n    \n    // EÄŸer selamlamadan sonra iÅŸlem de varsa, 2 saniye bekle ve iÅŸlemi baÅŸlat\n    if (servicePart && servicePart.length > 0) {\n      setTimeout(async () => {\n        await processServiceRequest(message, servicePart, services);\n      }, 2000);\n      return;\n    }\n    return;\n  }\n  \n  // Sadece iÅŸlem varsa, direkt iÅŸlemi baÅŸlat\n  if (servicePart && servicePart.length > 0) {\n    await processServiceRequest(message, servicePart, services);\n    return;\n  }\n  \n  // Bilinmeyen mesaj\n  await handleUnknownMessage(message, services, contactName);\n}\n\n// Ã‡Ä±kÄ±ÅŸ komutu kontrolÃ¼\nfunction isExitCommand(message) {\n  const exitCommands = ['Ã§Ä±kÄ±ÅŸ', 'Ã§Ä±kÄ±s', 'exit', 'quit', 'geri', 'ana menÃ¼', 'ana menu', 'menÃ¼ye dÃ¶n', 'menuye don', 'back', 'return'];\n  return exitCommands.some(cmd => message.includes(cmd));\n}\n\n// Ã‡Ä±kÄ±ÅŸ komutu iÅŸleme - GÃœNCELLENDÄ°\nasync function handleExitCommand(message, services, contactName = '') {\n  sessionManager.updateUserSession(message.from, { \n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  const personalization = require('./personalization');\n  const exitText = contactName ? \n    `ğŸ‘‹ ${contactName}, ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z!` :\n    `ğŸ‘‹ Ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z!`;\n  \n  await sendResponse(message, exitText);\n  await menuHandler.showMainMenu(message, services);\n}\n\n// DiÄŸer hizmetler isteÄŸi iÅŸleme - GÃœNCELLENDÄ°\nasync function handleOtherServicesRequest(message, services, contactName = '') {\n  console.log(`ğŸ” DiÄŸer hizmetler isteÄŸi algÄ±landÄ±`);\n  \n  const personalization = require('./personalization');\n  const otherServicesText = contactName ? \n    `ğŸ”„ ${contactName}, diÄŸer hizmetlerimizi gÃ¶steriyorum...` :\n    `ğŸ”„ DiÄŸer hizmetlerimizi gÃ¶steriyorum...`;\n  \n  await sendResponse(message, otherServicesText);\n  \n  // Ana menÃ¼yÃ¼ gÃ¶ster\n  sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n  await menuHandler.showMainMenu(message, services);\n}\n\n// YardÄ±m isteÄŸi iÅŸleme - GÃœNCELLENDÄ°\nasync function handleHelpRequest(message, services, contactName = '') {\n  const personalization = require('./personalization');\n  const helpText = contactName ? \n    `â“ ${contactName}, size nasÄ±l yardÄ±mcÄ± olabilirim?\\n\\n` :\n    `â“ Size nasÄ±l yardÄ±mcÄ± olabilirim?\\n\\n`;\n  \n  await sendResponse(message, helpText +\n    `â€¢ Bir hizmet adÄ± yazÄ±n (Ã¶rnek: \"sigorta\", \"yazÄ±lÄ±m\")\\n` +\n    `â€¢ \"menÃ¼\" yazarak tÃ¼m seÃ§enekleri gÃ¶rebilirsiniz\\n` +\n    `â€¢ SayÄ± yazarak seÃ§im yapabilirsiniz\\n` +\n    `â€¢ \"Ã§Ä±kÄ±ÅŸ\" yazarak ana menÃ¼ye dÃ¶nebilirsiniz\\n` +\n    `â€¢ \"teÅŸekkÃ¼r ederim\" diyerek konuÅŸmayÄ± bitirebilirsiniz`);\n}\n\n// Ä°ptal isteÄŸi iÅŸleme - GÃœNCELLENDÄ°\nasync function handleCancelRequest(message, services, contactName = '') {\n  sessionManager.updateUserSession(message.from, { \n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {}\n  });\n  \n  const personalization = require('./personalization');\n  const cancelText = contactName ? \n    `â¹ï¸ ${contactName}, iÅŸleminiz iptal edildi. Ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z.` :\n    `â¹ï¸ Ä°ÅŸleminiz iptal edildi. Ana menÃ¼ye dÃ¶ndÃ¼nÃ¼z.`;\n  \n  await sendResponse(message, cancelText);\n  await menuHandler.showMainMenu(message, services);\n}\n\nasync function processServiceRequest(message, serviceRequest, services) {\n  console.log(`ğŸ” Servis isteÄŸi iÅŸleniyor: \"${serviceRequest}\"`);\n  \n  // Ã–zel durumlar - servis olarak aranmamalÄ±\n  if (serviceRequest.toLowerCase().includes('menÃ¼') || serviceRequest.toLowerCase().includes('menu')) {\n    console.log(`ğŸ“‹ MenÃ¼ isteÄŸi - servis olarak aranmayacak`);\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    await menuHandler.showMainMenu(message, services);\n    return;\n  }\n  \n  // AnlamsÄ±z mesaj kontrolÃ¼\n  if (isMeaninglessMessage(serviceRequest)) {\n    console.log(`â“ AnlamsÄ±z mesaj algÄ±landÄ±`);\n    await handleMeaninglessMessage(message, services);\n    return;\n  }\n  \n  const matchedService = serviceMatcher.findMatchingService(serviceRequest, services);\n  \n  if (matchedService) {\n    console.log(`âœ… Servis eÅŸleÅŸti: ${matchedService.type} - ${matchedService.name}`);\n    if (matchedService.type === 'category') {\n      await menuHandler.showCategoryOptions(message, matchedService, services);\n      sessionManager.updateUserSession(message.from, { currentState: `submenu_${matchedService.name}` });\n    } else {\n      await serviceFlow.startServiceFlow(message, matchedService);\n    }\n  } else {\n    console.log(`âŒ Servis eÅŸleÅŸmedi: \"${serviceRequest}\"`);\n    await handleUnknownMessage(message, services);\n  }\n}\n\n// AnlamsÄ±z mesaj kontrolÃ¼\nfunction isMeaninglessMessage(message) {\n  const meaninglessPatterns = [\n    /^[\\u{1F600}-\\u{1F64F}]+$/u, // Sadece emoji\n    /^[^\\w\\s]+$/, // Sadece Ã¶zel karakterler\n    /^.{1,2}$/, // 1-2 karakter\n    /^(.)\\1+$/, // AynÄ± karakterin tekrarÄ± (aaa, ???)\n  ];\n  \n  return meaninglessPatterns.some(pattern => pattern.test(message));\n}\n\n// AnlamsÄ±z mesaj iÅŸleme - GÃœNCELLENDÄ°\nasync function handleMeaninglessMessage(message, services) {\n  await sendResponse(message, `ğŸ¤” AnlayamadÄ±m. LÃ¼tfen:\\n\\n` +\n    `â€¢ Bir hizmet adÄ± yazÄ±n\\n` +\n    `â€¢ \"menÃ¼\" yazarak seÃ§enekleri gÃ¶rÃ¼n\\n` +\n    `â€¢ \"yardÄ±m\" yazarak destek alÄ±n`);\n}\n\n// Bilinmeyen mesaj iÅŸleme - GÃœNCELLENDÄ°\nasync function handleUnknownMessage(message, services, contactName = '') {\n  const personalization = require('./personalization');\n  const unknownText = personalization.createPersonalizedUnknownMessage(contactName);\n  \n  await sendResponse(message, `${unknownText}\\n\\n` +\n    `â€¢ \"sigorta\" - Sigorta hizmetleri\\n` +\n    `â€¢ \"yazÄ±lÄ±m\" - YazÄ±lÄ±m geliÅŸtirme\\n` +\n    `â€¢ \"lojistik\" - Nakliye hizmetleri\\n` +\n    `â€¢ \"diÄŸer hizmetler\" - TÃ¼m seÃ§enekleri gÃ¶rÃ¼n\\n` +\n    `â€¢ Veya diÄŸer hizmetlerimiz...\\n\\n` +\n    `YardÄ±m iÃ§in \"menÃ¼\" yazabilirsiniz.\\n` +\n    `Ã‡Ä±kmak iÃ§in \"Ã§Ä±kÄ±ÅŸ\" yazabilirsiniz.`);\n}\n\nmodule.exports = {\n  route,\n  processServiceRequest,\n  handleUnknownMessage,\n  handleExitCommand,\n  handleOtherServicesRequest,\n  handleHelpRequest,\n  handleCancelRequest\n};\n\n\n============================================================\n// DOSYA: modules/messagehandler.js\n============================================================\n\n// modules/messageHandler.js - GÃœNCELLENDÄ°\nconst logger = require('./logger');\nconst messageParser = require('./messageHandler/messageParser');\nconst sessionRouter = require('./messageHandler/sessionRouter');\nconst contactManager = require('./messageHandler/contactManager');\nconst validation = require('./messageHandler/validation');\nconst errorHandler = require('./messageHandler/errorHandler');\nconst { sendMessageWithoutQuote } = require('./utils/globalClient'); // YENÄ° EKLENDÄ°\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendReply(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n    logger.info(`ğŸ“¤ Mesaj gÃ¶nderildi (alÄ±ntÄ±sÄ±z): ${message.from}`);\n  } catch (error) {\n    logger.error(`Mesaj gÃ¶nderme hatasÄ±: ${error.message}`);\n    // Fallback: normal reply kullan\n    try {\n      await message.reply(text);\n    } catch (fallbackError) {\n      logger.error(`Fallback mesaj gÃ¶nderme de baÅŸarÄ±sÄ±z: ${fallbackError.message}`);\n    }\n  }\n}\n\n// Ana mesaj iÅŸleme fonksiyonu\nasync function handleMessage(message) {\n  try {\n    // 1. MesajÄ± doÄŸrula\n    const validationResult = validation.validateMessage(message);\n    if (!validationResult.isValid) {\n      if (validationResult.reason === 'has_media') {\n        await errorHandler.handleMediaError(message);\n      }\n      return;\n    }\n\n    // 2. MÃ¼ÅŸteri bilgilerini al ve logla\n    const contactInfo = await contactManager.logContactInteraction(message, 'Mesaj alÄ±ndÄ±');\n    \n    // 3. KullanÄ±cÄ± cevap verdiÄŸinde tÃ¼m timer'larÄ± durdur\n    const sessionManager = require('./sessionManager');\n    sessionManager.stopHelpTimer(message.from);\n    sessionManager.stopMenuTimer(message.from);\n    \n    // 4. MesajÄ± ayrÄ±ÅŸtÄ±r\n    const parsedMessage = messageParser.parseMessage(validationResult.messageBody);\n    \n    // 5. Oturum durumuna gÃ¶re yÃ¶nlendir\n    await sessionRouter.route(message, parsedMessage, contactInfo.name);\n    \n  } catch (error) {\n    await errorHandler.handleError(message, error);\n  }\n}\n\nmodule.exports = {\n  handleMessage,\n  sendReply, // YENÄ° EKLENDÄ°\n  getTimeBasedGreeting: require('./messageHandler/greetingManager').getTimeBasedGreeting,\n  isGreeting: messageParser.isGreeting,\n  parseMessage: messageParser.parseMessage,\n  handleGreeting: require('./messageHandler/greetingManager').handleGreeting,\n  findMatchingService: require('./messageHandler/serviceMatcher').findMatchingService,\n  createPersonalizedGreeting: require('./messageHandler/personalization').createPersonalizedGreeting\n};\n\n\n============================================================\n// DOSYA: modules/saleflow/timeoutmanager.js\n============================================================\n\n// modules/saleFlow/timeoutManager.js\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { getGlobalClient } = require('../utils/globalClient');\n\n// SatÄ±ÅŸ zaman aÅŸÄ±mÄ± baÅŸlat\nfunction startSaleTimeout(userId, message) {\n  const session = sessionManager.getUserSession(userId);\n  \n  // Ã–nceki timer'Ä± temizle\n  if (session && session.saleTimer) {\n    clearTimeout(session.saleTimer);\n  }\n  \n  console.log(`â° SatÄ±ÅŸ zaman aÅŸÄ±mÄ± baÅŸlatÄ±ldÄ±: ${userId}`);\n  \n  const saleTimer = setTimeout(async () => {\n    await handleSaleTimeout(userId);\n  }, 5 * 60 * 1000); // 5 dakika\n  \n  // KonuÅŸmayÄ± baÅŸlat\n  const conversationManager = require('./conversationManager');\n  conversationManager.startSaleConversation(userId);\n  \n  sessionManager.updateUserSession(userId, {\n    saleTimer: saleTimer,\n    currentState: 'waiting_for_sale_response'\n  });\n}\n\n// SatÄ±ÅŸ zaman aÅŸÄ±mÄ± iÅŸleme - CLIENT FIX Ä°LE GÃœNCELLENDÄ°\nasync function handleSaleTimeout(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.currentState === 'waiting_for_sale_response') {\n    logger.info(`â° SatÄ±ÅŸ zaman aÅŸÄ±mÄ± - KullanÄ±cÄ±: ${userId}`);\n    \n    try {\n      // Global client instance'Ä±nÄ± kullan\n      const client = getGlobalClient();\n      \n      if (client && client.info) {\n        const chat = await client.getChatById(userId);\n        await chat.sendMessage('â° *Cevap sÃ¼resi doldu*\\n\\n' +\n                              'YeÅŸil Sigorta ihtiyacÄ±nÄ±z olduÄŸunda tekrar \"yeÅŸil sigorta\" yazabilirsiniz. ğŸ›¡ï¸\\n\\n' +\n                              'Ä°yi gÃ¼nler dilerim! âœ¨');\n        logger.info(`Zaman aÅŸÄ±mÄ± mesajÄ± gÃ¶nderildi: ${userId}`);\n      } else {\n        logger.warn('Client instance hazÄ±r deÄŸil, zaman aÅŸÄ±mÄ± mesajÄ± gÃ¶nderilemedi');\n      }\n      \n    } catch (error) {\n      logger.error(`Zaman aÅŸÄ±mÄ± mesajÄ± gÃ¶nderme hatasÄ±: ${error.message}`);\n    }\n    \n    // KonuÅŸmayÄ± bitir\n    const conversationManager = require('./conversationManager');\n    await conversationManager.endSaleConversation(userId);\n    conversationManager.logSaleStatistics(userId, 'timeout', false);\n  }\n}\n\n// SatÄ±ÅŸ timer'Ä±nÄ± temizle\nfunction clearSaleTimer(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.saleTimer) {\n    clearTimeout(session.saleTimer);\n    sessionManager.updateUserSession(userId, { saleTimer: null });\n    console.log(`â° SatÄ±ÅŸ timer temizlendi: ${userId}`);\n  }\n}\n\n// TÃ¼m satÄ±ÅŸ timer'larÄ±nÄ± temizle (shutdown iÃ§in)\nfunction clearAllSaleTimers() {\n  const sessions = sessionManager.userSessions;\n  let clearedCount = 0;\n  \n  sessions.forEach((session, userId) => {\n    if (session.saleTimer) {\n      clearTimeout(session.saleTimer);\n      clearedCount++;\n    }\n  });\n  \n  console.log(`â° ${clearedCount} satÄ±ÅŸ timer temizlendi`);\n}\n\nmodule.exports = {\n  startSaleTimeout,\n  handleSaleTimeout,\n  clearSaleTimer,\n  clearAllSaleTimers\n};\n\n\n============================================================\n// DOSYA: modules/saleflow/servicefinder.js\n============================================================\n\n// modules/saleFlow/serviceFinder.js\nconst logger = require('../logger');\n\n// YeÅŸil Sigorta servisini bul - DÃœZELTÄ°LDÄ°\nfunction findYesilSigortaService(services) {\n  console.log(`ğŸ” YeÅŸil Sigorta servisi aranÄ±yor...`);\n  \n  for (const [categoryName, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object' && categoryServices['yesil_sigorta']) { // yesil_sigortasi â†’ yesil_sigorta\n      console.log(`âœ… YeÅŸil Sigorta bulundu: ${categoryName}/yesil_sigorta`);\n      return {\n        type: 'service',\n        data: categoryServices['yesil_sigorta'],\n        category: categoryName,\n        name: 'yesil_sigorta'\n      };\n    }\n  }\n  \n  console.log(`âŒ YeÅŸil Sigorta servisi bulunamadÄ±`);\n  \n  // Alternatif servisleri kontrol et\n  const alternativeServices = findAlternativeServices(services);\n  if (alternativeServices.length > 0) {\n    console.log(`ğŸ’¡ Alternatif servisler bulundu:`, alternativeServices);\n  }\n  \n  return null;\n}\n\n// Alternatif servisleri bul\nfunction findAlternativeServices(services) {\n  const alternatives = [];\n  const targetServices = ['yesil_sigorta', 'trafik_sigortasi', 'kasko']; // yesil_sigortasi â†’ yesil_sigorta\n  \n  for (const serviceKey of targetServices) {\n    for (const [categoryName, categoryServices] of Object.entries(services)) {\n      if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n        alternatives.push({\n          name: serviceKey,\n          category: categoryName,\n          displayName: categoryServices[serviceKey].service_name || serviceKey\n        });\n      }\n    }\n  }\n  \n  return alternatives;\n}\n\n// TÃ¼m sigorta servislerini listele\nfunction getAllInsuranceServices(services) {\n  const insuranceServices = [];\n  \n  // Sigorta kategorilerinde ara\n  const insuranceCategories = ['sigorta_hizmetleri', 'sigorta_ana_kategori'];\n  \n  for (const category of insuranceCategories) {\n    if (services[category]) {\n      for (const [serviceKey, serviceData] of Object.entries(services[category])) {\n        if (typeof serviceData === 'object' && serviceData.service_name) {\n          insuranceServices.push({\n            key: serviceKey,\n            name: serviceData.service_name,\n            category: category\n          });\n        }\n      }\n    }\n  }\n  \n  return insuranceServices;\n}\n\n// Servis Ã¶ncelik sÄ±ralamasÄ± - DÃœZELTÄ°LDÄ°\nfunction getServicePriority(serviceName) {\n  const priorityMap = {\n    'yesil_sigorta': 1, // yesil_sigortasi â†’ yesil_sigorta\n    'trafik_sigortasi': 2,\n    'kasko': 3,\n    'konut_sigortasi': 4,\n    'dask': 5\n  };\n  \n  return priorityMap[serviceName] || 999;\n}\n\nmodule.exports = {\n  findYesilSigortaService,\n  findAlternativeServices,\n  getAllInsuranceServices,\n  getServicePriority\n};\n\n\n============================================================\n// DOSYA: modules/saleflow/responsehandler.js\n============================================================\n\n// modules/saleFlow/responseHandler.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendSaleResponse(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('SatÄ±ÅŸ cevabÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// SatÄ±ÅŸ cevabÄ±nÄ± iÅŸleme - GÃœNCELLENDÄ°\nasync function handleSaleResponse(message, response, services) {\n  const cleanResponse = response.toLowerCase().trim();\n  \n  console.log(`ğŸ’° SatÄ±ÅŸ cevabÄ± iÅŸleniyor: \"${cleanResponse}\"`);\n  \n  // Olumlu cevaplar\n  const positiveResponses = ['evet', 'yes', 'ok', 'tamam', 'baÅŸla', 'baÅŸlayalÄ±m', 'oluÅŸtur', 'yapalÄ±m', 'âœ…', 'ğŸ‘'];\n  \n  // Olumsuz cevaplar\n  const negativeResponses = ['hayÄ±r', 'no', 'yok', 'later', 'sonra', 'âŒ', 'ğŸ‘'];\n  \n  if (isPositiveResponse(cleanResponse, positiveResponses)) {\n    // Olumlu cevap - YeÅŸil Sigorta soru-cevap akÄ±ÅŸÄ±nÄ± baÅŸlat\n    await handlePositiveResponse(message, services);\n    \n  } else if (isNegativeResponse(cleanResponse, negativeResponses)) {\n    // Olumsuz cevap\n    await handleNegativeResponse(message);\n    \n  } else {\n    // AnlaÅŸÄ±lamayan cevap\n    await handleUnknownResponse(message);\n  }\n}\n\n// Olumlu cevap kontrolÃ¼\nfunction isPositiveResponse(response, positiveResponses) {\n  return positiveResponses.some(pos => response.includes(pos));\n}\n\n// Olumsuz cevap kontrolÃ¼\nfunction isNegativeResponse(response, negativeResponses) {\n  return negativeResponses.some(neg => response.includes(neg));\n}\n\n// Olumlu cevap iÅŸleme - GÃœNCELLENDÄ°\nasync function handlePositiveResponse(message, services) {\n  await sendSaleResponse(message, 'ğŸ‰ Harika! YeÅŸil Sigorta poliÃ§enizi oluÅŸturmaya baÅŸlÄ±yorum...');\n  \n  // YeÅŸil Sigorta servisini bul\n  const serviceFinder = require('./serviceFinder');\n  const yesilSigortaService = serviceFinder.findYesilSigortaService(services);\n  \n  if (yesilSigortaService) {\n    // SatÄ±ÅŸ zamanlayÄ±cÄ±sÄ±nÄ± temizle\n    const timeoutManager = require('./timeoutManager');\n    timeoutManager.clearSaleTimer(message.from);\n    \n    // YeÅŸil Sigorta akÄ±ÅŸÄ±nÄ± baÅŸlat\n    const serviceFlow = require('../serviceFlow');\n    await serviceFlow.startServiceFlow(message, yesilSigortaService);\n  } else {\n    await sendSaleResponse(message, 'âŒ YeÅŸil Sigorta servisi bulunamadÄ±. LÃ¼tfen daha sonra tekrar deneyin.');\n    await endConversation(message);\n  }\n}\n\n// Olumsuz cevap iÅŸleme - GÃœNCELLENDÄ°\nasync function handleNegativeResponse(message) {\n  await sendSaleResponse(message, 'ğŸ‘ AnladÄ±m. YeÅŸil Sigorta ihtiyacÄ±nÄ±z olduÄŸunda buradayÄ±m! ğŸ›¡ï¸');\n  await endConversation(message);\n}\n\n// AnlaÅŸÄ±lamayan cevap iÅŸleme - GÃœNCELLENDÄ°\nasync function handleUnknownResponse(message) {\n  await sendSaleResponse(message, 'âŒ AnlayamadÄ±m. LÃ¼tfen *Evet* veya *HayÄ±r* olarak cevap verin.\\n\\n' +\n                     'âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\n' +\n                     'âŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli');\n}\n\n// KonuÅŸmayÄ± bitir\nasync function endConversation(message) {\n  const conversationManager = require('./conversationManager');\n  await conversationManager.endSaleConversation(message.from);\n  \n  const serviceLoader = require('../serviceLoader');\n  const menuHandler = require('../menuHandler');\n  \n  setTimeout(async () => {\n    await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n  }, 3000);\n}\n\nmodule.exports = {\n  handleSaleResponse,\n  isPositiveResponse,\n  isNegativeResponse,\n  handlePositiveResponse,\n  handleNegativeResponse,\n  handleUnknownResponse,\n  endConversation\n};\n\n\n============================================================\n// DOSYA: modules/saleflow/conversationmanager.js\n============================================================\n\n// modules/saleFlow/conversationManager.js\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± baÅŸlat\nfunction startSaleConversation(userId) {\n  console.log(`ğŸ’° SatÄ±ÅŸ konuÅŸmasÄ± baÅŸlatÄ±lÄ±yor: ${userId}`);\n  \n  sessionManager.updateUserSession(userId, {\n    currentState: 'waiting_for_sale_response',\n    inSaleConversation: true,\n    saleStartTime: Date.now()\n  });\n}\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± bitir\nasync function endSaleConversation(userId) {\n  console.log(`ğŸ’° SatÄ±ÅŸ konuÅŸmasÄ± bitiriliyor: ${userId}`);\n  \n  const session = sessionManager.getUserSession(userId);\n  const saleDuration = session?.saleStartTime ? Date.now() - session.saleStartTime : 0;\n  \n  logger.info(`SatÄ±ÅŸ konuÅŸmasÄ± tamamlandÄ± - KullanÄ±cÄ±: ${userId}, SÃ¼re: ${saleDuration}ms`);\n  \n  sessionManager.updateUserSession(userId, {\n    currentState: 'main_menu',\n    inSaleConversation: false,\n    saleStartTime: null,\n    saleTimer: null\n  });\n}\n\n// SatÄ±ÅŸ istatistiklerini kaydet\nfunction logSaleStatistics(userId, responseType, success = false) {\n  const session = sessionManager.getUserSession(userId);\n  const saleDuration = session?.saleStartTime ? Date.now() - session.saleStartTime : 0;\n  \n  const stats = {\n    userId: userId,\n    responseType: responseType,\n    success: success,\n    duration: saleDuration,\n    timestamp: new Date().toISOString()\n  };\n  \n  logger.info(`SatÄ±ÅŸ istatistiÄŸi: ${JSON.stringify(stats)}`);\n  \n  // Ä°steÄŸe baÄŸlÄ±: VeritabanÄ±na veya dosyaya kaydet\n  saveSaleStatsToFile(stats);\n}\n\n// SatÄ±ÅŸ istatistiklerini dosyaya kaydet\nfunction saveSaleStatsToFile(stats) {\n  try {\n    const statsDir = './sales_stats';\n    if (!require('fs').existsSync(statsDir)) {\n      require('fs').mkdirSync(statsDir, { recursive: true });\n    }\n    \n    const filename = `sale_stats_${new Date().toISOString().split('T')[0]}.json`;\n    const filePath = require('path').join(statsDir, filename);\n    \n    let existingStats = [];\n    if (require('fs').existsSync(filePath)) {\n      const fileContent = require('fs').readFileSync(filePath, 'utf8');\n      existingStats = JSON.parse(fileContent);\n    }\n    \n    existingStats.push(stats);\n    require('fs').writeFileSync(filePath, JSON.stringify(existingStats, null, 2), 'utf8');\n    \n  } catch (error) {\n    logger.error(`SatÄ±ÅŸ istatistiÄŸi kaydetme hatasÄ±: ${error.message}`);\n  }\n}\n\n// SatÄ±ÅŸ baÅŸarÄ± oranÄ±nÄ± hesapla\nfunction calculateSaleSuccessRate() {\n  // Bu fonksiyon istatistik dosyalarÄ±nÄ± analiz edebilir\n  // Åu anlÄ±k basit bir implementasyon\n  return {\n    totalConversations: 0,\n    successfulSales: 0,\n    successRate: 0\n  };\n}\n\nmodule.exports = {\n  startSaleConversation,\n  endSaleConversation,\n  logSaleStatistics,\n  saveSaleStatsToFile,\n  calculateSaleSuccessRate\n};\n\n\n============================================================\n// DOSYA: modules/saleflow/salemanager.js\n============================================================\n\n// modules/saleFlow/saleManager.js - GÃœNCELLENDÄ°\nconst logger = require('../logger');\nconst sessionManager = require('../sessionManager');\nconst { sendMessageWithoutQuote } = require('../utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendSaleMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('SatÄ±ÅŸ mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// SatÄ±ÅŸ teklifi sorma - GÃœNCELLENDÄ°\nasync function askForSale(message) {\n  const saleQuestion = `ğŸ¯ *YeÅŸil Sigorta PoliÃ§enizi hemen dÃ¼zenleyelim mi?*\\n\\n` +\n                      `PoliÃ§enizi oluÅŸturmak iÃ§in sadece birkaÃ§ bilgiye ihtiyacÄ±mÄ±z var.\\n\\n` +\n                      `âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\n` +\n                      `âŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli`;\n  \n  await sendSaleMessage(message, saleQuestion);\n  \n  // SatÄ±ÅŸ oturumu baÅŸlat\n  const timeoutManager = require('./timeoutManager');\n  timeoutManager.startSaleTimeout(message.from, message);\n}\n\n// SatÄ±ÅŸ teklifi formatlarÄ±\nfunction getSaleQuestions() {\n  return {\n    yesil_sigorta: {\n      question: `ğŸ¯ *YeÅŸil Sigorta PoliÃ§enizi hemen dÃ¼zenleyelim mi?*`,\n      options: `âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\nâŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli`\n    },\n    trafik_sigortasi: {\n      question: `ğŸ¯ *Trafik SigortasÄ± poliÃ§enizi hemen oluÅŸturalÄ±m mÄ±?*`,\n      options: `âœ… *Evet* - PoliÃ§e oluÅŸturmaya baÅŸlayalÄ±m\\nâŒ *HayÄ±r* - Åimdilik sadece fiyat bilgisi yeterli`\n    }\n  };\n}\n\n// Servise Ã¶zel satÄ±ÅŸ sorusu oluÅŸtur - GÃœNCELLENDÄ°\nasync function askServiceSpecificSale(message, serviceName) {\n  const questions = getSaleQuestions();\n  const serviceQuestion = questions[serviceName] || questions['yesil_sigorta'];\n  \n  const saleQuestion = `${serviceQuestion.question}\\n\\n${serviceQuestion.options}`;\n  \n  await sendSaleMessage(message, saleQuestion);\n  \n  // SatÄ±ÅŸ oturumu baÅŸlat\n  const timeoutManager = require('./timeoutManager');\n  timeoutManager.startSaleTimeout(message.from, message);\n}\n\nmodule.exports = {\n  askForSale,\n  askServiceSpecificSale,\n  getSaleQuestions\n};\n\n\n============================================================\n// DOSYA: modules/saleflow.js\n============================================================\n\n// modules/saleFlow.js - ANA YÃ–NLENDÄ°RÄ°CÄ° DOSYA\nconst saleManager = require('./saleFlow/saleManager');\nconst responseHandler = require('./saleFlow/responseHandler');\nconst serviceFinder = require('./saleFlow/serviceFinder');\nconst conversationManager = require('./saleFlow/conversationManager');\nconst timeoutManager = require('./saleFlow/timeoutManager');\n\n// SatÄ±ÅŸ teklifi sorma\nasync function askForSale(message) {\n  await saleManager.askForSale(message);\n}\n\n// Servise Ã¶zel satÄ±ÅŸ teklifi sorma\nasync function askServiceSpecificSale(message, serviceName) {\n  await saleManager.askServiceSpecificSale(message, serviceName);\n}\n\n// SatÄ±ÅŸ cevabÄ±nÄ± iÅŸleme\nasync function handleSaleResponse(message, response, services) {\n  await responseHandler.handleSaleResponse(message, response, services);\n}\n\n// SatÄ±ÅŸ zaman aÅŸÄ±mÄ± iÅŸleme\nasync function handleSaleTimeout(userId) {\n  await timeoutManager.handleSaleTimeout(userId);\n}\n\n// YeÅŸil Sigorta servisini bul\nfunction findYesilSigortaService(services) {\n  return serviceFinder.findYesilSigortaService(services);\n}\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± baÅŸlat\nfunction startSaleConversation(userId) {\n  conversationManager.startSaleConversation(userId);\n}\n\n// SatÄ±ÅŸ konuÅŸmasÄ±nÄ± bitir\nasync function endSaleConversation(userId) {\n  await conversationManager.endSaleConversation(userId);\n}\n\n// SatÄ±ÅŸ timer'Ä±nÄ± temizle\nfunction clearSaleTimer(userId) {\n  timeoutManager.clearSaleTimer(userId);\n}\n\n// TÃ¼m satÄ±ÅŸ timer'larÄ±nÄ± temizle\nfunction clearAllSaleTimers() {\n  timeoutManager.clearAllSaleTimers();\n}\n\n// SatÄ±ÅŸ istatistiklerini kaydet\nfunction logSaleStatistics(userId, responseType, success = false) {\n  conversationManager.logSaleStatistics(userId, responseType, success);\n}\n\nmodule.exports = {\n  // Ana fonksiyonlar\n  askForSale,\n  askServiceSpecificSale,\n  handleSaleResponse,\n  handleSaleTimeout,\n  \n  // YardÄ±mcÄ± fonksiyonlar\n  findYesilSigortaService,\n  startSaleConversation,\n  endSaleConversation,\n  clearSaleTimer,\n  clearAllSaleTimers,\n  logSaleStatistics,\n  \n  // Alt modÃ¼llere eriÅŸim iÃ§in\n  saleManager,\n  responseHandler,\n  serviceFinder,\n  conversationManager,\n  timeoutManager\n};\n\n\n============================================================\n// DOSYA: modules/serviceflow.js\n============================================================\n\n// modules/serviceFlow.js - GÃœNCELLENDÄ°\nconst fs = require('fs');\nconst path = require('path');\nconst logger = require('./logger');\nconst sessionManager = require('./sessionManager');\nconst validationUtils = require('./validationUtils');\nconst { sendMessageWithoutQuote } = require('./utils/globalClient');\n\n// AlÄ±ntÄ±sÄ±z mesaj gÃ¶nderme yardÄ±mcÄ± fonksiyonu\nasync function sendServiceMessage(message, text) {\n  try {\n    await sendMessageWithoutQuote(message.from, text);\n  } catch (error) {\n    console.error('Servis mesajÄ± gÃ¶nderme hatasÄ±, fallback kullanÄ±lÄ±yor:', error.message);\n    await message.reply(text);\n  }\n}\n\n// Servis akÄ±ÅŸÄ±nÄ± baÅŸlat - GÃœNCELLENDÄ°\nasync function startServiceFlow(message, service) {\n  const serviceData = service.data;\n  \n  console.log(`ğŸš€ Servis baÅŸlatÄ±lÄ±yor: ${service.name}, Kategori: ${service.category}`);\n  \n  // FÄ°YAT LÄ°STESÄ° Ä°SE Ã–ZEL Ä°ÅLEM\n  if (service.category === 'fiyat_listeleri') {\n    await handlePriceList(message, service);\n    return;\n  }\n  \n  // NORMAL SERVÄ°S Ä°SE SORU-CEVAP AKIÅI\n  sessionManager.updateUserSession(message.from, {\n    currentService: service,\n    currentQuestions: serviceData.questions || [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: serviceData.service_name,\n    currentState: 'in_service'\n  });\n\n  await sendServiceMessage(message, serviceData.bot_greeting);\n  \n  const session = sessionManager.getUserSession(message.from);\n  if (session.currentQuestions.length > 0) {\n    await askNextQuestion(message, session);\n  } else {\n    await completeServiceFlow(message, session);\n  }\n}\n\n// Fiyat listesi iÅŸleme - GÃœNCELLENDÄ°\nasync function handlePriceList(message, service) {\n  const priceData = service.data;\n  \n  console.log(`ğŸ’° Fiyat listesi iÅŸleniyor: ${service.name}`, priceData);\n  \n  let priceText = `ğŸ’° *${service.name.replace(/_/g, ' ').toUpperCase()}*\\n\\n`;\n  \n  if (priceData.fiyat_tablosu) {\n    // YeÅŸil Sigorta fiyat formatÄ±\n    for (const [aracTipi, fiyatlar] of Object.entries(priceData.fiyat_tablosu)) {\n      priceText += `*${aracTipi}:*\\n`;\n      for (const [sure, fiyat] of Object.entries(fiyatlar)) {\n        const sureText = sure.replace('_gun', ' gÃ¼n').replace('15_gun', '15 gÃ¼n').replace('30_gun', '30 gÃ¼n').replace('90_gun', '90 gÃ¼n');\n        priceText += `  â€¢ ${sureText}: ${fiyat}\\n`;\n      }\n      priceText += '\\n';\n    }\n  }\n  \n  // Ã–NEMLÄ° BÄ°LGÄ°LENDÄ°RME ekle\n  if (priceData.Ã¶nemli_bilgilendirme) {\n    priceText += `âš ï¸ *Ã–nemli Bilgilendirme:*\\n${priceData.Ã¶nemli_bilgilendirme}\\n\\n`;\n  }\n  \n  // AÃ‡IKLAMA ekle\n  if (priceData.aciklama) {\n    priceText += `ğŸ“ *AÃ§Ä±klama:* ${priceData.aciklama}\\n\\n`;\n  }\n  \n  await sendServiceMessage(message, priceText);\n  \n  // 2 saniye bekle ve satÄ±ÅŸ teklifini gÃ¶ster\n  setTimeout(async () => {\n    try {\n      const saleFlow = require('./saleFlow');\n      await saleFlow.askForSale(message);\n    } catch (error) {\n      logger.error(`SatÄ±ÅŸ teklifi hatasÄ±: ${error.message}`);\n      console.log('âŒ SatÄ±ÅŸ teklifi gÃ¶sterilemedi:', error.message);\n      \n      // Fallback: Ana menÃ¼ye dÃ¶n\n      const serviceLoader = require('./serviceLoader');\n      const menuHandler = require('./menuHandler');\n      await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n    }\n  }, 2000);\n}\n\n// Sonraki soruyu sor - GÃœNCELLENDÄ°\nasync function askNextQuestion(message, session) {\n  const currentQuestion = session.currentQuestions[session.currentQuestionIndex];\n  \n  if (currentQuestion) {\n    let questionText = `ğŸ“ *Soru ${session.currentQuestionIndex + 1}/${session.currentQuestions.length}*\\n\\n`;\n    questionText += `${currentQuestion.question}`;\n    \n    if (currentQuestion.field_type === 'number') {\n      questionText += `\\n\\nğŸ’¡ *LÃ¼tfen sadece sayÄ± giriniz.*`;\n    } else if (currentQuestion.field_type === 'date') {\n      questionText += `\\n\\nğŸ’¡ *Format: GÃ¼n/Ay/YÄ±l (Ã–rnek: 15/01/2024)*`;\n    } else if (currentQuestion.field_type === 'phone') {\n      questionText += `\\n\\nğŸ’¡ *Format: 5XX XXX XX XX*`;\n    }\n    \n    await sendServiceMessage(message, questionText);\n    \n    sessionManager.updateUserSession(message.from, {\n      currentState: 'collecting_answer',\n      waitingForResponse: true\n    });\n  } else {\n    await completeServiceFlow(message, session);\n  }\n}\n\n// CevabÄ± iÅŸle - GÃœNCELLENDÄ°\nasync function handleAnswer(message, answer, session) {\n  const currentQuestion = session.currentQuestions[session.currentQuestionIndex];\n  const fieldName = currentQuestion.field_name;\n  \n  const validationResult = validationUtils.validateAnswer(answer, currentQuestion.field_type);\n  \n  if (!validationResult.isValid) {\n    await sendServiceMessage(message, `âŒ ${validationResult.errorMessage}\\n\\nLÃ¼tfen tekrar cevap verin:`);\n    return false;\n  }\n  \n  const updatedAnswers = {\n    ...session.collectedAnswers,\n    [fieldName]: validationResult.cleanedValue\n  };\n  \n  sessionManager.updateUserSession(message.from, {\n    collectedAnswers: updatedAnswers,\n    currentQuestionIndex: session.currentQuestionIndex + 1\n  });\n  \n  const updatedSession = sessionManager.getUserSession(message.from);\n  if (updatedSession.currentQuestionIndex < updatedSession.currentQuestions.length) {\n    await askNextQuestion(message, updatedSession);\n  } else {\n    await completeServiceFlow(message, updatedSession);\n  }\n  \n  return true;\n}\n\n// Servis akÄ±ÅŸÄ±nÄ± tamamla - GÃœNCELLENDÄ°\nasync function completeServiceFlow(message, session) {\n  if (!session.currentService || !session.currentService.data) {\n    console.log('âŒ Servis verisi bulunamadÄ±');\n    await sendServiceMessage(message, 'âŒ Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    \n    const serviceLoader = require('./serviceLoader');\n    const menuHandler = require('./menuHandler');\n    await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n    return;\n  }\n  \n  const serviceData = session.currentService.data;\n  const serviceName = serviceData.service_name || session.currentService.name || 'Servis';\n  \n  console.log(`âœ… Servis tamamlandÄ±: ${serviceName}`);\n  console.log(`ğŸ“Š Toplanan cevaplar:`, session.collectedAnswers);\n  \n  let completionText = `ğŸ‰ *${serviceName}* baÅŸvurunuz tamamlandÄ±!\\n\\n`;\n  \n  if (session.currentQuestions.length > 0) {\n    completionText += `âœ… Toplam ${session.currentQuestions.length} soru cevaplandÄ±.\\n\\n`;\n  }\n  \n  completionText += serviceData.completion_message || 'En kÄ±sa sÃ¼rede size dÃ¶nÃ¼ÅŸ yapacaÄŸÄ±z.';\n\n  await sendServiceMessage(message, completionText);\n  \n  // Sadece normal servisler iÃ§in kaydet (fiyat listeleri deÄŸil)\n  if (session.currentService.category !== 'fiyat_listeleri') {\n    await saveServiceApplication(session);\n  }\n  \n  sessionManager.updateUserSession(message.from, {\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: null\n  });\n  \n  const serviceLoader = require('./serviceLoader');\n  const menuHandler = require('./menuHandler');\n  \n  setTimeout(async () => {\n    await menuHandler.showMainMenu(message, serviceLoader.loadAllServices());\n  }, 2000);\n}\n\n// Servis baÅŸvurusunu kaydet\nasync function saveServiceApplication(session) {\n  try {\n    const applicationData = {\n      service: session.serviceFlow,\n      answers: session.collectedAnswers,\n      timestamp: new Date().toISOString(),\n      userId: session.userId\n    };\n    \n    const applicationsDir = './applications';\n    if (!fs.existsSync(applicationsDir)) {\n      fs.mkdirSync(applicationsDir, { recursive: true });\n    }\n    \n    const filename = `application_${Date.now()}_${session.userId.replace('@c.us', '')}.json`;\n    fs.writeFileSync(\n      path.join(applicationsDir, filename),\n      JSON.stringify(applicationData, null, 2),\n      'utf8'\n    );\n    \n    logger.info(`BaÅŸvuru kaydedildi: ${filename}`);\n    console.log(`ğŸ“„ BaÅŸvuru kaydedildi: ${filename}`);\n    \n  } catch (error) {\n    logger.error(`BaÅŸvuru kaydetme hatasÄ±: ${error.message}`);\n    console.error('âŒ BaÅŸvuru kaydetme hatasÄ±:', error);\n  }\n}\n\nmodule.exports = {\n  startServiceFlow,\n  handlePriceList,\n  askNextQuestion,\n  handleAnswer,\n  completeServiceFlow,\n  saveServiceApplication\n};\n\n\n============================================================\n// DOSYA: index.js\n============================================================\n\n// index.js - ARYA Bot Ana DosyasÄ± (MODÃœLER YAPILI - GÃœNCELLENMÄ°Å)\nconst { Client, LocalAuth } = require('whatsapp-web.js');\nconst qrcode = require('qrcode-terminal');\nconst express = require('express');\nconst path = require('path');\n\n// ModÃ¼lleri import et\nconst logger = require('./modules/logger');\nconst sessionManager = require('./modules/sessionManager');\nconst serviceLoader = require('./modules/serviceLoader');\nconst messageHandler = require('./modules/messageHandler');\nconst menuHandler = require('./modules/menuHandler');\n\n// Global client utility - EKLENDÄ°\nconst { setGlobalClient } = require('./modules/utils/globalClient');\n\n// WhatsApp client oluÅŸturma\nconst client = new Client({\n  authStrategy: new LocalAuth({\n    dataPath: './session'\n  }),\n  puppeteer: {\n    headless: true,\n    args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage']\n  }\n});\n\n// Global client'Ä± baÅŸlat - EKLENDÄ°\nsetGlobalClient(client);\nconsole.log('ğŸŒ Global client instance baÅŸlatÄ±ldÄ±');\n\n// QR kodu oluÅŸturma\nclient.on('qr', (qr) => {\n  console.log('\\nğŸ“± WHATSAPP BAÄLANTI KODU:');\n  console.log('========================');\n  qrcode.generate(qr, { small: true });\n  console.log('========================');\n  logger.info('QR kodu oluÅŸturuldu - WhatsApp Web\\'e baÄŸlanmak iÃ§in tarayÄ±n');\n});\n\n// BaÄŸlantÄ± baÅŸarÄ±lÄ±\nclient.on('ready', () => {\n  console.log('\\nâœ… ARYA BOT BAÅARIYLA BAÄLANDI!');\n  console.log('ğŸ¤– Bot: ARYA');\n  console.log('ğŸ¢ Firma: PlanB Global Network Ltd Åti');\n  console.log('ğŸš€ GeliÅŸtirici: EurAsia Trade And Technology Bulgaria EOOD - Ã†SIR Ekibi');\n  \n  // Client'Ä±n gerÃ§ekten hazÄ±r olduÄŸunu kontrol et\n  if (client.info) {\n    console.log(`ğŸ“± BaÄŸlÄ± kullanÄ±cÄ±: ${client.info.pushname}`);\n    console.log(`ğŸ“ Telefon: ${client.info.wid.user}`);\n  }\n  \n  logger.info('ARYA Bot baÅŸlatÄ±ldÄ± ve WhatsApp\\'a baÄŸlandÄ±');\n});\n\n// BaÄŸlantÄ± hatasÄ±\nclient.on('auth_failure', (msg) => {\n  logger.error('WhatsApp baÄŸlantÄ± hatasÄ±: ' + msg);\n  console.log('âŒ WhatsApp baÄŸlantÄ± hatasÄ±. LÃ¼tfen tekrar deneyin.');\n  console.log('ğŸ’¡ Oturum dosyalarÄ±nÄ± silmek iÃ§in: rm -rf session/');\n});\n\n// BaÄŸlantÄ± kesildi - OTOMATÄ°K YENÄ°DEN BAÄLANMA\nclient.on('disconnected', (reason) => {\n  logger.warn('WhatsApp baÄŸlantÄ±sÄ± kesildi: ' + reason);\n  console.log('ğŸ”Œ WhatsApp baÄŸlantÄ±sÄ± kesildi. 5 saniye sonra yeniden baÄŸlanÄ±lÄ±yor...');\n  \n  setTimeout(() => {\n    console.log('ğŸ”„ WhatsApp baÄŸlantÄ±sÄ± yeniden deneniyor...');\n    client.initialize().catch(err => {\n      logger.error('Yeniden baÄŸlanma hatasÄ±: ' + err.message);\n      console.log('âŒ Yeniden baÄŸlanma baÅŸarÄ±sÄ±z. LÃ¼tfen manuel olarak kontrol edin.');\n    });\n  }, 5000);\n});\n\n// Mesaj alma - YENÄ° MANTIK\nclient.on('message', async (message) => {\n  try {\n    await messageHandler.handleMessage(message);\n  } catch (error) {\n    logger.error(`Mesaj iÅŸleme hatasÄ±: ${error.message}`);\n    console.error('âŒ Mesaj iÅŸlenirken hata:', error);\n    \n    // KullanÄ±cÄ±ya hata mesajÄ± gÃ¶nder\n    try {\n      await message.reply('âŒ ÃœzgÃ¼nÃ¼m, bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');\n    } catch (replyError) {\n      logger.error(`Hata mesajÄ± gÃ¶nderilemedi: ${replyError.message}`);\n    }\n  }\n});\n\n// Express sunucusu\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\n// Environment variable kontrolÃ¼\nif (!process.env.PORT) {\n  console.log('âš ï¸  PORT environment variable bulunamadÄ±, varsayÄ±lan 3000 kullanÄ±lÄ±yor');\n}\n\napp.use(express.json());\n\n// Health check endpoint\napp.get('/health', (req, res) => {\n  const botStatus = client.info ? 'connected' : 'disconnected';\n  \n  res.json({ \n    status: 'OK', \n    bot: 'ARYA', \n    version: '1.0.0',\n    company: 'PlanB Global Network Ltd Åti',\n    whatsapp_status: botStatus,\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime(),\n    memory_usage: process.memoryUsage()\n  });\n});\n\n// Services endpoint\napp.get('/services', (req, res) => {\n  try {\n    const services = serviceLoader.loadAllServices();\n    res.json({\n      success: true,\n      data: services,\n      count: Object.keys(services).length,\n      loaded_at: new Date().toISOString()\n    });\n  } catch (error) {\n    logger.error(`Services endpoint hatasÄ±: ${error.message}`);\n    res.status(500).json({\n      success: false,\n      error: 'Servisler yÃ¼klenirken hata oluÅŸtu'\n    });\n  }\n});\n\n// Root endpoint\napp.get('/', (req, res) => {\n  res.json({\n    message: 'ARYA Bot API Service',\n    endpoints: {\n      health: '/health',\n      services: '/services'\n    },\n    documentation: 'ARYA Bot iÃ§in REST API servisi'\n  });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({\n    error: 'Endpoint bulunamadÄ±',\n    available_endpoints: ['/health', '/services']\n  });\n});\n\n// Sunucuyu baÅŸlat\napp.listen(PORT, () => {\n  console.log(`ğŸŒ ARYA Bot API http://localhost:${PORT} adresinde Ã§alÄ±ÅŸÄ±yor`);\n  console.log(`ğŸ“Š Health check: http://localhost:${PORT}/health`);\n  console.log(`ğŸ“‹ Servisler: http://localhost:${PORT}/services`);\n  logger.info(`ARYA Bot API ${PORT} portunda baÅŸlatÄ±ldÄ±`);\n});\n\n// Botu baÅŸlat\nconsole.log('ğŸš€ ARYA Bot baÅŸlatÄ±lÄ±yor...');\nconsole.log('ğŸ“ ModÃ¼ler yapÄ± yÃ¼kleniyor...');\n\nclient.initialize().catch(error => {\n  logger.error(`Bot baÅŸlatma hatasÄ±: ${error.message}`);\n  console.log('âŒ Bot baÅŸlatÄ±lamadÄ±:', error.message);\n  process.exit(1);\n});\n\n// Graceful shutdown\nprocess.on('SIGINT', async () => {\n  console.log('\\nğŸ›‘ ARYA Bot kapatÄ±lÄ±yor...');\n  \n  // TÃ¼m timer'larÄ± temizle - GÃœNCELLENDÄ°\n  const timeoutManager = require('./modules/saleFlow/timeoutManager');\n  timeoutManager.clearAllSaleTimers();\n  \n  sessionManager.userSessions.forEach(session => {\n    if (session.menuTimer) clearTimeout(session.menuTimer);\n    if (session.helpTimer) clearTimeout(session.helpTimer);\n    if (session.goodbyeTimer) clearTimeout(session.goodbyeTimer);\n  });\n  \n  // Client'Ä± temizle\n  try {\n    await client.destroy();\n    console.log('âœ… WhatsApp client temizlendi');\n  } catch (error) {\n    console.log('âš ï¸  Client temizleme hatasÄ±:', error.message);\n  }\n  \n  logger.info('ARYA Bot kapatÄ±ldÄ±');\n  console.log('ğŸ‘‹ ARYA Bot baÅŸarÄ±yla kapatÄ±ldÄ±');\n  process.exit(0);\n});\n\nprocess.on('SIGTERM', async () => {\n  console.log('\\nğŸ›‘ ARYA Bot SIGTERM sinyali aldÄ±, kapatÄ±lÄ±yor...');\n  await client.destroy();\n  process.exit(0);\n});\n\n// Beklenmeyen hatalar\nprocess.on('uncaughtException', (error) => {\n  logger.error(`Beklenmeyen hata: ${error.message}`);\n  console.log('âŒ Kritik hata oluÅŸtu:', error.message);\n  console.log('ğŸ”„ Bot yeniden baÅŸlatÄ±labilir...');\n});\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  logger.error(`Ä°ÅŸlenmemiÅŸ Promise: ${reason}`);\n  console.log('âš ï¸  Ä°ÅŸlenmemiÅŸ Promise hatasÄ±:', reason);\n});\n\n// BaÅŸlangÄ±Ã§ kontrolÃ¼\nsetTimeout(() => {\n  if (!client.info) {\n    console.log('â³ WhatsApp baÄŸlantÄ±sÄ± bekleniyor... QR kodu tarayÄ±n.');\n  }\n}, 3000);\n\n","size_bytes":112308},"modules/serviceLoader.js":{"content":"const fs = require('fs');\nconst path = require('path');\nconst logger = require('./logger');\n\n// JSON verilerini yÃ¼kleme fonksiyonu - GÃœNCELLENDÄ°\nfunction loadJSON(filePath) {\n  try {\n    // Ã–nce verilen yolu dene\n    if (fs.existsSync(filePath)) {\n      const data = fs.readFileSync(filePath, 'utf8');\n      const parsedData = JSON.parse(data);\n      console.log(`âœ… JSON yÃ¼klendi: ${filePath}`);\n      return parsedData;\n    }\n    \n    // GENEL_DÄ°YALOG klasÃ¶rÃ¼nde de dene\n    const genelDiyalogPath = path.join('./genel_diyalog', path.basename(filePath));\n    if (fs.existsSync(genelDiyalogPath)) {\n      const data = fs.readFileSync(genelDiyalogPath, 'utf8');\n      const parsedData = JSON.parse(data);\n      console.log(`âœ… JSON yÃ¼klendi (genel_diyalog): ${genelDiyalogPath}`);\n      return parsedData;\n    }\n\n    // Ana dizinde de dene\n    const rootPath = path.join('./', path.basename(filePath));\n    if (fs.existsSync(rootPath)) {\n      const data = fs.readFileSync(rootPath, 'utf8');\n      const parsedData = JSON.parse(data);\n      console.log(`âœ… JSON yÃ¼klendi (root): ${rootPath}`);\n      return parsedData;\n    }\n    \n    console.log(`âŒ JSON dosyasÄ± bulunamadÄ±: ${filePath}`);\n    return null;\n  } catch (error) {\n    logger.error(`JSON yÃ¼kleme hatasÄ± (${filePath}): ${error.message}`);\n    console.log(`âŒ JSON parse hatasÄ±: ${error.message}`);\n    return null;\n  }\n}\n\n// TÃ¼m servisleri yÃ¼kle - GÃœNCELLENDÄ°\nfunction loadAllServices() {\n  const services = {};\n  \n  console.log('ğŸ“ TÃ¼m servisler yÃ¼kleniyor...');\n  \n  // Ana kategorileri yÃ¼kle\n  const anaKategoriDosyalari = fs.readdirSync('./ana_kategoriler').filter(file => file.endsWith('.json'));\n  console.log(`ğŸ“‚ Ana kategoriler bulundu: ${anaKategoriDosyalari.length}`);\n  \n  anaKategoriDosyalari.forEach(file => {\n    const key = file.replace('.json', '');\n    services[key] = loadJSON(path.join('./ana_kategoriler', file));\n  });\n  \n  // Data klasÃ¶rÃ¼ndeki servisleri yÃ¼kle\n  if (fs.existsSync('./data')) {\n    const dataKlasorleri = fs.readdirSync('./data').filter(name => \n      fs.statSync(path.join('./data', name)).isDirectory()\n    );\n    \n    console.log(`ğŸ“‚ Data klasÃ¶rleri: ${dataKlasorleri.length}`);\n    \n    dataKlasorleri.forEach(klasor => {\n      const klasorYolu = path.join('./data', klasor);\n      services[klasor] = {};\n      \n      const servisDosyalari = fs.readdirSync(klasorYolu).filter(file => file.endsWith('.json'));\n      servisDosyalari.forEach(file => {\n        const servisAdi = file.replace('.json', '');\n        services[klasor][servisAdi] = loadJSON(path.join(klasorYolu, file));\n      });\n    });\n  }\n  \n  // Fiyat listelerini yÃ¼kle\n  const fiyatKlasoru = './fiyat_listeleri';\n  if (fs.existsSync(fiyatKlasoru)) {\n    services['fiyat_listeleri'] = {};\n    const fiyatDosyalari = fs.readdirSync(fiyatKlasoru).filter(file => file.endsWith('.json'));\n    \n    console.log(`ğŸ’° Fiyat dosyalarÄ±: ${fiyatDosyalari.length}`);\n    \n    fiyatDosyalari.forEach(file => {\n      const fiyatAdi = file.replace('.json', '');\n      services['fiyat_listeleri'][fiyatAdi] = loadJSON(path.join(fiyatKlasoru, file));\n    });\n  }\n  \n  // Genel diyalog dosyalarÄ±nÄ± yÃ¼kle\n  const genelDiyalogKlasoru = './genel_diyalog';\n  if (fs.existsSync(genelDiyalogKlasoru)) {\n    services['genel_diyalog'] = {};\n    const diyalogDosyalari = fs.readdirSync(genelDiyalogKlasoru).filter(file => file.endsWith('.json'));\n    \n    console.log(`ğŸ’¬ Diyalog dosyalarÄ±: ${diyalogDosyalari.length}`);\n    \n    diyalogDosyalari.forEach(file => {\n      const diyalogAdi = file.replace('.json', '');\n      services['genel_diyalog'][diyalogAdi] = loadJSON(path.join(genelDiyalogKlasoru, file));\n    });\n  }\n  \n  console.log(`ğŸ‰ Toplam ${Object.keys(services).length} kategori yÃ¼klendi`);\n  return services;\n}\n\nmodule.exports = {\n  loadJSON,\n  loadAllServices\n};","size_bytes":3866},"micro-modules/message/handleUnknownMessage.js":{"content":"// micro-modules/message/handleUnknownMessage.js\nasync function handleUnknownMessage(message, services) {\n  await message.reply(`ğŸ¤” AnlayamadÄ±m. LÃ¼tfen aÅŸaÄŸÄ±daki seÃ§eneklerden birini belirtin:\\n\\n` +\n                     `â€¢ \"sigorta\" - Sigorta hizmetleri\\n` +\n                     `â€¢ \"yazÄ±lÄ±m\" - YazÄ±lÄ±m geliÅŸtirme\\n` +\n                     `â€¢ \"lojistik\" - Nakliye hizmetleri\\n` +\n                     `â€¢ Veya diÄŸer hizmetlerimiz...\\n\\n` +\n                     `YardÄ±m iÃ§in \"menÃ¼\" yazabilirsiniz.`);\n}\n\nmodule.exports = handleUnknownMessage;","size_bytes":566},"jsontopla.py":{"content":"import os\nimport json\nfrom collections import OrderedDict\n\ndef hedef_json_dosyalarini_birlestir(ana_klasor='.', cikti_dosyasi='tumjsondosyalari.json'):\n    \"\"\"\n    Sadece belirli klasÃ¶rlerdeki JSON dosyalarÄ±nÄ± birleÅŸtirir.\n    \n    Args:\n        ana_klasor (str): Ana klasÃ¶r yolu\n        cikti_dosyasi (str): BirleÅŸtirilmiÅŸ Ã§Ä±ktÄ± dosyasÄ± adÄ±\n    \"\"\"\n    \n    # Hedef klasÃ¶r listesi (sadece bu klasÃ¶rlerdeki JSON'lar alÄ±nacak)\n    hedef_klasorler = [\n        'data',\n        'ana_kategoriler', \n        'fiyat_listeleri',\n        'genel_diyalog',\n        'config'\n    ]\n    \n    birlestirilmis_veri = OrderedDict()\n    toplam_dosya_sayisi = 0\n    \n    print(\"ğŸ¯ HEDEF KLASÃ–RLERDE JSON ARANIYOR...\")\n    print(\"=\" * 50)\n    \n    for hedef_klasor in hedef_klasorler:\n        klasor_yolu = os.path.join(ana_klasor, hedef_klasor)\n        \n        if not os.path.exists(klasor_yolu):\n            print(f\"âŒ KlasÃ¶r bulunamadÄ±: {hedef_klasor}\")\n            continue\n            \n        print(f\"\\nğŸ“ {hedef_klasor} klasÃ¶rÃ¼ taranÄ±yor...\")\n        \n        # Ana klasÃ¶rdeki JSON'lar\n        ana_jsonlar = [f for f in os.listdir(klasor_yolu) if f.endswith('.json')]\n        \n        # Alt klasÃ¶rlerdeki JSON'lar\n        alt_klasor_jsonlar = {}\n        for item in os.listdir(klasor_yolu):\n            item_yolu = os.path.join(klasor_yolu, item)\n            if os.path.isdir(item_yolu):\n                alt_jsonlar = [f for f in os.listdir(item_yolu) if f.endswith('.json')]\n                if alt_jsonlar:\n                    alt_klasor_jsonlar[item] = alt_jsonlar\n        \n        # Ana klasÃ¶rdeki JSON'larÄ± iÅŸle\n        if ana_jsonlar:\n            birlestirilmis_veri[hedef_klasor] = {}\n            for json_dosya in ana_jsonlar:\n                dosya_yolu = os.path.join(klasor_yolu, json_dosya)\n                try:\n                    with open(dosya_yolu, 'r', encoding='utf-8') as f:\n                        veri = json.load(f)\n                    \n                    dosya_adi_uzantisiz = os.path.splitext(json_dosya)[0]\n                    birlestirilmis_veri[hedef_klasor][dosya_adi_uzantisiz] = veri\n                    toplam_dosya_sayisi += 1\n                    print(f\"   âœ… {json_dosya}\")\n                    \n                except Exception as e:\n                    print(f\"   âŒ {json_dosya} - Hata: {e}\")\n        \n        # Alt klasÃ¶rlerdeki JSON'larÄ± iÅŸle\n        for alt_klasor, json_listesi in alt_klasor_jsonlar.items():\n            alt_klasor_anahtari = f\"{hedef_klasor}/{alt_klasor}\"\n            birlestirilmis_veri[alt_klasor_anahtari] = {}\n            \n            for json_dosya in json_listesi:\n                dosya_yolu = os.path.join(klasor_yolu, alt_klasor, json_dosya)\n                try:\n                    with open(dosya_yolu, 'r', encoding='utf-8') as f:\n                        veri = json.load(f)\n                    \n                    dosya_adi_uzantisiz = os.path.splitext(json_dosya)[0]\n                    birlestirilmis_veri[alt_klasor_anahtari][dosya_adi_uzantisiz] = veri\n                    toplam_dosya_sayisi += 1\n                    print(f\"   âœ… {alt_klasor}/{json_dosya}\")\n                    \n                except Exception as e:\n                    print(f\"   âŒ {alt_klasor}/{json_dosya} - Hata: {e}\")\n    \n    # BirleÅŸtirilmiÅŸ veriyi kaydet\n    with open(cikti_dosyasi, 'w', encoding='utf-8') as f:\n        json.dump(birlestirilmis_veri, f, ensure_ascii=False, indent=2, sort_keys=False)\n    \n    print(f\"\\nğŸ‰ BÄ°RLEÅTÄ°RME TAMAMLANDI!\")\n    print(\"=\" * 50)\n    print(f\"ğŸ“„ Ã‡Ä±ktÄ± dosyasÄ±: {cikti_dosyasi}\")\n    print(f\"ğŸ“ Ä°ÅŸlenen klasÃ¶r: {len(hedef_klasorler)}\")\n    print(f\"ğŸ“Š Toplam JSON dosyasÄ±: {toplam_dosya_sayisi}\")\n    \n    return birlestirilmis_veri\n\ndef detayli_rapor_olustur(birlestirilmis_veri):\n    \"\"\"DetaylÄ± klasÃ¶r ve dosya raporu oluÅŸturur\"\"\"\n    print(\"\\nğŸ“Š DETAYLI RAPOR:\")\n    print(\"=\" * 60)\n    \n    for klasor_yolu, dosyalar in birlestirilmis_veri.items():\n        if '/' in klasor_yolu:\n            ana_klasor, alt_klasor = klasor_yolu.split('/', 1)\n            print(f\"ğŸ“‚ {ana_klasor}/\")\n            print(f\"   â””â”€â”€ ğŸ“ {alt_klasor}/ â†’ {len(dosyalar)} dosya\")\n            for dosya_adi in dosyalar.keys():\n                print(f\"        â””â”€â”€ ğŸ“„ {dosya_adi}.json\")\n        else:\n            print(f\"ğŸ“‚ {klasor_yolu}/ â†’ {len(dosyalar)} dosya\")\n            for dosya_adi in dosyalar.keys():\n                print(f\"   â””â”€â”€ ğŸ“„ {dosya_adi}.json\")\n\ndef json_yapisi_incele(birlestirilmis_veri, ornek_sayisi=2):\n    \"\"\"JSON dosyalarÄ±nÄ±n yapÄ±sÄ±nÄ± inceler\"\"\"\n    print(f\"\\nğŸ” JSON YAPI Ä°NCELEMESÄ° (Ä°lk {ornek_sayisi} Ã¶rnek):\")\n    print(\"=\" * 60)\n    \n    sayac = 0\n    for klasor_yolu, dosyalar in birlestirilmis_veri.items():\n        for dosya_adi, icerik in dosyalar.items():\n            if sayac < ornek_sayisi:\n                print(f\"\\nğŸ“ Konum: {klasor_yolu}/{dosya_adi}.json\")\n                \n                if isinstance(icerik, dict):\n                    print(f\"   ğŸ“‹ SÃ¶zlÃ¼k yapÄ±sÄ± ({len(icerik)} anahtar)\")\n                    \n                    # Ä°lk 3 anahtarÄ± gÃ¶ster\n                    for i, (anahtar, deger) in enumerate(list(icerik.items())[:3]):\n                        if isinstance(deger, (str, int, float, bool)) or deger is None:\n                            deger_goruntu = str(deger)[:30] + \"...\" if len(str(deger)) > 30 else str(deger)\n                            print(f\"      â€¢ '{anahtar}': {deger_goruntu}\")\n                        elif isinstance(deger, list):\n                            print(f\"      â€¢ '{anahtar}': Liste[{len(deger)} Ã¶ÄŸe]\")\n                        elif isinstance(deger, dict):\n                            print(f\"      â€¢ '{anahtar}': SÃ¶zlÃ¼k[{len(deger)} anahtar]\")\n                        else:\n                            print(f\"      â€¢ '{anahtar}': {type(deger).__name__}\")\n                \n                elif isinstance(icerik, list):\n                    print(f\"   ğŸ“‹ Liste yapÄ±sÄ± ({len(icerik)} Ã¶ÄŸe)\")\n                    if icerik and len(icerik) > 0:\n                        ilk_oge = icerik[0]\n                        print(f\"      â€¢ Ä°lk Ã¶ÄŸe: {type(ilk_oge).__name__}\")\n                \n                print(\"   \" + \"â”€\" * 40)\n                sayac += 1\n\n# Ana Ã§alÄ±ÅŸtÄ±rma fonksiyonu\nif __name__ == \"__main__\":\n    print(\"ğŸš€ HEDEF JSON BÄ°RLEÅTÄ°RÄ°CÄ° BAÅLATILIYOR...\")\n    print(\"ğŸ¯ Ä°ÅŸlenecek klasÃ¶rler: data, ana_kategoriler, fiyat_listeleri, genel_diyalog, config\")\n    print(\"=\" * 70)\n    \n    try:\n        # BirleÅŸtirme iÅŸlemini baÅŸlat\n        birlestirilmis_veri = hedef_json_dosyalarini_birlestir()\n        \n        # DetaylÄ± rapor oluÅŸtur\n        detayli_rapor_olustur(birlestirilmis_veri)\n        \n        # JSON yapÄ±sÄ±nÄ± incele\n        json_yapisi_incele(birlestirilmis_veri)\n        \n        print(f\"\\nâœ… TÃ¼m iÅŸlemler baÅŸarÄ±yla tamamlandÄ±!\")\n        print(f\"ğŸ“ 'tumjsondosyalari.json' dosyasÄ± oluÅŸturuldu.\")\n        \n    except Exception as e:\n        print(f\"âŒ Beklenmeyen hata: {e}\")","size_bytes":7101},"micro-modules/session/stopAllTimers.js":{"content":"","size_bytes":0},"micro-modules/menu/showCategoryOptions.js":{"content":"// micro-modules/menu/showCategoryOptions.js\nasync function showCategoryOptions(message, category, services) {\n  const categoryData = category.data;\n  let optionsText = `ğŸ¯ *${categoryData.bot_greeting}*\\n\\n`;\n  \n  if (categoryData.category_options) {\n    categoryData.category_options.forEach(option => {\n      optionsText += `${option.option_number}. ${option.category_name}\\n`;\n    });\n  }\n  \n  optionsText += `\\n${categoryData.completion_message || 'LÃ¼tfen bir numara seÃ§in:'}`;\n  \n  await message.reply(optionsText);\n}\n\nmodule.exports = showCategoryOptions;","size_bytes":566},"micro-modules/utils/isGreeting.js":{"content":"// micro-modules/utils/isGreeting.js\nfunction isGreeting(message) {\n  const greetings = [\n    'merhaba', 'selam', 'hi', 'hello', 'hey', \n    'gÃ¼naydÄ±n', 'iyi gÃ¼nler', 'iyi akÅŸamlar', \n    'naber', 'slm', 'sa', 'selamun aleykÃ¼m',\n    'aleykÃ¼m selam', 'merhabalar', 'selamlar'\n  ];\n  return greetings.some(greet => message.toLowerCase().includes(greet));\n}\n\nmodule.exports = isGreeting;","size_bytes":390},"modules/sessionManager.js":{"content":"const logger = require('./logger');\n\n// KullanÄ±cÄ± oturumlarÄ±nÄ± takip etmek iÃ§in\nconst userSessions = new Map();\n\n// KullanÄ±cÄ± oturumu oluÅŸtur - GÃœNCELLENDÄ°\nfunction createUserSession(userId) {\n  const session = {\n    userId: userId,\n    lastActivity: Date.now(),\n    waitingForResponse: false,\n    waitingForHelp: false,\n    menuTimer: null,\n    saleTimer: null,\n    helpTimer: null,\n    goodbyeTimer: null,\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: null,\n    menuHistory: []\n  };\n  \n  userSessions.set(userId, session);\n  console.log(`ğŸ†• Yeni oturum oluÅŸturuldu: ${userId}`);\n  return session;\n}\n\n// KullanÄ±cÄ± oturumunu gÃ¼ncelle - GÃœNCELLENDÄ°\nfunction updateUserSession(userId, updates) {\n  const session = getUserSession(userId);\n  Object.assign(session, updates);\n  session.lastActivity = Date.now();\n  userSessions.set(userId, session);\n  \n  console.log(`ğŸ“ Oturum gÃ¼ncellendi: ${userId}, Durum: ${session.currentState}`);\n  return session;\n}\n\n// Oturumu getir - GÃœNCELLENDÄ°\nfunction getUserSession(userId) {\n  let session = userSessions.get(userId);\n  if (!session) {\n    console.log(`ğŸ†• Oturum bulunamadÄ±, yeni oluÅŸturuluyor: ${userId}`);\n    session = createUserSession(userId);\n  }\n  return session;\n}\n\n// YardÄ±m timer'Ä± baÅŸlat - GÃœNCELLENDÄ°\nfunction startHelpTimer(userId, message, services) {\n  const session = getUserSession(userId);\n  if (session && session.helpTimer) {\n    clearTimeout(session.helpTimer);\n  }\n  if (session && session.goodbyeTimer) {\n    clearTimeout(session.goodbyeTimer);\n  }\n\n  console.log(`â° YardÄ±m timer baÅŸlatÄ±ldÄ± - KullanÄ±cÄ±: ${userId}`);\n\n  // 1. Timer: 3 dakika sonra menÃ¼yÃ¼ gÃ¶ster\n  const helpTimer = setTimeout(async () => {\n    const currentSession = getUserSession(userId);\n    if (currentSession && currentSession.waitingForHelp) {\n      console.log(`â° YardÄ±m zaman aÅŸÄ±mÄ± - MenÃ¼ gÃ¶steriliyor: ${userId}`);\n      \n      const menuHandler = require('./menuHandler');\n      await menuHandler.showMainMenu(message, services);\n      \n      // 2. Timer: 3 dakika sonra vedalaÅŸma\n      const goodbyeTimer = setTimeout(async () => {\n        await handleGoodbye(message);\n      }, 3 * 60 * 1000); // 3 dakika\n      \n      updateUserSession(userId, { \n        waitingForHelp: false, \n        helpTimer: null,\n        goodbyeTimer: goodbyeTimer\n      });\n    }\n  }, 3 * 60 * 1000); // 3 dakika\n\n  updateUserSession(userId, { \n    waitingForHelp: true, \n    helpTimer: helpTimer\n  });\n}\n\n// VedalaÅŸma iÅŸlemi - GÃœNCELLENDÄ°\nasync function handleGoodbye(message) {\n  const serviceLoader = require('./serviceLoader');\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const goodbyeMsg = greetings?.vedalasma?.hoscakal?.[0] || \n                    'HoÅŸÃ§a kalÄ±n! PlanB Global Network Ltd Åti adÄ±na iyi gÃ¼nler dilerim.';\n  \n  await message.reply(goodbyeMsg);\n  \n  console.log(`ğŸ‘‹ VedalaÅŸma mesajÄ± gÃ¶nderildi - KullanÄ±cÄ±: ${message.from}`);\n  \n  // Oturumu temizle\n  updateUserSession(message.from, {\n    currentState: 'main_menu',\n    waitingForHelp: false,\n    helpTimer: null,\n    goodbyeTimer: null\n  });\n}\n\n// YardÄ±m timer'Ä±nÄ± durdur (kullanÄ±cÄ± cevap verdiÄŸinde) - GÃœNCELLENDÄ°\nfunction stopHelpTimer(userId) {\n  const session = getUserSession(userId);\n  if (session) {\n    if (session.helpTimer) {\n      clearTimeout(session.helpTimer);\n      console.log(`â° YardÄ±m timer durduruldu - KullanÄ±cÄ±: ${userId}`);\n    }\n    if (session.goodbyeTimer) {\n      clearTimeout(session.goodbyeTimer);\n      console.log(`â° VedalaÅŸma timer durduruldu - KullanÄ±cÄ±: ${userId}`);\n    }\n    updateUserSession(userId, { \n      waitingForHelp: false, \n      helpTimer: null,\n      goodbyeTimer: null\n    });\n  }\n}\n\n// MenÃ¼ zamanlayÄ±cÄ± baÅŸlat - GÃœNCELLENDÄ°\nfunction startMenuTimer(userId, message, services) {\n  const session = getUserSession(userId);\n  if (session && session.menuTimer) {\n    clearTimeout(session.menuTimer);\n  }\n\n  const timer = setTimeout(async () => {\n    const currentSession = getUserSession(userId);\n    if (currentSession && currentSession.waitingForResponse) {\n      console.log(`â° MenÃ¼ zaman aÅŸÄ±mÄ± - KullanÄ±cÄ±: ${userId}`);\n      const menuHandler = require('./menuHandler');\n      await menuHandler.showMainMenu(message, services);\n      updateUserSession(userId, { \n        waitingForResponse: false, \n        menuTimer: null,\n        currentState: 'main_menu'\n      });\n    }\n  }, 60000);\n\n  updateUserSession(userId, { \n    waitingForResponse: true, \n    menuTimer: timer,\n    currentState: 'waiting_for_service'\n  });\n}\n\n// MenÃ¼ zamanlayÄ±cÄ±yÄ± durdur - GÃœNCELLENDÄ°\nfunction stopMenuTimer(userId) {\n  const session = getUserSession(userId);\n  if (session && session.menuTimer) {\n    clearTimeout(session.menuTimer);\n    updateUserSession(userId, { \n      waitingForResponse: false, \n      menuTimer: null\n    });\n    console.log(`â° MenÃ¼ timer durduruldu - KullanÄ±cÄ±: ${userId}`);\n  }\n}\n\n// SatÄ±ÅŸ zamanlayÄ±cÄ±sÄ±nÄ± temizle - GÃœNCELLENDÄ°\nfunction clearSaleTimer(userId) {\n  const session = getUserSession(userId);\n  if (session && session.saleTimer) {\n    clearTimeout(session.saleTimer);\n    updateUserSession(userId, { saleTimer: null });\n    console.log(`â° SatÄ±ÅŸ timer temizlendi - KullanÄ±cÄ±: ${userId}`);\n  }\n}\n\n// TÃ¼m oturumlarÄ± temizle (debug iÃ§in)\nfunction clearAllSessions() {\n  const count = userSessions.size;\n  userSessions.clear();\n  console.log(`ğŸ§¹ ${count} oturum temizlendi`);\n}\n\n// Aktif oturumlarÄ± listele (debug iÃ§in)\nfunction listActiveSessions() {\n  console.log(`ğŸ“Š Aktif oturumlar: ${userSessions.size}`);\n  userSessions.forEach((session, userId) => {\n    console.log(`  ğŸ‘¤ ${userId}: ${session.currentState}`);\n  });\n}\n\nmodule.exports = {\n  createUserSession,\n  updateUserSession,\n  getUserSession,\n  startMenuTimer,\n  stopMenuTimer,\n  clearSaleTimer,\n  startHelpTimer,\n  stopHelpTimer,\n  handleGoodbye,\n  userSessions,\n  clearAllSessions,\n  listActiveSessions\n};","size_bytes":6109},"micro-modules/menu/handleSubMenuSelection.js":{"content":"// micro-modules/menu/handleSubMenuSelection.js\nconst sessionManager = require('../../core/sessionManager');\nconst convertToServiceKey = require('./convertToServiceKey');\nconst startServiceFlow = require('../service/startServiceFlow');\nconst showMainMenu = require('./showMainMenu');\n\nasync function handleSubMenuSelection(message, number, categoryName, services) {\n  console.log(`ğŸ¯ Alt menÃ¼ seÃ§imi: Kategori: ${categoryName}, SayÄ±: ${number}`);\n  \n  const categoryData = services[categoryName];\n  \n  if (!categoryData || !categoryData.category_options) {\n    await message.reply('âŒ Alt menÃ¼ bulunamadÄ±. Ana menÃ¼ye dÃ¶nÃ¼lÃ¼yor.');\n    sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n    await showMainMenu(message, services);\n    return;\n  }\n\n  const selectedOption = categoryData.category_options.find(opt => opt.option_number === number);\n  \n  if (selectedOption) {\n    console.log(`âœ… Alt menÃ¼ seÃ§ildi: ${selectedOption.category_name}`);\n    \n    const serviceKey = convertToServiceKey(selectedOption.category_name);\n    let foundService = null;\n\n    console.log(`ğŸ” Servis aranÄ±yor: ${serviceKey}`);\n\n    for (const [dataCategory, dataServices] of Object.entries(services)) {\n      if (typeof dataServices === 'object' && dataServices[serviceKey]) {\n        foundService = {\n          type: 'service',\n          data: dataServices[serviceKey],\n          category: dataCategory,\n          name: serviceKey\n        };\n        console.log(`âœ… Servis bulundu: ${dataCategory}/${serviceKey}`);\n        break;\n      }\n    }\n\n    if (foundService) {\n      console.log(`ğŸš€ Servis baÅŸlatÄ±lÄ±yor: ${foundService.name}`);\n      await startServiceFlow(message, foundService);\n    } else {\n      console.log(`âŒ Servis bulunamadÄ±: ${serviceKey}`);\n      await message.reply(`âœ… *${selectedOption.category_name}* seÃ§ildi!\\n\\n` +\n                         `Bu hizmetle ilgili detaylÄ± bilgi iÃ§in en kÄ±sa sÃ¼rede sizinle iletiÅŸime geÃ§eceÄŸiz.`);\n      sessionManager.updateUserSession(message.from, { currentState: 'main_menu' });\n      await showMainMenu(message, services);\n    }\n  } else {\n    await message.reply(`âŒ GeÃ§ersiz numara. LÃ¼tfen 1-${categoryData.category_options.length} arasÄ± bir numara girin.`);\n  }\n}\n\nmodule.exports = handleSubMenuSelection;","size_bytes":2314},"micro-modules/session/stopHelpTimer.js":{"content":"// micro-modules/session/stopHelpTimer.js\nconst logger = require('../../core/logger');\nconst sessionManager = require('../../core/sessionManager');\n\nfunction stopHelpTimer(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (session) {\n    if (session.helpTimer) {\n      clearTimeout(session.helpTimer);\n      logger.info(`â° YardÄ±m timer durduruldu - KullanÄ±cÄ±: ${userId}`);\n    }\n    if (session.goodbyeTimer) {\n      clearTimeout(session.goodbyeTimer);\n      logger.info(`â° VedalaÅŸma timer durduruldu - KullanÄ±cÄ±: ${userId}`);\n    }\n    sessionManager.updateUserSession(userId, { \n      waitingForHelp: false, \n      helpTimer: null,\n      goodbyeTimer: null\n    });\n  }\n}\n\nmodule.exports = stopHelpTimer;","size_bytes":737},"modules/messageHandler/messageParser.js":{"content":"// modules/messageHandler/messageParser.js\nconst logger = require('../logger');\n\nfunction parseMessage(messageBody) {\n  const cleanMessage = messageBody.toLowerCase().replace(/[.,!?]/g, '').trim();\n  \n  let greetingPart = '';\n  let servicePart = messageBody; // VarsayÄ±lan: tÃ¼m mesaj iÅŸlem kÄ±smÄ±\n  \n  const greetingWords = ['merhaba', 'selam', 'hi', 'hello', 'hey', 'gÃ¼naydÄ±n', 'iyi gÃ¼nler', 'iyi akÅŸamlar', 'naber', 'slm', 'sa'];\n  \n  // TÃ¼m mesajÄ± kontrol et, selamlama bulunursa ayÄ±r\n  for (const word of greetingWords) {\n    if (cleanMessage.includes(word)) {\n      const index = cleanMessage.indexOf(word);\n      greetingPart = messageBody.substring(0, index + word.length);\n      servicePart = messageBody.substring(index + word.length).trim();\n      break;\n    }\n  }\n  \n  console.log(`ğŸ“ Mesaj ayrÄ±ÅŸtÄ±rma: Orijinal=\"${messageBody}\", Selamlama=\"${greetingPart}\", Ä°ÅŸlem=\"${servicePart}\"`);\n  \n  return { \n    greetingPart, \n    servicePart, \n    cleanMessage: cleanMessage,\n    originalMessage: messageBody \n  };\n}\n\nfunction isGreeting(message) {\n  const greetings = [\n    'merhaba', 'selam', 'hi', 'hello', 'hey', \n    'gÃ¼naydÄ±n', 'iyi gÃ¼nler', 'iyi akÅŸamlar', \n    'naber', 'slm', 'sa', 'selamun aleykÃ¼m',\n    'aleykÃ¼m selam', 'merhabalar', 'selamlar',\n    'good morning', 'good afternoon', 'good evening'\n  ];\n  \n  const cleanMessage = message.toLowerCase().trim();\n  return greetings.some(greet => cleanMessage.includes(greet));\n}\n\nfunction isThanksMessage(message) {\n  const thanksWords = [\n    'teÅŸekkÃ¼r', 'tesekkÃ¼r', 'teÅŸekkÃ¼rler', 'tesekkurler', 'teÅŸekkÃ¼r ederim', 'tesekkur ederim',\n    'saÄŸol', 'sagol', 'saÄŸolun', 'sagolun', 'saÄŸ ol', 'sag ol',\n    'thank you', 'thanks', 'thx', 'ty', 'thank u',\n    'eyvallah', 'mersi', 'Ã§ok teÅŸekkÃ¼r', 'cok tesekkur', 'teÅŸekkÃ¼rler Ã§ok', 'tÅŸk',\n    'teÅŸekkÃ¼r ederiz', 'tesekkur ederiz', 'minnettarÄ±m', 'minnettarim'\n  ];\n  \n  const cleanMessage = message.toLowerCase().trim();\n  return thanksWords.some(word => cleanMessage.includes(word));\n}\n\nfunction isGoodbyeMessage(message) {\n  const goodbyeWords = [\n    'gÃ¼le gÃ¼le', 'gule gule', 'hoÅŸÃ§a kal', 'hoscakal', 'hoÅŸÃ§akal', 'hoscakal', \n    'allaha Ä±smarladÄ±k', 'allaha Ä±smarladik', 'bay bay', 'bye bye', 'bye',\n    'gÃ¶rÃ¼ÅŸÃ¼rÃ¼z', 'gorusuruz', 'gÃ¶rÃ¼ÅŸmek Ã¼zere', 'gorusmek uzere',\n    'kendine iyi bak', 'kendine iyi bak', 'iyi gÃ¼nler', 'iyi gunler',\n    'iyi akÅŸamlar', 'iyi aksamlar', 'iyi geceler', 'iyi geceler'\n  ];\n  \n  const cleanMessage = message.toLowerCase().trim();\n  return goodbyeWords.some(word => cleanMessage.includes(word));\n}\n\nfunction isNumberInput(message) {\n  return /^\\d+$/.test(message.trim());\n}\n\nfunction isMenuRequest(message) {\n  const menuWords = ['menÃ¼', 'menu', 'list', 'liste', 'seÃ§enek', 'secenek', 'options'];\n  const cleanMessage = message.toLowerCase().trim();\n  return menuWords.some(word => cleanMessage.includes(word));\n}\n\nfunction hasMedia(message) {\n  return message.hasMedia;\n}\n\nfunction extractServiceKeywords(message) {\n  const cleanMessage = message.toLowerCase().replace(/[.,!?]/g, '').trim();\n  const keywords = [\n    'sigorta', 'yazÄ±lÄ±m', 'siber', 'gÃ¼venlik', 'lojistik', 'nakliye',\n    'ithalat', 'ihracat', 'denetim', 'emlak', 'inÅŸaat', 'crm',\n    'tekstil', 'kozmetik', 'tur', 'gÃ¼neÅŸ', 'enerji', 'kurumsal',\n    'danÄ±ÅŸmanlÄ±k', 'yazilim', 'saglik', 'seyahat', 'kasko', 'dask',\n    'konut', 'isyeri', 'mobil', 'uygulama', 'gÃ¼mrÃ¼k', 'depo',\n    'antrepo', 'parfÃ¼m', 'deodorant', 'ges', 'finansal', 'eÄŸitim',\n    'diÄŸer', 'diger', 'hizmet', 'servis', 'service'\n  ];\n  \n  return keywords.filter(keyword => cleanMessage.includes(keyword));\n}\n\nfunction isHelpRequest(message) {\n  const helpWords = ['yardÄ±m', 'yardim', 'help', 'nasÄ±l', 'nasil', 'ne yapabilir', 'yapabilir'];\n  const cleanMessage = message.toLowerCase().trim();\n  return helpWords.some(word => cleanMessage.includes(word));\n}\n\nfunction isCancelRequest(message) {\n  const cancelWords = ['iptal', 'cancel', 'dur', 'stop', 'vazgeÃ§', 'vazgec'];\n  const cleanMessage = message.toLowerCase().trim();\n  return cancelWords.some(word => cleanMessage.includes(word));\n}\n\nfunction isOtherServicesRequest(message) {\n  const otherServiceWords = ['diÄŸer', 'diger', 'baÅŸka', 'baska', 'farklÄ±', 'farkli', 'Ã¶teki', 'oteki'];\n  const serviceWords = ['hizmet', 'servis', 'service', 'seÃ§enek', 'secenek'];\n  \n  const cleanMessage = message.toLowerCase().trim();\n  \n  const hasOtherWord = otherServiceWords.some(word => cleanMessage.includes(word));\n  const hasServiceWord = serviceWords.some(word => cleanMessage.includes(word));\n  \n  return hasOtherWord && hasServiceWord;\n}\n\nfunction getMessageType(message) {\n  const cleanMessage = message.toLowerCase().trim();\n  \n  if (isGreeting(cleanMessage)) return 'greeting';\n  if (isNumberInput(cleanMessage)) return 'number';\n  if (isMenuRequest(cleanMessage)) return 'menu';\n  if (isHelpRequest(cleanMessage)) return 'help';\n  if (isCancelRequest(cleanMessage)) return 'cancel';\n  if (isThanksMessage(cleanMessage)) return 'thanks';\n  if (isGoodbyeMessage(cleanMessage)) return 'goodbye';\n  if (isOtherServicesRequest(cleanMessage)) return 'other_services';\n  \n  const keywords = extractServiceKeywords(cleanMessage);\n  if (keywords.length > 0) return 'service_request';\n  \n  return 'unknown';\n}\n\nmodule.exports = {\n  parseMessage,\n  isGreeting,\n  isThanksMessage,\n  isGoodbyeMessage,\n  isNumberInput,\n  isMenuRequest,\n  hasMedia,\n  extractServiceKeywords,\n  isHelpRequest,\n  isCancelRequest,\n  isOtherServicesRequest,\n  getMessageType\n};","size_bytes":5558},"micro-modules/menu/convertToServiceKey.js":{"content":"// micro-modules/menu/convertToServiceKey.js\nfunction convertToServiceKey(categoryName) {\n  const conversions = {\n    'YeÅŸil Sigorta': 'yesil_sigorta',\n    'Trafik SigortasÄ±': 'trafik_sigortasi',\n    'KASKO': 'kasko',\n    'Koltuk SigortasÄ±': 'koltuk_sigortasi',\n    'DASK': 'dask',\n    'Konut SigortasÄ±': 'konut_sigortasi',\n    'Ä°ÅŸyeri SigortasÄ±': 'isyeri_sigortasi',\n    'Seyahat SaÄŸlÄ±k SigortasÄ±': 'seyahat_saglik_sigortasi',\n    'TamamlayÄ±cÄ± SaÄŸlÄ±k SigortasÄ±': 'tamamlayici_saglik_sigortasi',\n    'Ã–zel SaÄŸlÄ±k SigortasÄ±': 'ozel_saglik_sigortasi',\n    \n    'Ã–zel YazÄ±lÄ±m GeliÅŸtirme': 'ozel_yazilim_gelistirme',\n    'Mobil Uygulama GeliÅŸtirme': 'mobil_uygulama_gelistirme',\n    \n    'YurtiÃ§i YÃ¼k Nakli': 'yurtici_yuk_nakli',\n    'YurtdÄ±ÅŸÄ± YÃ¼k Nakli': 'yurtdisi_yuk_nakli',\n    'Depo/Antrepo Hizmeti': 'depo_antrepo_hizmeti',\n    \n    'YurtdÄ±ÅŸÄ± MÃ¼ÅŸteri AraÅŸtÄ±rma': 'yurtdisi_musteri_arastirma',\n    'YurtiÃ§i TedarikÃ§i AraÅŸtÄ±rma': 'yurtici_tedarikci_arastirma',\n    'GÃ¼mrÃ¼k Operasyon Hizmetleri': 'gumruk_operasyon_hizmetleri',\n    'YurtiÃ§i ÃœrÃ¼n AraÅŸtÄ±rma': 'yurtici_urun_arastirma',\n    'YurtdÄ±ÅŸÄ± Pazar AraÅŸtÄ±rma': 'yurtdisi_pazar_arastirma',\n    \n    'Genel AÄŸ GÃ¼venliÄŸi': 'genel_ag_guvenligi',\n    'KullanÄ±cÄ± GÃ¼venliÄŸi': 'kullanici_guvenligi',\n    'Veri GÃ¼venliÄŸi': 'veri_guvenligi',\n    'Uygulama GÃ¼venliÄŸi': 'uygulama_guvenligi',\n    'Kimlik ve EriÅŸim YÃ¶netimi': 'kimlik_erisim_yonetimi',\n    'GÃ¼venlik YÃ¶netimi': 'guvenlik_yonetimi',\n    'Penetrasyon Test Talebi': 'penetrasyon_test_talebi',\n    'EÄŸitim Talepleri': 'egitim_talepleri',\n    \n    'SatÄ±lÄ±k Gayrimenkul': 'satilik_gayrimenkul',\n    'KiralÄ±k Gayrimenkul': 'kiralik_gayrimenkul',\n    'YurtdÄ±ÅŸÄ± Gayrimenkul YatÄ±rÄ±m': 'yurtdisi_gayrimenkul_yatirim',\n    'Ä°nÅŸaat TaahhÃ¼t Hizmeti': 'insaat_taahhut_hizmeti',\n    \n    'MÃ¼ÅŸteri SeÃ§imi': 'musteri_secimi',\n    'MÃ¼ÅŸteri Edinme': 'musteri_edinme',\n    'MÃ¼ÅŸteri Koruma': 'musteri_koruma',\n    'MÃ¼ÅŸteri DerinleÅŸtirme': 'musteri_derinlestirme',\n    \n    'Erkek Giyim': 'erkek_giyim',\n    'KadÄ±n Giyim': 'kadin_giyim',\n    'Ev Tekstil ÃœrÃ¼nleri': 'ev_tekstil_urunleri',\n    \n    'ParfÃ¼m': 'parfum',\n    'Deodorant': 'deodorant',\n    'KiÅŸisel BakÄ±m': 'kisisel_bakim',\n    'Medikal Kozmetik': 'medikal_kozmetik',\n    \n    'YurtiÃ§i Ã–zel Gezi Talebi': 'yurtici_ozel_gezi_talebi',\n    'YurtdÄ±ÅŸÄ± Ã–zel Gezi Talebi': 'yurtdisi_ozel_gezi_talebi',\n    'Personel Servis Talebi': 'personel_servis_talebi',\n    \n    'GÃ¼neÅŸ Verimlilik HesabÄ±': 'gunes_verimlilik_hesabi',\n    'GES Ãœretim Hesaplama': 'ges_uretim_hesaplama',\n    'GES Kurulum Hesaplama': 'ges_kurulum_hesaplama',\n    \n    'Ä°nsan KaynaklarÄ± DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'insan_kaynaklari_danismanligi',\n    'Stratejik Planlama DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'stratejik_planlama_danismanligi',\n    'Finansal DanÄ±ÅŸmanlÄ±k': 'finansal_danismanlik',\n    'Operasyonel Ä°yileÅŸtirme': 'operasyonel_iyilestirme',\n    'Kurumsal Ä°letiÅŸim DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'kurumsal_iletisim_danismanligi',\n    'Yasal DanÄ±ÅŸmanlÄ±k': 'yasal_danismanlik',\n    'Teknoloji DanÄ±ÅŸmanlÄ±ÄŸÄ±': 'teknoloji_danismanligi',\n    'Kurumsal EÄŸitim Hizmetleri': 'kurumsal_egitim_hizmetleri'\n  };\n\n  return conversions[categoryName] || categoryName.toLowerCase().replace(/ /g, '_').replace(/[Ä±Ä°]/g, 'i').replace(/[ÅŸÅ]/g, 's').replace(/[ÄŸÄ]/g, 'g').replace(/[Ã¼Ãœ]/g, 'u').replace(/[Ã§Ã‡]/g, 'c').replace(/[Ã¶Ã–]/g, 'o');\n}\n\nmodule.exports = convertToServiceKey;","size_bytes":3475},"micro-modules/utils/findMatchingService.js":{"content":"// micro-modules/utils/findMatchingService.js\nfunction findMatchingService(message, services) {\n  const cleanMessage = message.toLowerCase().replace(/[.,!?]/g, '').trim();\n  \n  console.log(`ğŸ” Mesaj aranÄ±yor: \"${cleanMessage}\"`);\n\n  // FÄ°YAT SORGULARI\n  const priceQueries = {\n    'yeÅŸil sigorta fiyat': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta fiyat': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatÄ±': 'yesil_sigorta_fiyatlari', \n    'yesil sigorta fiyati': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta ne kadar': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta ne kadar': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta Ã¼creti': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta ucreti': 'yesil_sigorta_fiyatlari',\n    'yeÅŸil sigorta fiyatlarÄ±': 'yesil_sigorta_fiyatlari',\n    'yesil sigorta fiyatlari': 'yesil_sigorta_fiyatlari'\n  };\n\n  for (const [priceQuery, serviceKey] of Object.entries(priceQueries)) {\n    if (cleanMessage.includes(priceQuery)) {\n      console.log(`ğŸ’° Fiyat sorgusu eÅŸleÅŸti: \"${priceQuery}\" -> ${serviceKey}`);\n      \n      if (services['fiyat_listeleri'] && services['fiyat_listeleri'][serviceKey]) {\n        return { \n          type: 'service', \n          data: services['fiyat_listeleri'][serviceKey], \n          category: 'fiyat_listeleri', \n          name: serviceKey \n        };\n      }\n    }\n  }\n\n  // NORMAL SERVÄ°SLER\n  const exactMatches = {\n    'yeÅŸil sigorta': 'yesil_sigorta',\n    'yesil sigorta': 'yesil_sigorta',\n    'trafik sigortasÄ±': 'trafik_sigortasi',\n    'trafik sigortasi': 'trafik_sigortasi',\n    'kasko sigortasÄ±': 'kasko',\n    'kasko sigortasi': 'kasko',\n    'konut sigortasÄ±': 'konut_sigortasi',\n    'konut sigortasi': 'konut_sigortasi',\n    'dask sigortasÄ±': 'dask',\n    'dask sigortasi': 'dask',\n    'koltuk sigortasÄ±': 'koltuk_sigortasi',\n    'koltuk sigortasi': 'koltuk_sigortasi',\n    'seyahat sigortasÄ±': 'seyahat_saglik_sigortasi',\n    'seyahat sigortasi': 'seyahat_saglik_sigortasi',\n    'saÄŸlÄ±k sigortasÄ±': 'ozel_saglik_sigortasi',\n    'saglik sigortasi': 'ozel_saglik_sigortasi',\n    'tamamlayÄ±cÄ± saÄŸlÄ±k sigortasÄ±': 'tamamlayici_saglik_sigortasi',\n    'tamamlayici saglik sigortasi': 'tamamlayici_saglik_sigortasi',\n    'iÅŸyeri sigortasÄ±': 'isyeri_sigortasi',\n    'isyeri sigortasi': 'isyeri_sigortasi'\n  };\n\n  for (const [exactPhrase, serviceKey] of Object.entries(exactMatches)) {\n    if (cleanMessage.includes(exactPhrase.toLowerCase())) {\n      console.log(`âœ… Tam ifade eÅŸleÅŸti: \"${exactPhrase}\" -> ${serviceKey}`);\n      \n      for (const [categoryName, categoryServices] of Object.entries(services)) {\n        if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n          return { \n            type: 'service', \n            data: categoryServices[serviceKey], \n            category: categoryName, \n            name: serviceKey \n          };\n        }\n      }\n    }\n  }\n\n  // ANAHTAR KELÄ°MELER\n  const keywordMatches = {\n    'sigorta': 'sigorta_ana_kategori',\n    'trafik': 'trafik_sigortasi', \n    'kasko': 'kasko',\n    'dask': 'dask',\n    'konut': 'konut_sigortasi',\n    'yeÅŸil': 'yesil_sigorta',\n    'yesil': 'yesil_sigorta',\n    'koltuk': 'koltuk_sigortasi',\n    'seyahat': 'seyahat_saglik_sigortasi',\n    'saÄŸlÄ±k': 'ozel_saglik_sigortasi',\n    'saglik': 'ozel_saglik_sigortasi',\n    'tamamlayÄ±cÄ±': 'tamamlayici_saglik_sigortasi',\n    'tamamlayici': 'tamamlayici_saglik_sigortasi',\n    'iÅŸyeri': 'isyeri_sigortasi',\n    'isyeri': 'isyeri_sigortasi',\n    \n    'yazÄ±lÄ±m': 'yazilim_talepleri_ana_kategori',\n    'yazilim': 'yazilim_talepleri_ana_kategori',\n    'mobil': 'mobil_uygulama_gelistirme',\n    'uygulama': 'mobil_uygulama_gelistirme',\n    \n    'lojistik': 'lojistik_hizmetleri_ana',\n    'nakliye': 'lojistik_hizmetleri_ana',\n    'yÃ¼k': 'lojistik_hizmetleri_ana',\n    'depo': 'depo_antrepo_hizmeti',\n    'antrepo': 'depo_antrepo_hizmeti',\n    \n    'ithalat': 'ithalat_ihracat_ana',\n    'ihracat': 'ithalat_ihracat_ana',\n    'gÃ¼mrÃ¼k': 'gumruk_operasyon_hizmetleri',\n    \n    'siber': 'siber_guvenlik_ana',\n    'gÃ¼venlik': 'siber_guvenlik_ana',\n    'emlak': 'insaat_emlak_ana',\n    'crm': 'crm_hizmetleri_ana',\n    'tekstil': 'tekstil_urunleri_ana',\n    'kozmetik': 'kozmetik_urunleri_ana',\n    'tur': 'tur_organizasyon_ana',\n    'gÃ¼neÅŸ': 'gunes_enerjisi_sistemleri_ana',\n    'kurumsal': 'kurumsal_hizmetler_ana'\n  };\n\n  for (const [keyword, serviceKey] of Object.entries(keywordMatches)) {\n    if (cleanMessage.includes(keyword)) {\n      console.log(`âœ… Anahtar kelime eÅŸleÅŸti: \"${keyword}\" -> ${serviceKey}`);\n      \n      if (serviceKey.includes('_ana') || serviceKey.includes('_kategori')) {\n        const categoryData = services[serviceKey];\n        if (categoryData) {\n          return { type: 'category', data: categoryData, name: serviceKey };\n        }\n      } else {\n        for (const [categoryName, categoryServices] of Object.entries(services)) {\n          if (typeof categoryServices === 'object' && categoryServices[serviceKey]) {\n            return { \n              type: 'service', \n              data: categoryServices[serviceKey], \n              category: categoryName, \n              name: serviceKey \n            };\n          }\n        }\n      }\n    }\n  }\n\n  console.log('âŒ EÅŸleÅŸme bulunamadÄ±');\n  return null;\n}\n\nmodule.exports = findMatchingService;","size_bytes":5332},"micro-modules/message/endConversation.js":{"content":"// micro-modules/message/endConversation.js\nconst sessionManager = require('../../core/sessionManager');\nconst serviceLoader = require('../../core/serviceLoader');\nconst showMainMenu = require('../menu/showMainMenu');\n\nasync function endConversation(message) {\n  sessionManager.updateUserSession(message.from, {\n    currentState: 'main_menu',\n    currentService: null,\n    currentQuestions: [],\n    currentQuestionIndex: 0,\n    collectedAnswers: {},\n    serviceFlow: null,\n    saleTimer: null\n  });\n  \n  setTimeout(async () => {\n    await showMainMenu(message, serviceLoader.loadAllServices());\n  }, 3000);\n}\n\nmodule.exports = endConversation;","size_bytes":643},"micro-modules/service/saveServiceApplication.js":{"content":"// micro-modules/service/saveServiceApplication.js\nconst fs = require('fs');\nconst path = require('path');\nconst logger = require('../../core/logger');\n\nasync function saveServiceApplication(session) {\n  try {\n    const applicationData = {\n      service: session.serviceFlow,\n      answers: session.collectedAnswers,\n      timestamp: new Date().toISOString(),\n      userId: session.userId\n    };\n    \n    const applicationsDir = './applications';\n    if (!fs.existsSync(applicationsDir)) {\n      fs.mkdirSync(applicationsDir, { recursive: true });\n    }\n    \n    const filename = `application_${Date.now()}_${session.userId.replace('@c.us', '')}.json`;\n    fs.writeFileSync(\n      path.join(applicationsDir, filename),\n      JSON.stringify(applicationData, null, 2),\n      'utf8'\n    );\n    \n    logger.info(`BaÅŸvuru kaydedildi: ${filename}`);\n    console.log(`ğŸ“„ BaÅŸvuru kaydedildi: ${filename}`);\n    \n  } catch (error) {\n    logger.error(`BaÅŸvuru kaydetme hatasÄ±: ${error.message}`);\n    console.error('âŒ BaÅŸvuru kaydetme hatasÄ±:', error);\n  }\n}\n\nmodule.exports = saveServiceApplication;","size_bytes":1100},"docs/DEVELOPMENT.md":{"content":"","size_bytes":0},"modules/messageHandler/contactManager.js":{"content":"// modules/messageHandler/contactManager.js\nconst logger = require('../logger');\n\nasync function getContactInfo(message) {\n  try {\n    const contact = await message.getContact();\n    const contactName = contact.name || contact.pushname || '';\n    const phoneNumber = contact.id.user || '';\n    \n    console.log(`ğŸ‘¤ MÃ¼ÅŸteri bilgisi: ${contactName} (${phoneNumber})`);\n    \n    return {\n      name: contactName,\n      phone: phoneNumber,\n      isBusiness: contact.isBusiness || false,\n      isEnterprise: contact.isEnterprise || false\n    };\n  } catch (contactError) {\n    logger.error(`MÃ¼ÅŸteri bilgisi alÄ±namadÄ±: ${contactError.message}`);\n    console.log('âš ï¸  MÃ¼ÅŸteri bilgisi alÄ±namadÄ±:', contactError.message);\n    \n    return {\n      name: '',\n      phone: '',\n      isBusiness: false,\n      isEnterprise: false\n    };\n  }\n}\n\n// logContactInteraction fonksiyonunu ekliyoruz\nasync function logContactInteraction(message, action) {\n  const contactInfo = await getContactInfo(message);\n  \n  logger.info(`ğŸ“ ${action} - MÃ¼ÅŸteri: ${contactInfo.name} (${contactInfo.phone}) - Mesaj: \"${message.body}\"`);\n  \n  return contactInfo;\n}\n\nmodule.exports = {\n  getContactInfo,\n  logContactInteraction  // Bu fonksiyonu ekledik\n};","size_bytes":1237},"micro-modules/session/clearSaleTimer.js":{"content":"// micro-modules/session/clearSaleTimer.js\nconst sessionManager = require('../../core/sessionManager');\n\nfunction clearSaleTimer(userId) {\n  const session = sessionManager.getUserSession(userId);\n  if (session && session.saleTimer) {\n    clearTimeout(session.saleTimer);\n    sessionManager.updateUserSession(userId, { saleTimer: null });\n  }\n}\n\nmodule.exports = clearSaleTimer;","size_bytes":377},"docs/API.md":{"content":"","size_bytes":0},"modules/messageHandler/personalization.js":{"content":"const serviceLoader = require('../serviceLoader');\n\nfunction createPersonalizedGreeting(contactName, greetingType) {\n  const greetings = serviceLoader.loadJSON('./genel_diyalog/selamlama_vedalasma.json');\n  const baseGreeting = greetings?.selamlama?.[greetingType] || \n                      'Merhaba! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?';\n  \n  if (contactName && contactName.trim().length > 0) {\n    const personalizedGreetings = {\n      gunaydin: `ğŸŒ GÃ¼naydÄ±n ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`,\n      merhaba: `ğŸ‘‹ Merhaba ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`,\n      iyi_aksamlar: `ğŸŒ™ Ä°yi akÅŸamlar ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`\n    };\n    \n    return personalizedGreetings[greetingType] || \n           `ğŸ‘‹ Merhaba ${contactName}! Ben ARYA, PlanB Global Network Ltd Åti iÃ§in hizmet veren yapay zeka asistanÄ±yÄ±m. Size nasÄ±l yardÄ±mcÄ± olabilirim?`;\n  }\n  \n  return baseGreeting;\n}\n\nfunction createPersonalizedUnknownMessage(contactName) {\n  const baseText = `ğŸ¤” AnlayamadÄ±m. LÃ¼tfen aÅŸaÄŸÄ±daki seÃ§eneklerden birini belirtin:`;\n  \n  if (contactName) {\n    return `ğŸ¤” ${contactName}, anlayamadÄ±m. LÃ¼tfen aÅŸaÄŸÄ±daki seÃ§eneklerden birini belirtin:`;\n  }\n  \n  return baseText;\n}\n\nmodule.exports = {\n  createPersonalizedGreeting,\n  createPersonalizedUnknownMessage\n};","size_bytes":1683},"micro-modules/service/findYesilSigortaService.js":{"content":"// micro-modules/service/findYesilSigortaService.js\nfunction findYesilSigortaService(services) {\n  for (const [categoryName, categoryServices] of Object.entries(services)) {\n    if (typeof categoryServices === 'object' && categoryServices['yesil_sigorta']) {\n      return {\n        type: 'service',\n        data: categoryServices['yesil_sigorta'],\n        category: categoryName,\n        name: 'yesil_sigorta'\n      };\n    }\n  }\n  return null;\n}\n\nmodule.exports = findYesilSigortaService;","size_bytes":488},"modules/logger.js":{"content":"// Basit logger fonksiyonu\nconst logger = {\n  info: (message) => console.log(`[INFO] ${new Date().toISOString()}: ${message}`),\n  error: (message) => console.error(`[ERROR] ${new Date().toISOString()}: ${message}`),\n  warn: (message) => console.warn(`[WARN] ${new Date().toISOString()}: ${message}`)\n};\n\nmodule.exports = logger;","size_bytes":328}},"version":2}